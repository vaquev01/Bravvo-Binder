import{r as m,d as Ue,S as us,G as Ks,U as xs,_ as ke,g as rt,j as e,a2 as tt,f as Ce,a3 as Bs,u as et,a4 as la,a5 as Gt,A as Qe,p as gt,i as Re,e as ms,X as Ge,a6 as ss,a7 as oa,a8 as da,a as hs,b as ca,k as as,a9 as Hs,a1 as gs,aa as qs,ab as Ys,I as ua,ac as Qs,W as rs,ad as ns,ae as is,N as Ws,Z as bs,af as xa,ag as ma,ah as ha,B as at,l as nt,R as ga,ai as ba,t as ls,aj as pa,Q as Os,ak as fa,al as va,am as ja,an as Js,m as Zs,ao as ya,ap as wa,aq as Na,ar as Ca,y as Sa,as as Aa}from"./react-vendor-DpeMiI2M.js";import{u as it,a as zt,b as Oe,s as ht}from"./index-CQ2kwkCc.js";import"./vendor-DYLXRpC5.js";function Ia(t,a="pt-BR"){if(!t)return"";const s=new Date(t+"T12:00:00"),r=new Date;r.setHours(12,0,0,0);const l=new Date(r);l.setDate(l.getDate()+1);const c=new Date(r);if(c.setDate(c.getDate()-1),s.toDateString()===r.toDateString())return"Hoje";if(s.toDateString()===l.toDateString())return"Amanh√£";if(s.toDateString()===c.toDateString())return"Ontem";const n=s.toLocaleDateString(a,{weekday:"short"}),o=s.getDate(),i=s.toLocaleDateString(a,{month:"short"});return`${n}, ${o} ${i}`}const Pt=[{id:"dna",label:"Definir DNA da Marca",description:"Configure o Vault 1 com a identidade",icon:Ue,checkFn:t=>{var a,s,r,l,c,n;return!!((r=(s=(a=t==null?void 0:t.vaults)==null?void 0:a.S1)==null?void 0:s.fields)!=null&&r.archetype&&((n=(c=(l=t==null?void 0:t.vaults)==null?void 0:l.S1)==null?void 0:c.fields)!=null&&n.promise))},navTarget:"V1"},{id:"products",label:"Cadastrar Produtos",description:"Adicione ao menos 1 produto no Vault 2",icon:us,checkFn:t=>{var a,s,r;return(((r=(s=(a=t==null?void 0:t.vaults)==null?void 0:a.S2)==null?void 0:s.products)==null?void 0:r.length)||0)>0},navTarget:"V2"},{id:"channels",label:"Configurar Canais",description:"Selecione onde voc√™ vai estar presente",icon:Ks,checkFn:t=>{var a,s,r;return(((r=(s=(a=t==null?void 0:t.vaults)==null?void 0:a.S3)==null?void 0:s.channels)==null?void 0:r.length)||0)>0},navTarget:"V3"},{id:"team",label:"Definir Time",description:"Configure o aprovador no Vault 4",icon:xs,checkFn:t=>{var a,s,r,l;return!!((l=(r=(s=(a=t==null?void 0:t.vaults)==null?void 0:a.S4)==null?void 0:s.matrix)==null?void 0:r.find(c=>c.role==="Aprovador Final"))!=null&&l.who)},navTarget:"V4"},{id:"plan",label:"Criar Plano",description:"Adicione a√ß√µes ao roadmap",icon:ke,checkFn:t=>{var a,s;return(((s=(a=t==null?void 0:t.dashboard)==null?void 0:a.D2)==null?void 0:s.length)||0)>0},navTarget:"OS"},{id:"execute",label:"Executar A√ß√£o",description:'Mude uma a√ß√£o para "Em Produ√ß√£o"',icon:rt,checkFn:t=>{var a,s;return(s=(a=t==null?void 0:t.dashboard)==null?void 0:a.D2)==null?void 0:s.some(r=>r.status==="in_production"||r.status==="done")},navTarget:"OS"}];function ka({appData:t,onNavigate:a,variant:s="full",showWhenComplete:r=!1}){const{completedSteps:l,progress:c,allComplete:n}=m.useMemo(()=>{const i=Pt.filter(w=>w.checkFn(t)),j=Math.round(i.length/Pt.length*100);return{completedSteps:i.map(w=>w.id),progress:j,allComplete:j===100}},[t]);if(n&&!r)return null;const o=Pt.find(i=>!l.includes(i.id));if(s==="inline"&&o){const i=o.icon;return e.jsxs("button",{onClick:()=>a==null?void 0:a(o.navTarget),className:"flex items-center gap-3 p-3 bg-purple-500/10 border border-purple-500/30 rounded-lg hover:bg-purple-500/20 transition-colors w-full text-left",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-500/20 rounded-lg flex items-center justify-center",children:e.jsx(i,{size:16,className:"text-purple-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs text-purple-400 font-bold uppercase tracking-wider",children:"Pr√≥ximo Passo"}),e.jsx("p",{className:"text-sm text-white truncate",children:o.label})]}),e.jsx(tt,{size:16,className:"text-purple-400"})]})}return s==="compact"?e.jsxs("div",{className:"p-3 bg-[var(--bg-panel)] border border-[var(--border-subtle)] rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider",children:"Setup"}),e.jsxs("span",{className:"text-xs font-mono text-white",children:[c,"%"]})]}),e.jsx("div",{className:"h-1.5 bg-[var(--border-subtle)] rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-purple-500 to-blue-500 transition-all duration-500",style:{width:`${c}%`}})}),o&&e.jsxs("p",{className:"mt-2 text-[10px] text-gray-500",children:["Pr√≥ximo: ",o.label]})]}):e.jsxs("div",{className:"bg-[var(--bg-surface)] border border-[var(--border-subtle)] rounded-xl overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-[var(--border-subtle)] bg-gradient-to-r from-purple-500/10 to-blue-500/10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-bold text-white",children:"Setup do Bravvo Binder"}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:"Configure o sistema para come√ßar"})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("span",{className:"text-2xl font-bold text-white",children:[c,"%"]}),e.jsx("p",{className:"text-[10px] text-gray-500",children:"completo"})]})]}),e.jsx("div",{className:"h-2 bg-[var(--border-subtle)] rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-purple-500 to-blue-500 transition-all duration-500",style:{width:`${c}%`}})})]}),e.jsx("div",{className:"divide-y divide-[var(--border-subtle)]",children:Pt.map((i,j)=>{const w=l.includes(i.id),x=i.id===(o==null?void 0:o.id);return e.jsxs("button",{onClick:()=>a==null?void 0:a(i.navTarget),className:`
                                w-full flex items-center gap-4 p-4 text-left transition-colors
                                ${x?"bg-purple-500/10":"hover:bg-white/5"}
                            `,children:[e.jsx("div",{className:`
                                w-8 h-8 rounded-lg flex items-center justify-center shrink-0
                                ${w?"bg-green-500/20 text-green-400":x?"bg-purple-500/20 text-purple-400":"bg-[var(--bg-panel)] text-gray-600"}
                            `,children:w?e.jsx(Ce,{size:18}):e.jsx("span",{className:"text-xs font-bold",children:j+1})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:`text-sm font-medium ${w?"text-gray-400":"text-white"}`,children:i.label}),e.jsx("p",{className:"text-xs text-gray-600 truncate",children:i.description})]}),e.jsx("div",{className:"shrink-0",children:w?e.jsx(Ce,{size:16,className:"text-green-500"}):x?e.jsx(tt,{size:16,className:"text-purple-400"}):e.jsx(Bs,{size:16,className:"text-gray-700"})})]},i.id)})}),n&&e.jsx("div",{className:"p-4 bg-green-500/10 border-t border-green-500/30",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ce,{size:20,className:"text-green-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold text-green-400",children:"Setup Completo!"}),e.jsx("p",{className:"text-xs text-green-500/70",children:"O Bravvo Binder est√° pronto para uso"})]})]})})]})}const os={delayed:{icon:Qe,color:"red",priority:1},bottleneck:{icon:Gt,color:"orange",priority:2},missing_art:{icon:la,color:"yellow",priority:3},opportunity:{icon:et,color:"green",priority:4},reminder:{icon:ke,color:"blue",priority:5}};function _a(t=[],a={}){const s=[],r=new Date;r.setHours(0,0,0,0);const l=new Date(r);l.setDate(l.getDate()+1);const c=t.filter(x=>!x.date||x.status==="done"||x.status==="cancelled"?!1:new Date(x.date+"T23:59:59")<r&&x.status!=="scheduled");if(c.length>0){const x=c.length>0;s.push({type:"delayed",title:`${c.length} a√ß√£o${c.length>1?"√µes":""} atrasada${c.length>1?"s":""}`,description:x?"Isso pode impactar as entregas de amanh√£":"Revise as prioridades para retomar o cronograma",items:c,actionLabel:"Ver atrasados"})}const n=t.filter(x=>x.status==="in_production");n.length>=3&&s.push({type:"bottleneck",title:"Poss√≠vel gargalo em produ√ß√£o",description:`${n.length} itens em produ√ß√£o simultaneamente`,items:n,actionLabel:"Ver produ√ß√£o"});const o=new Date(r);o.setDate(o.getDate()-3);const i=t.filter(x=>x.status==="done"||x.status==="cancelled"||x.visual_output&&x.visual_output!=="Pending"?!1:new Date(x.date+"T12:00:00")<=o);i.length>0&&s.push({type:"missing_art",title:`${i.length} campanha${i.length>1?"s":""} sem arte`,description:"H√° mais de 3 dias aguardando criativo",items:i,actionLabel:"Gerar arte"});const j=t.filter(x=>x.status==="draft");j.length>=5&&s.push({type:"opportunity",title:"Plano pronto para execu√ß√£o",description:`${j.length} rascunhos aguardando produ√ß√£o`,items:j,actionLabel:"Iniciar produ√ß√£o"});const w=t.filter(x=>new Date(x.date+"T12:00:00").toDateString()===l.toDateString()&&x.status!=="done"&&x.status!=="cancelled");return w.length>0&&s.push({type:"reminder",title:`${w.length} entrega${w.length>1?"s":""} amanh√£`,description:"Verifique se est√° tudo pronto",items:w,actionLabel:"Ver entregas"}),s.sort((x,g)=>os[x.type].priority-os[g.type].priority)}function Yt({insight:t,onAction:a,compact:s=!1}){const r=os[t.type],l=r.icon,c={red:"bg-red-500/10 border-red-500/30 text-red-400",orange:"bg-orange-500/10 border-orange-500/30 text-orange-400",yellow:"bg-yellow-500/10 border-yellow-500/30 text-yellow-400",green:"bg-green-500/10 border-green-500/30 text-green-400",blue:"bg-blue-500/10 border-blue-500/30 text-blue-400"},n={red:"text-red-400",orange:"text-orange-400",yellow:"text-yellow-400",green:"text-green-400",blue:"text-blue-400"};return s?e.jsxs("button",{onClick:()=>a==null?void 0:a(t),className:`
                    flex items-center gap-3 p-3 rounded-lg border transition-all
                    hover:scale-[1.02] cursor-pointer
                    ${c[r.color]}
                `,children:[e.jsx(l,{size:16,className:n[r.color]}),e.jsx("span",{className:"text-sm font-medium text-white flex-1 text-left",children:t.title}),e.jsx(gt,{size:14,className:"opacity-50"})]}):e.jsx("div",{className:`
            p-4 rounded-xl border transition-all
            ${c[r.color]}
        `,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`
                    w-10 h-10 rounded-lg flex items-center justify-center shrink-0
                    bg-black/20
                `,children:e.jsx(l,{size:20,className:n[r.color]})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"text-sm font-bold text-white mb-1",children:t.title}),e.jsx("p",{className:"text-xs text-gray-400 mb-3",children:t.description}),a&&e.jsxs("button",{onClick:()=>a(t),className:"text-xs font-bold text-white bg-white/10 hover:bg-white/20 px-3 py-1.5 rounded-lg transition-colors inline-flex items-center gap-1.5",children:[t.actionLabel,e.jsx(gt,{size:12})]})]})]})})}function Ta({items:t=[],vaults:a={},onInsightAction:s,maxItems:r=3,variant:l="default",showEmpty:c=!1}){const n=m.useMemo(()=>_a(t,a).slice(0,r),[t,a,r]);return n.length===0?c?e.jsxs("div",{className:"p-4 bg-green-500/10 border border-green-500/30 rounded-xl flex items-center gap-3",children:[e.jsx(Ce,{size:20,className:"text-green-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-white",children:"Tudo em dia!"}),e.jsx("p",{className:"text-xs text-green-400/70",children:"Nenhum alerta ou sugest√£o no momento"})]})]}):null:l==="inline"?e.jsx("div",{className:"flex flex-wrap gap-2",children:n.map((o,i)=>e.jsx(Yt,{insight:o,onAction:s,compact:!0},i))}):l==="compact"?e.jsx("div",{className:"space-y-2",children:n.map((o,i)=>e.jsx(Yt,{insight:o,onAction:s,compact:!0},i))}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:n.map((o,i)=>e.jsx(Yt,{insight:o,onAction:s},i))})}const Gs={roadmap:{icon:ke,title:"Nenhuma a√ß√£o no roadmap",description:"Crie seu primeiro item para come√ßar a planejar",action:{label:"Criar Primeira A√ß√£o",icon:Re},tip:"Dica: Use playbooks para gerar um plano completo automaticamente"},vaults:{icon:Ue,title:"Vaults n√£o configurados",description:"Defina o DNA da marca para gerar a√ß√µes melhores",action:{label:"Configurar DNA",icon:gt},tip:"Os Vaults alimentam a intelig√™ncia do sistema"},products:{icon:us,title:"Nenhum produto cadastrado",description:"Adicione seus produtos para criar ofertas",action:{label:"Adicionar Produto",icon:Re},tip:"Produtos aparecem nas a√ß√µes do roadmap"},channels:{icon:Ks,title:"Nenhum canal selecionado",description:"Escolha onde voc√™ quer estar presente",action:{label:"Selecionar Canais",icon:gt},tip:"Canais definem onde suas a√ß√µes ser√£o publicadas"},team:{icon:xs,title:"Time n√£o configurado",description:"Defina quem aprova e executa as a√ß√µes",action:{label:"Configurar Time",icon:gt},tip:"O aprovador receber√° solicita√ß√µes pelo WhatsApp"},ideas:{icon:ms,title:"Nenhuma ideia salva",description:"Guarde suas inspira√ß√µes e refer√™ncias aqui",action:{label:"Adicionar Ideia",icon:Re},tip:"Ideias podem virar a√ß√µes no roadmap"},governance:{icon:rt,title:"Nenhum hist√≥rico de governan√ßa",description:"Ative o modo Governan√ßa para registrar decis√µes",action:{label:"Ativar Governan√ßa",icon:rt},tip:"Governan√ßa cria um hist√≥rico de auditoria"}};function Da({type:t="roadmap",onAction:a,customTitle:s,customDescription:r,customAction:l,showTip:c=!0,size:n="md"}){const o=Gs[t]||Gs.roadmap,i=o.icon,j=(l==null?void 0:l.icon)||o.action.icon,w={sm:"py-6",md:"py-12",lg:"py-16"},x={sm:20,md:28,lg:36};return e.jsxs("div",{className:`flex flex-col items-center justify-center text-center ${w[n]} animate-fadeIn`,children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl card-elevated flex items-center justify-center mb-4",children:e.jsx(i,{size:x[n],className:"text-[var(--text-tertiary)]"})}),e.jsx("h3",{className:"text-section mb-2",children:s||o.title}),e.jsx("p",{className:"text-body max-w-xs mb-6",children:r||o.description}),a&&e.jsxs("button",{onClick:a,className:"btn-primary",children:[e.jsx(j,{size:16}),(l==null?void 0:l.label)||o.action.label]}),c&&o.tip&&e.jsxs("p",{className:"mt-6 text-caption flex items-center gap-1.5",children:[e.jsx(rt,{size:12,className:"text-purple-500"}),o.tip]})]})}function zs({open:t,onClose:a,title:s,subtitle:r,children:l,width:c="md",position:n="right",showOverlay:o=!0,testId:i}){const j=m.useRef(null);if(m.useEffect(()=>{const y=_=>{_.key==="Escape"&&t&&a()};return document.addEventListener("keydown",y),()=>document.removeEventListener("keydown",y)},[t,a]),m.useEffect(()=>(t?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[t]),!t)return null;const w={sm:"w-full max-w-sm",md:"w-full max-w-md",lg:"w-full max-w-lg",xl:"w-full max-w-xl","2xl":"w-full max-w-2xl"},x={right:"right-0",left:"left-0"},g=n==="right"?"animate-slideInRight":"animate-slideInLeft";return e.jsxs("div",{className:"fixed inset-0 z-[100]","data-testid":i,children:[o&&e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm animate-fadeIn",onClick:a}),e.jsxs("div",{ref:j,className:`
                    absolute top-0 bottom-0 ${x[n]}
                    ${w[c]}
                    bg-[var(--bg-surface)] border-l border-[var(--border-subtle)]
                    flex flex-col shadow-2xl
                    ${g}
                `,children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-[var(--border-subtle)] bg-[var(--bg-panel)]",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-sm font-bold text-white uppercase tracking-widest",children:s}),r&&e.jsx("p",{className:"text-[10px] text-gray-500 font-mono mt-0.5",children:r})]}),e.jsx("button",{onClick:a,className:"p-2 hover:bg-white/10 rounded-lg transition-colors text-gray-400 hover:text-white",children:e.jsx(Ge,{size:18})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:l})]})]})}function fe({className:t="",variant:a="text"}){const s="skeleton-shimmer rounded",r={text:"h-4 w-full",title:"h-6 w-3/4",avatar:"h-10 w-10 rounded-full",card:"h-24 w-full rounded-xl",button:"h-9 w-24 rounded-lg",badge:"h-5 w-16 rounded-full"};return e.jsx("div",{className:`${s} ${r[a]} ${t}`})}function Pa({columns:t=5}){return e.jsx("div",{className:"flex items-center gap-4 px-4 py-3 border-b border-[var(--border-subtle)]",children:Array.from({length:t}).map((a,s)=>e.jsx(fe,{className:s===0?"w-20":s===1?"flex-1":"w-24"},s))})}function $a(){return e.jsxs("div",{className:"bento-grid p-4 bento-cell space-y-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx(fe,{variant:"badge"}),e.jsx(fe,{className:"h-4 w-8"})]}),e.jsx(fe,{variant:"title"}),e.jsx(fe,{className:"h-1 w-full rounded-full"})]})}function Ea(){return e.jsxs("div",{className:"bento-grid p-4 bento-cell space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fe,{variant:"avatar",className:"h-8 w-8"}),e.jsx(fe,{className:"h-4 w-20"})]}),e.jsx(fe,{variant:"text"}),e.jsx(fe,{className:"h-3 w-2/3"})]})}function Fa(){return e.jsxs("div",{className:"mb-6 space-y-4 animate-pulse",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(fe,{className:"h-4 w-24"}),e.jsx(fe,{variant:"title",className:"h-8 w-64"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(fe,{variant:"badge",className:"w-24"}),e.jsx(fe,{variant:"badge",className:"w-28"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(fe,{variant:"card",className:"h-32"}),e.jsx(fe,{variant:"card",className:"h-32"})]})]})}function Oa({rows:t=5}){return e.jsxs("div",{className:"bento-grid overflow-hidden",children:[e.jsx("div",{className:"px-4 py-3 border-b border-[var(--border-subtle)] bg-[var(--bg-panel)]",children:e.jsx(fe,{className:"h-4 w-32"})}),Array.from({length:t}).map((a,s)=>e.jsx(Pa,{},s))]})}function Ga(){return e.jsxs("div",{className:"space-y-6 p-4 md:p-6",children:[e.jsx(Fa,{}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:Array.from({length:4}).map((t,a)=>e.jsx($a,{},a))}),e.jsx(Oa,{rows:5}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:Array.from({length:5}).map((t,a)=>e.jsx(Ea,{},a))})]})}function Ve(t){var a;return!!((a=t==null?void 0:t.signature)!=null&&a.closedAt&&(t!=null&&t.kpis))}function za(t){var a;return(t==null?void 0:t.id)||((a=t==null?void 0:t.signature)==null?void 0:a.closedAt)||(t==null?void 0:t.date)||String(Math.random())}function Ma(t){var a;return((a=t==null?void 0:t.signature)==null?void 0:a.closedAt)||(t==null?void 0:t.date)||new Date().toISOString()}function La(t){return Ve(t)?t.kpis:t==null?void 0:t.kpiSnapshot}function Qt(t){try{return new Date(t).toLocaleString("pt-BR",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return String(t||"")}}function Va({history:t=[],open:a,onClose:s,focusEntryId:r=null,...l}){const[c,n]=m.useState(null),[o,i]=m.useState(null),j=m.useMemo(()=>(Array.isArray(t)?t:[]).map(x=>({raw:x,kind:Ve(x)?"ata":"snapshot",id:za(x),date:Ma(x),kpis:La(x)})),[t]);m.useEffect(()=>{if(a){if(r){n(r);return}j.length>0&&!c&&n(j[0].id)}},[a,r,j,c]);const w=x=>{var z,M,O,$,F,T,G,q,W,ie,R,Y,ne,le,se,oe,L,ee;const g=x==null?void 0:x.raw,y=x==null?void 0:x.kpis;if(Ve(g)){const ae=`
 ÔøΩ ATA DE GOVERNAN√áA
 ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
 
 üïí Fechamento: ${Qt((z=g.signature)==null?void 0:z.closedAt)} (${((M=g.signature)==null?void 0:M.timezone)||""})
 üßë Respons√°vel: ${((O=g.signature)==null?void 0:O.responsible)||"‚Äî"}
 üìÜ Tipo: ${(($=g.signature)==null?void 0:$.type)||"‚Äî"}
 üìÖ Per√≠odo: ${((F=g.signature)==null?void 0:F.period)||"‚Äî"}
 
 üìà KPIs:
 ‚Ä¢ Receita: R$ ${((T=y==null?void 0:y.revenue)==null?void 0:T.value)||0} (Meta: R$ ${((G=y==null?void 0:y.revenue)==null?void 0:G.goal)||0})
 ‚Ä¢ Vendas: ${((q=y==null?void 0:y.sales)==null?void 0:q.value)||0} (Meta: ${((W=y==null?void 0:y.sales)==null?void 0:W.goal)||0})
 ‚Ä¢ Tr√°fego: R$ ${((ie=y==null?void 0:y.traffic)==null?void 0:ie.value)||0} (Meta: R$ ${((R=y==null?void 0:y.traffic)==null?void 0:R.goal)||0})
 
 ‚úÖ Decis√µes:
 ${(g.decisions||[]).map(me=>`‚Ä¢ ${me}`).join(`
`)||"‚Ä¢ ‚Äî"}
 
 ‚ö†Ô∏è Riscos:
 ${(g.risks||[]).map(me=>`‚Ä¢ ${me}`).join(`
`)||"‚Ä¢ ‚Äî"}
 
 üéØ Pr√≥ximas Prioridades:
 ${(g.nextPriorities||[]).map(me=>`‚Ä¢ ${me}`).join(`
`)||"‚Ä¢ ‚Äî"}
            `.trim();navigator.clipboard.writeText(ae),i(x.id),setTimeout(()=>i(null),2e3);return}const _=`
 üìä GOVERNAN√áA - ${Qt(g==null?void 0:g.date)}
 ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
 
 üìà KPIs:
 ‚Ä¢ Faturamento: R$ ${((Y=y==null?void 0:y.revenue)==null?void 0:Y.value)||0} (Meta: R$ ${((ne=y==null?void 0:y.revenue)==null?void 0:ne.goal)||0})
 ‚Ä¢ Vendas: ${((le=y==null?void 0:y.sales)==null?void 0:le.value)||0} (Meta: ${((se=y==null?void 0:y.sales)==null?void 0:se.goal)||0})
 ‚Ä¢ CPM: R$ ${((oe=y==null?void 0:y.traffic)==null?void 0:oe.value)||0}
 
 üìã Tarefas:
 ${(g==null?void 0:g.tasksSummary)||"Sem detalhes"}
 
 ‚úÖ Posts Aprovados: ${((L=g==null?void 0:g.postsApproved)==null?void 0:L.length)||0}
 ${((ee=g==null?void 0:g.postsApproved)==null?void 0:ee.map(ae=>`‚Ä¢ ${ae}`).join(`
`))||""}
 
 üìù Notas:
 ${(g==null?void 0:g.notes)||"Sem notas"}
        `.trim();navigator.clipboard.writeText(_),i(x.id),setTimeout(()=>i(null),2e3)};return a?e.jsx("div",{className:"fixed inset-0 z-[100] bg-black/90 backdrop-blur-sm flex items-center justify-center p-4 overflow-y-auto",children:e.jsxs("div",{className:"bg-[#0A0A0A] border border-white/10 rounded-2xl w-full max-w-3xl max-h-[90vh] flex flex-col animate-fadeIn",children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b border-white/10 shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-500/20 rounded-xl flex items-center justify-center",children:e.jsx(ss,{size:20,className:"text-purple-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-white",children:"Hist√≥rico de Governan√ßa"}),e.jsxs("p",{className:"text-xs text-gray-500",children:[j.length," registros"]})]})]}),e.jsx("button",{onClick:s,className:"text-gray-500 hover:text-white p-2 hover:bg-white/10 rounded-lg",children:e.jsx(Ge,{size:20})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6 space-y-4",children:j.length===0?e.jsxs("div",{className:"text-center py-16",children:[e.jsx(ss,{size:48,className:"text-gray-700 mx-auto mb-4"}),e.jsx("h4",{className:"text-lg font-medium text-gray-400 mb-2",children:"Nenhum registro ainda"}),e.jsx("p",{className:"text-sm text-gray-600 max-w-sm mx-auto",children:"Quando voc√™ processar um ciclo de governan√ßa, os KPIs e status ser√£o salvos aqui automaticamente."})]}):e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-5 top-0 bottom-0 w-px bg-white/10"}),j.map((x,g)=>{var y,_,z,M,O,$,F,T,G,q,W,ie,R,Y,ne,le,se,oe,L,ee,ae,me,pe,te,ve,Se,ye,E,X,xe,Ae,ge;return e.jsxs("div",{className:"relative pl-12 pb-6",children:[e.jsx("div",{className:`absolute left-3 w-5 h-5 rounded-full border-2 ${g===0?"bg-purple-500 border-purple-400":"bg-[#0A0A0A] border-white/20"}`,children:g===0&&e.jsx("div",{className:"absolute inset-0 bg-purple-500 rounded-full animate-ping opacity-20"})}),e.jsxs("div",{className:`bg-white/5 border rounded-xl overflow-hidden transition-all ${c===x.id?"border-purple-500/30":"border-white/10"}`,children:[e.jsxs("button",{onClick:()=>n(c===x.id?null:x.id),className:"w-full p-4 flex items-center justify-between text-left hover:bg-white/5 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-400",children:[e.jsx(ke,{size:14}),e.jsx("span",{className:"text-sm font-medium text-white",children:Qt(x.date)})]}),g===0&&e.jsx("span",{className:"text-[9px] bg-purple-500/20 text-purple-400 px-2 py-0.5 rounded border border-purple-500/30",children:"MAIS RECENTE"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsxs("span",{className:"text-green-400",children:["R$ ",(((_=(y=x.kpis)==null?void 0:y.revenue)==null?void 0:_.value)||0).toLocaleString()]}),e.jsx("span",{className:"text-gray-600",children:"|"}),e.jsxs("span",{className:"text-blue-400",children:[((M=(z=x.kpis)==null?void 0:z.sales)==null?void 0:M.value)||0," vendas"]})]}),c===x.id?e.jsx(oa,{size:16,className:"text-gray-500"}):e.jsx(da,{size:16,className:"text-gray-500"})]})]}),c===x.id&&e.jsxs("div",{className:"px-4 pb-4 space-y-4 border-t border-white/10 animate-fadeIn",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3 pt-4",children:[e.jsxs("div",{className:"bg-green-500/10 border border-green-500/20 rounded-lg p-3",children:[e.jsx("p",{className:"text-[10px] text-green-400 uppercase tracking-wide mb-1",children:"Faturamento"}),e.jsxs("p",{className:"text-lg font-bold text-white",children:["R$ ",((($=(O=x.kpis)==null?void 0:O.revenue)==null?void 0:$.value)||0).toLocaleString()]}),e.jsxs("p",{className:"text-[10px] text-gray-500 mb-2",children:["Meta: R$ ",(((T=(F=x.kpis)==null?void 0:F.revenue)==null?void 0:T.goal)||0).toLocaleString()]}),!Ve(x.raw)&&((W=(q=(G=x.raw)==null?void 0:G.kpiSnapshot)==null?void 0:q.revenue)==null?void 0:W.comment)&&e.jsx("div",{className:"pt-2 border-t border-green-500/20 mt-2",children:e.jsxs("p",{className:"text-[10px] text-gray-400 italic",children:['"',x.raw.kpiSnapshot.revenue.comment,'"']})})]}),e.jsxs("div",{className:"bg-blue-500/10 border border-blue-500/20 rounded-lg p-3",children:[e.jsx("p",{className:"text-[10px] text-blue-400 uppercase tracking-wide mb-1",children:"Vendas"}),e.jsx("p",{className:"text-lg font-bold text-white",children:((R=(ie=x.kpis)==null?void 0:ie.sales)==null?void 0:R.value)||0}),e.jsxs("p",{className:"text-[10px] text-gray-500 mb-2",children:["Meta: ",((ne=(Y=x.kpis)==null?void 0:Y.sales)==null?void 0:ne.goal)||0]}),!Ve(x.raw)&&((oe=(se=(le=x.raw)==null?void 0:le.kpiSnapshot)==null?void 0:se.sales)==null?void 0:oe.comment)&&e.jsx("div",{className:"pt-2 border-t border-blue-500/20 mt-2",children:e.jsxs("p",{className:"text-[10px] text-gray-400 italic",children:['"',x.raw.kpiSnapshot.sales.comment,'"']})})]}),e.jsxs("div",{className:"bg-orange-500/10 border border-orange-500/20 rounded-lg p-3",children:[e.jsx("p",{className:"text-[10px] text-orange-400 uppercase tracking-wide mb-1",children:"CPM"}),e.jsxs("p",{className:"text-lg font-bold text-white",children:["R$ ",((ee=(L=x.kpis)==null?void 0:L.traffic)==null?void 0:ee.value)||0]}),e.jsxs("p",{className:"text-[10px] text-gray-500 mb-2",children:["Meta: R$ ",((me=(ae=x.kpis)==null?void 0:ae.traffic)==null?void 0:me.goal)||0]}),!Ve(x.raw)&&((ve=(te=(pe=x.raw)==null?void 0:pe.kpiSnapshot)==null?void 0:te.traffic)==null?void 0:ve.comment)&&e.jsx("div",{className:"pt-2 border-t border-orange-500/20 mt-2",children:e.jsxs("p",{className:"text-[10px] text-gray-400 italic",children:['"',x.raw.kpiSnapshot.traffic.comment,'"']})})]})]}),Ve(x.raw)&&e.jsxs(e.Fragment,{children:[(((Se=x.raw)==null?void 0:Se.decisions)||[]).length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] text-gray-500 uppercase tracking-wide mb-2",children:"Decis√µes"}),e.jsx("div",{className:"text-sm text-gray-300 bg-white/5 rounded-lg p-3 space-y-1",children:x.raw.decisions.map((je,de)=>e.jsxs("div",{children:["‚Ä¢ ",je]},de))})]}),(((ye=x.raw)==null?void 0:ye.risks)||[]).length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] text-gray-500 uppercase tracking-wide mb-2",children:"Riscos"}),e.jsx("div",{className:"text-sm text-gray-300 bg-white/5 rounded-lg p-3 space-y-1",children:x.raw.risks.map((je,de)=>e.jsxs("div",{children:["‚Ä¢ ",je]},de))})]}),(((E=x.raw)==null?void 0:E.nextPriorities)||[]).length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] text-gray-500 uppercase tracking-wide mb-2",children:"Pr√≥ximas Prioridades"}),e.jsx("div",{className:"text-sm text-gray-300 bg-white/5 rounded-lg p-3 space-y-1",children:x.raw.nextPriorities.map((je,de)=>e.jsxs("div",{children:["‚Ä¢ ",je]},de))})]})]}),!Ve(x.raw)&&((X=x.raw)==null?void 0:X.tasksSummary)&&e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] text-gray-500 uppercase tracking-wide mb-2",children:"Resumo de Tarefas"}),e.jsx("p",{className:"text-sm text-gray-300 bg-white/5 rounded-lg p-3",children:x.raw.tasksSummary})]}),!Ve(x.raw)&&((Ae=(xe=x.raw)==null?void 0:xe.postsApproved)==null?void 0:Ae.length)>0&&e.jsxs("div",{children:[e.jsxs("p",{className:"text-[10px] text-gray-500 uppercase tracking-wide mb-2",children:["Posts Aprovados (",x.raw.postsApproved.length,")"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:x.raw.postsApproved.map((je,de)=>e.jsx("span",{className:"text-xs bg-green-500/10 text-green-400 px-2 py-1 rounded border border-green-500/20",children:je},de))})]}),!Ve(x.raw)&&((ge=x.raw)==null?void 0:ge.notes)&&e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] text-gray-500 uppercase tracking-wide mb-2",children:"Estrat√©gia Geral / Plano de A√ß√£o"}),e.jsx("p",{className:"text-sm text-gray-300 italic bg-white/5 p-3 rounded-lg border border-white/5",children:x.raw.notes})]}),e.jsx("div",{className:"flex justify-end pt-2",children:e.jsx("button",{onClick:()=>w(x),className:"flex items-center gap-2 text-xs text-gray-400 hover:text-white bg-white/5 px-3 py-1.5 rounded-lg transition-colors",children:o===x.id?e.jsxs(e.Fragment,{children:[e.jsx(hs,{size:12,className:"text-green-400"}),"Copiado!"]}):e.jsxs(e.Fragment,{children:[e.jsx(ca,{size:12}),"Copiar Resumo"]})})})]})]})]},x.id)})]})}),e.jsxs("div",{className:"p-6 border-t border-white/10 flex justify-between items-center shrink-0",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"üíæ Registros s√£o salvos automaticamente ao processar governan√ßa"}),e.jsx("button",{onClick:s,className:"px-4 py-2 bg-white/10 text-white rounded-lg font-medium text-sm hover:bg-white/20 transition-colors",children:"Fechar"})]})]})}):null}function Ra({open:t,onClose:a,contract:s,onImport:r}){const{t:l}=it(),[c,n]=m.useState("manual"),[o,i]=m.useState({}),[j,w]=m.useState(null),[x,g]=m.useState(null);if(!t||!s)return null;const y=s.kpis.filter(O=>O.source!=="api"),_=(O,$)=>{i(F=>({...F,[O]:$}))},z=O=>{const $=O.target.files[0];if($){w($);const F=new FileReader;F.onload=T=>{const G=T.target.result;g({name:$.name,size:$.size,rows:G.split(`
`).length})},F.readAsText($)}},M=()=>{const O={mode:c,timestamp:new Date().toISOString(),values:c==="manual"?o:{file:j==null?void 0:j.name,status:"processed_mock"}};r(O),a(),i({}),w(null),g(null)};return e.jsx("div",{className:"fixed inset-0 z-[100] bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 animate-fadeIn",children:e.jsxs("div",{className:"bg-[#0A0A0A] border border-white/10 rounded-xl w-full max-w-2xl shadow-2xl flex flex-col max-h-[90vh]",children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b border-white/10 bg-[#0A0A0A]",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-bold text-white tracking-tight flex items-center gap-2",children:[e.jsx(as,{size:20,className:"text-purple-500"}),l("os.import.title")||"Importar Dados"]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Ciclo Ativo: ",e.jsx("span",{className:"text-white font-mono",children:s.cycle.label})]})]}),e.jsx("button",{onClick:a,className:"text-gray-500 hover:text-white transition-colors",children:e.jsx(Ge,{size:20})})]}),e.jsxs("div",{className:"flex border-b border-white/5 bg-[#050505]",children:[e.jsx("button",{onClick:()=>n("manual"),className:`flex-1 py-3 text-xs font-bold uppercase tracking-wider transition-colors ${c==="manual"?"bg-[#111] text-white border-b-2 border-purple-500":"text-gray-500 hover:text-gray-300"}`,children:"Entrada Manual"}),e.jsx("button",{onClick:()=>n("csv"),className:`flex-1 py-3 text-xs font-bold uppercase tracking-wider transition-colors ${c==="csv"?"bg-[#111] text-white border-b-2 border-purple-500":"text-gray-500 hover:text-gray-300"}`,children:"Upload CSV / Planilha"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 bg-[#0A0A0A]",children:[c==="manual"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-blue-500/10 border border-blue-500/20 rounded-lg p-4 flex items-start gap-3",children:[e.jsx(Hs,{size:16,className:"text-blue-400 mt-0.5"}),e.jsx("div",{className:"text-sm text-blue-200",children:"Preencha os valores atuais para os KPIs definidos no contrato deste ciclo."})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:y.map(O=>e.jsxs("div",{className:"bg-[#111] p-4 rounded-lg border border-white/5",children:[e.jsx("label",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider mb-2 block",children:O.label}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",className:"w-full bg-black border border-white/10 rounded px-3 py-2 text-white font-mono focus:border-purple-500 focus:outline-none transition-colors",placeholder:"0.00",value:o[O.id]||"",onChange:$=>_(O.id,$.target.value)}),e.jsx("span",{className:"text-xs text-gray-500 font-mono",children:O.format==="currency"?"BRL":""})]}),O.target&&e.jsxs("div",{className:"mt-2 text-[10px] text-gray-600 flex justify-between",children:[e.jsxs("span",{children:["Meta: ",O.target]}),e.jsx("span",{className:o[O.id]>=O.target?"text-green-500":"text-red-500",children:o[O.id]?(o[O.id]/O.target*100).toFixed(0)+"%":"0%"})]})]},O.id))})]}),c==="csv"&&e.jsxs("div",{className:"space-y-6 flex flex-col items-center justify-center h-full min-h-[200px]",children:[e.jsxs("div",{className:`w-full max-w-md border-2 border-dashed rounded-xl p-8 flex flex-col items-center justify-center transition-colors cursor-pointer ${j?"border-green-500/50 bg-green-500/5":"border-white/10 hover:border-purple-500/50 hover:bg-white/5"}`,children:[e.jsx("input",{type:"file",accept:".csv,.xlsx",className:"hidden",id:"csv-upload",onChange:z}),e.jsx("label",{htmlFor:"csv-upload",className:"flex flex-col items-center cursor-pointer w-full h-full",children:j?e.jsxs(e.Fragment,{children:[e.jsx(gs,{size:48,className:"text-green-500 mb-4"}),e.jsx("p",{className:"text-white font-bold",children:j.name}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[(j.size/1024).toFixed(2)," KB"]})]}):e.jsxs(e.Fragment,{children:[e.jsx(as,{size:48,className:"text-gray-500 mb-4"}),e.jsx("p",{className:"text-gray-300 font-medium",children:"Arraste sua planilha ou clique aqui"}),e.jsx("p",{className:"text-xs text-gray-600 mt-2",children:"Suporta CSV e Excel"})]})})]}),x&&e.jsxs("div",{className:"w-full max-w-md bg-[#111] rounded-lg p-4 border border-white/10 text-xs text-gray-400 font-mono",children:[e.jsxs("p",{className:"mb-1 text-green-400 flex items-center gap-2",children:[e.jsx(hs,{size:12})," Arquivo pronto para processamento"]}),e.jsxs("p",{children:["Linhas detectadas: ",x.rows]})]})]})]}),e.jsxs("div",{className:"p-4 border-t border-white/10 bg-[#0A0A0A] flex justify-end gap-3",children:[e.jsx("button",{onClick:a,className:"px-4 py-2 rounded text-xs font-bold text-gray-400 hover:text-white transition-colors",children:"CANCELAR"}),e.jsxs("button",{onClick:M,disabled:c==="csv"&&!j,className:"px-6 py-2 bg-purple-600 hover:bg-purple-500 text-white rounded text-xs font-bold uppercase tracking-wider flex items-center gap-2 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(qs,{size:14}),"Processar Importa√ß√£o"]})]})]})})}const Ms={retail_growth:{id:"retail_growth",name:"Crescimento Varejo (Agressivo)",description:"Foco em tr√°fego pago para ofertas Hero e convers√£o r√°pida.",objectiveType:"OBJ_GROWTH",channels:["Instagram Feed","Instagram Story","WhatsApp"],tasks:[{dayOffset:0,type:"setup",title:"Definir Oferta da Semana",role:"Estrategista"},{dayOffset:1,type:"creative",title:"Criar 3 Varia√ß√µes de Arte (Promo)",role:"Designer"},{dayOffset:2,type:"traffic",title:"Subir Campanha 'Oferta Rel√¢mpago'",role:"Gestor Tr√°fego"},{dayOffset:3,type:"content",title:"Stories de Prova Social",role:"Conte√∫do"},{dayOffset:5,type:"sales",title:"Disparo Lista VIP WhatsApp",role:"Comercial"}],rules:{minDiscount:15,frequency:"daily"}},brand_awareness:{id:"brand_awareness",name:"Constru√ß√£o de Marca (Institucional)",description:"Foco em alcance, narrativa e posicionamento.",objectiveType:"OBJ_AWARENESS",channels:["Instagram Reels","TikTok","Blog"],tasks:[{dayOffset:0,type:"creative",title:"Roteirizar V√≠deo Manifesto",role:"Copywriter"},{dayOffset:2,type:"production",title:"Grava√ß√£o de Bastidores",role:"Videomaker"},{dayOffset:4,type:"content",title:"Post Carrossel 'Nossa Hist√≥ria'",role:"Conte√∫do"}],rules:{visualStyle:"cinematic",frequency:"3x_week"}}};function Ka({open:t,onClose:a,onApply:s}){const[r,l]=m.useState(null);if(!t)return null;const c=Object.values(Ms),n=r?Ms[r]:null,o=()=>{n&&(s(n),a(),l(null))};return e.jsx("div",{"data-testid":"playbook-modal",className:"fixed inset-0 z-[100] bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 animate-fadeIn",children:e.jsxs("div",{className:"bg-[#0A0A0A] border border-white/10 rounded-xl w-full max-w-4xl shadow-2xl flex flex-col max-h-[90vh]",children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b border-white/10 bg-[#0A0A0A]",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-bold text-white tracking-tight flex items-center gap-2",children:[e.jsx(Ys,{size:20,className:"text-blue-500"}),"Biblioteca de Playbooks"]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Selecione uma estrat√©gia para gerar tarefas autom√°ticas."})]}),e.jsx("button",{onClick:a,className:"text-gray-500 hover:text-white transition-colors",children:e.jsx(Ge,{size:20})})]}),e.jsxs("div",{className:"flex-1 overflow-hidden flex flex-col md:flex-row",children:[e.jsx("div",{className:"w-full md:w-1/3 border-r border-white/10 overflow-y-auto bg-[#050505]",children:c.map(i=>e.jsxs("button",{onClick:()=>l(i.id),"data-testid":`playbook-select-${i.id}`,className:`w-full text-left p-4 border-b border-white/5 transition-colors hover:bg-white/5 ${r===i.id?"bg-white/10 border-l-2 border-l-blue-500":""}`,children:[e.jsx("div",{className:"text-sm font-bold text-white mb-1",children:i.name}),e.jsx("div",{className:"text-xs text-gray-500 line-clamp-2",children:i.description}),e.jsx("div",{className:"mt-2 flex gap-1 flex-wrap",children:e.jsx("span",{className:"text-[9px] bg-blue-900/30 text-blue-300 px-1.5 py-0.5 rounded border border-blue-500/20",children:i.objectiveType.replace("OBJ_","")})})]},i.id))}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6 bg-[#0A0A0A]",children:n?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-xl font-bold text-white mb-2",children:n.name}),e.jsx("p",{className:"text-gray-400 text-sm",children:n.description})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-[#111] p-4 rounded-lg border border-white/5",children:[e.jsx("h5",{className:"text-xs font-bold text-gray-500 uppercase mb-2",children:"Canais"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:n.channels.map(i=>e.jsx("span",{className:"text-xs text-white bg-white/10 px-2 py-1 rounded",children:i},i))})]}),e.jsxs("div",{className:"bg-[#111] p-4 rounded-lg border border-white/5",children:[e.jsx("h5",{className:"text-xs font-bold text-gray-500 uppercase mb-2",children:"Regras"}),e.jsx("ul",{className:"text-xs text-gray-300 space-y-1",children:Object.entries(n.rules).map(([i,j])=>e.jsxs("li",{children:["‚Ä¢ ",e.jsxs("span",{className:"text-gray-500",children:[i,":"]})," ",j]},i))})]})]}),e.jsxs("div",{children:[e.jsxs("h5",{className:"text-xs font-bold text-gray-500 uppercase mb-3 flex items-center gap-2",children:[e.jsx(hs,{size:14})," Tarefas Geradas (",n.tasks.length,")"]}),e.jsx("div",{className:"space-y-2",children:n.tasks.map((i,j)=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-[#111] rounded border border-white/5",children:[e.jsxs("div",{className:"w-6 h-6 rounded-full bg-blue-500/20 flex items-center justify-center text-[10px] text-blue-400 font-mono",children:["D",i.dayOffset]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm text-white font-medium",children:i.title}),e.jsxs("div",{className:"text-xs text-gray-500",children:[i.role," ‚Ä¢ ",i.type]})]})]},j))})]})]}):e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-gray-600",children:[e.jsx(ua,{size:48,className:"mb-4 opacity-20"}),e.jsx("p",{className:"text-sm",children:"Selecione um playbook ao lado para ver os detalhes."})]})})]}),e.jsxs("div",{className:"p-4 border-t border-white/10 bg-[#0A0A0A] flex justify-end gap-3",children:[e.jsx("button",{onClick:a,className:"px-4 py-2 rounded text-xs font-bold text-gray-400 hover:text-white transition-colors",children:"CANCELAR"}),e.jsxs("button",{onClick:o,disabled:!r,"data-testid":"playbook-apply",className:"px-6 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded text-xs font-bold uppercase tracking-wider flex items-center gap-2 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Qs,{size:14}),"Gerar Plano T√°tico"]})]})]})})}const Ft={story_9_16:{id:"story_9_16",label:"Story 9:16",width:1080,height:1920,aspectRatio:"9:16",category:"vertical"},feed_4_5:{id:"feed_4_5",label:"Feed 4:5",width:1080,height:1350,aspectRatio:"4:5",category:"feed"},feed_1_1:{id:"feed_1_1",label:"Feed 1:1",width:1080,height:1080,aspectRatio:"1:1",category:"feed"},landscape_16_9:{id:"landscape_16_9",label:"Landscape 16:9",width:1920,height:1080,aspectRatio:"16:9",category:"horizontal"},youtube_thumbnail:{id:"youtube_thumbnail",label:"YouTube Thumbnail",width:1280,height:720,aspectRatio:"16:9",category:"horizontal"},linkedin_post:{id:"linkedin_post",label:"LinkedIn Post",width:1200,height:627,aspectRatio:"1.91:1",category:"horizontal"},display_300_250:{id:"display_300_250",label:"Display 300√ó250",width:300,height:250,aspectRatio:"6:5",category:"display"},display_728_90:{id:"display_728_90",label:"Leaderboard 728√ó90",width:728,height:90,aspectRatio:"8:1",category:"display"},display_160_600:{id:"display_160_600",label:"Skyscraper 160√ó600",width:160,height:600,aspectRatio:"4:15",category:"display"},display_320_50:{id:"display_320_50",label:"Mobile Banner 320√ó50",width:320,height:50,aspectRatio:"32:5",category:"display"},email_600:{id:"email_600",label:"Email Header 600px",width:600,height:200,aspectRatio:"3:1",category:"email"}};function Ba(t){return Ft[t]||Ft.story_9_16}function Ha(){return Object.values(Ft)}function Wt(t,a){const s=typeof t=="string"?t:"";return s.length<=a?s:`${s.slice(0,Math.max(0,a-1))}‚Ä¶`}function Jt(t){return typeof t!="string"?"":t.replace(/[\r\n\t]+/g," ").replace(/\s{2,}/g," ").trim()}function Zt(t){return String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function Xt(t,a){return typeof t!="string"||!t.trim()?a:t}function qa(t){return`data:image/svg+xml;charset=utf-8,${encodeURIComponent(t).replace(/'/g,"%27").replace(/"/g,"%22")}`}function Ya({format:t,palette:a,headline:s,subheadline:r,cta:l,accentVariant:c}){const n=t.width,o=t.height,i=Xt(a==null?void 0:a.primary,"#F97316"),j=Xt(a==null?void 0:a.secondary,"#1E293B"),w=Xt(a==null?void 0:a.accent,"#10B981"),x=c===2?i:w,g=c===1?w:i,y=Zt(Wt(Jt(s),60)),_=Zt(Wt(Jt(r),120)),z=Zt(Wt(Jt(l),28)),M=Math.round(n*.08),O=Math.round(o*.22),$=Math.round(o*.32),F=Math.round(o*.78);return`<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" width="${n}" height="${o}" viewBox="0 0 ${n} ${o}">
  <defs>
    <linearGradient id="bg" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0" stop-color="${j}"/>
      <stop offset="1" stop-color="#000000"/>
    </linearGradient>
    <linearGradient id="accent" x1="0" y1="0" x2="1" y2="0">
      <stop offset="0" stop-color="${x}"/>
      <stop offset="1" stop-color="${g}"/>
    </linearGradient>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="0" dy="18" stdDeviation="24" flood-color="#000" flood-opacity="0.6"/>
    </filter>
  </defs>

  <rect width="${n}" height="${o}" fill="url(#bg)"/>

  <circle cx="${Math.round(n*.15)}" cy="${Math.round(o*.12)}" r="${Math.round(n*.2)}" fill="${i}" opacity="0.14"/>
  <circle cx="${Math.round(n*.9)}" cy="${Math.round(o*.25)}" r="${Math.round(n*.28)}" fill="${w}" opacity="0.10"/>

  <rect x="${M}" y="${Math.round(o*.12)}" width="${n-M*2}" height="${Math.round(o*.58)}" rx="${Math.round(n*.04)}" fill="#0A0A0A" opacity="0.65" filter="url(#shadow)"/>

  <text x="${M*1.5}" y="${O}" fill="#FFFFFF" font-family="Inter, system-ui, -apple-system, Segoe UI, Roboto" font-size="${Math.round(n*.06)}" font-weight="800">
    ${y}
  </text>

  <text x="${M*1.5}" y="${$}" fill="#CBD5E1" font-family="Inter, system-ui, -apple-system, Segoe UI, Roboto" font-size="${Math.round(n*.032)}" font-weight="500">
    ${_}
  </text>

  <rect x="${M*1.5}" y="${F}" width="${Math.round(n*.5)}" height="${Math.round(o*.08)}" rx="${Math.round(o*.04)}" fill="url(#accent)"/>
  <text x="${M*1.5+Math.round(n*.03)}" y="${F+Math.round(o*.053)}" fill="#0A0A0A" font-family="Inter, system-ui, -apple-system, Segoe UI, Roboto" font-size="${Math.round(n*.03)}" font-weight="800">
    ${z}
  </text>

  <text x="${M*1.5}" y="${Math.round(o*.93)}" fill="#94A3B8" font-family="ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas" font-size="${Math.round(n*.02)}" font-weight="700" opacity="0.9">
    BRAVVO CREATIVE STUDIO v1
  </text>
</svg>`}async function Qa({item:t,vaults:a,formatId:s,variants:r=3,overrides:l=null}){var x,g,y;const c=Ba(s),n=((x=a==null?void 0:a.S5)==null?void 0:x.palette)||{},o=(l==null?void 0:l.headline)||(t==null?void 0:t.initiative)||"Nova Iniciativa",i=(l==null?void 0:l.subheadline)||(t==null?void 0:t.caption)||((y=(g=a==null?void 0:a.S1)==null?void 0:g.fields)==null?void 0:y.promise)||"Plano t√°tico do Bravvo OS",j=(l==null?void 0:l.cta)||"Saiba mais",w=[];for(let _=0;_<Math.max(1,r);_+=1){const z=Ya({format:c,palette:n,headline:o,subheadline:i,cta:j,accentVariant:_%3});w.push({id:`ASSET-${Date.now()}-${_}`,provider:"template",formatId:c.id,width:c.width,height:c.height,svg:z,previewUrl:qa(z)})}return w}const Ut={BASE_URL:"/BravvoOS/",DEV:!1,MODE:"production",PROD:!0,SSR:!1},Xe={ACTIVE:"active",COMING_SOON:"coming_soon",DISABLED:"disabled"},Wa={template:{id:"template",label:"Template",description:"Gera√ß√£o baseada em templates SVG com paleta de marca",status:Xe.ACTIVE,capabilities:["svg","instant","brand_colors"],requiresApiKey:!1,icon:"Layout"},openai_dalle:{id:"openai_dalle",label:"OpenAI DALL-E",description:"Gera√ß√£o de imagens com DALL-E 3",status:Xe.COMING_SOON,capabilities:["ai_generation","photorealistic","creative"],requiresApiKey:!0,apiKeyEnvVar:"VITE_OPENAI_API_KEY",icon:"Sparkles"},midjourney:{id:"midjourney",label:"Midjourney",description:"Arte estilizada com Midjourney",status:Xe.COMING_SOON,capabilities:["ai_generation","artistic","stylized"],requiresApiKey:!0,apiKeyEnvVar:"VITE_MIDJOURNEY_API_KEY",icon:"Palette"},stability:{id:"stability",label:"Stability AI",description:"Gera√ß√£o com Stable Diffusion",status:Xe.COMING_SOON,capabilities:["ai_generation","fast","customizable"],requiresApiKey:!0,apiKeyEnvVar:"VITE_STABILITY_API_KEY",icon:"Zap"},canva:{id:"canva",label:"Canva",description:"Templates profissionais do Canva",status:Xe.COMING_SOON,capabilities:["templates","professional","drag_drop"],requiresApiKey:!0,apiKeyEnvVar:"VITE_CANVA_API_KEY",icon:"PenTool"}};function Ja(t){return Wa[t]||null}async function Za({providerId:t,item:a,vaults:s,formatId:r,variants:l,overrides:c}){const n=Ja(t);if(!n)throw new Error(`Unknown provider: ${t}`);if(n.status===Xe.COMING_SOON)throw new Error(`Provider "${n.label}" coming soon. Use Template for now.`);if(n.status===Xe.DISABLED)throw new Error(`Provider "${n.label}" is currently disabled.`);if(n.requiresApiKey&&!(Ut==null?void 0:Ut[n.apiKeyEnvVar]))throw new Error(`API key not configured for ${n.label}. Set ${n.apiKeyEnvVar} in your .env file.`);switch(t){case"template":return Qa({item:a,vaults:s,formatId:r,variants:l,overrides:c});case"openai_dalle":return Xa({});case"midjourney":return Ua({});case"stability":return er({});case"canva":return tr({});default:throw new Error(`No generator implemented for provider: ${t}`)}}async function Xa({_item:t,_vaults:a,_formatId:s,_variants:r,_overrides:l}){throw new Error("OpenAI DALL-E integration not yet implemented.")}async function Ua({_item:t,_vaults:a,_formatId:s,_variants:r,_overrides:l}){throw new Error("Midjourney integration not yet implemented.")}async function er({_item:t,_vaults:a,_formatId:s,_variants:r,_overrides:l}){throw new Error("Stability AI integration not yet implemented.")}async function tr({_item:t,_vaults:a,_formatId:s,_variants:r,_overrides:l}){throw new Error("Canva integration not yet implemented.")}const _e={instagram:{id:"instagram",label:"Instagram",subchannels:{feed:{id:"feed",label:"Feed",legacyLabel:"Instagram Feed",defaultContentType:"post",allowedCreativeFormats:["feed_4_5","feed_1_1"]},stories:{id:"stories",label:"Stories",legacyLabel:"Instagram Stories",defaultContentType:"story",allowedCreativeFormats:["story_9_16"]},reels:{id:"reels",label:"Reels",legacyLabel:"Instagram Reels",defaultContentType:"reel",allowedCreativeFormats:["story_9_16"]},carousel:{id:"carousel",label:"Carousel",legacyLabel:"Instagram Carousel",defaultContentType:"carousel",allowedCreativeFormats:["feed_4_5","feed_1_1"]}}},tiktok:{id:"tiktok",label:"TikTok",subchannels:{main:{id:"main",label:"Video",legacyLabel:"TikTok",defaultContentType:"reel",allowedCreativeFormats:["story_9_16"]}}},whatsapp:{id:"whatsapp",label:"WhatsApp",subchannels:{status:{id:"status",label:"Status",legacyLabel:"WhatsApp Status",defaultContentType:"story",allowedCreativeFormats:["story_9_16"]},broadcast:{id:"broadcast",label:"Broadcast",legacyLabel:"WhatsApp Lista",defaultContentType:"text",allowedCreativeFormats:["story_9_16"]}}},google_ads:{id:"google_ads",label:"Google Ads",subchannels:{search:{id:"search",label:"Search",legacyLabel:"Google Ads",defaultContentType:"ad",allowedCreativeFormats:["feed_1_1","feed_4_5"]},display:{id:"display",label:"Display",legacyLabel:"Google Ads Display",defaultContentType:"ad",allowedCreativeFormats:["display_300_250","display_728_90","display_160_600","display_320_50"]},youtube_ads:{id:"youtube_ads",label:"YouTube Ads",legacyLabel:"Google YouTube Ads",defaultContentType:"video_ad",allowedCreativeFormats:["landscape_16_9","youtube_thumbnail"]}}},youtube:{id:"youtube",label:"YouTube",subchannels:{video:{id:"video",label:"Video",legacyLabel:"YouTube Video",defaultContentType:"video",allowedCreativeFormats:["landscape_16_9","youtube_thumbnail"]},shorts:{id:"shorts",label:"Shorts",legacyLabel:"YouTube Shorts",defaultContentType:"short",allowedCreativeFormats:["story_9_16"]},community:{id:"community",label:"Community",legacyLabel:"YouTube Community",defaultContentType:"post",allowedCreativeFormats:["feed_1_1","landscape_16_9"]}}},linkedin:{id:"linkedin",label:"LinkedIn",subchannels:{post:{id:"post",label:"Post",legacyLabel:"LinkedIn Post",defaultContentType:"post",allowedCreativeFormats:["linkedin_post","feed_1_1"]},article:{id:"article",label:"Article",legacyLabel:"LinkedIn Article",defaultContentType:"article",allowedCreativeFormats:["linkedin_post"]},ads:{id:"ads",label:"Ads",legacyLabel:"LinkedIn Ads",defaultContentType:"ad",allowedCreativeFormats:["linkedin_post","feed_1_1"]}}},facebook:{id:"facebook",label:"Facebook",subchannels:{feed:{id:"feed",label:"Feed",legacyLabel:"Facebook Feed",defaultContentType:"post",allowedCreativeFormats:["feed_4_5","feed_1_1","landscape_16_9"]},stories:{id:"stories",label:"Stories",legacyLabel:"Facebook Stories",defaultContentType:"story",allowedCreativeFormats:["story_9_16"]},reels:{id:"reels",label:"Reels",legacyLabel:"Facebook Reels",defaultContentType:"reel",allowedCreativeFormats:["story_9_16"]},ads:{id:"ads",label:"Ads",legacyLabel:"Facebook Ads",defaultContentType:"ad",allowedCreativeFormats:["feed_4_5","feed_1_1","story_9_16"]}}},twitter:{id:"twitter",label:"X (Twitter)",subchannels:{tweet:{id:"tweet",label:"Tweet",legacyLabel:"Twitter Tweet",defaultContentType:"post",allowedCreativeFormats:["feed_1_1","landscape_16_9"]},ads:{id:"ads",label:"Ads",legacyLabel:"Twitter Ads",defaultContentType:"ad",allowedCreativeFormats:["feed_1_1","landscape_16_9"]}}},email:{id:"email",label:"Email",subchannels:{newsletter:{id:"newsletter",label:"Newsletter",legacyLabel:"Email Newsletter",defaultContentType:"email",allowedCreativeFormats:["email_600"]},promotional:{id:"promotional",label:"Promotional",legacyLabel:"Email Promocional",defaultContentType:"email",allowedCreativeFormats:["email_600"]}}},blog:{id:"blog",label:"Blog",subchannels:{article:{id:"article",label:"Article",legacyLabel:"Blog Article",defaultContentType:"article",allowedCreativeFormats:["landscape_16_9","linkedin_post"]}}}};function Mt(){return Object.values(_e).map(t=>({id:t.id,label:t.label}))}function Lt(t){const a=_e[t];return a?Object.values(a.subchannels).map(s=>({id:s.id,label:s.label,legacyLabel:s.legacyLabel,defaultContentType:s.defaultContentType,allowedCreativeFormats:s.allowedCreativeFormats})):[]}function Ke(t){const a=_e[t];return(a?Object.keys(a.subchannels)[0]:null)||null}function ze(t,a){var r,l;const s=(l=(r=_e==null?void 0:_e[t])==null?void 0:r.subchannels)==null?void 0:l[a];return(s==null?void 0:s.legacyLabel)||"Instagram Feed"}function ds(t,a){var l,c;const s=(c=(l=_e==null?void 0:_e[t])==null?void 0:l.subchannels)==null?void 0:c[a];return(Array.isArray(s==null?void 0:s.allowedCreativeFormats)?s.allowedCreativeFormats:[]).filter(n=>!!Ft[n])}function es(t,a){return ds(t,a)[0]||"story_9_16"}function Ye(t,a){var r,l;const s=(l=(r=_e==null?void 0:_e[t])==null?void 0:r.subchannels)==null?void 0:l[a];return(s==null?void 0:s.defaultContentType)||"post"}function Ot(t){var s;if(typeof t!="string")return{channelId:"instagram",subchannelId:"feed"};const a=t.trim().toLowerCase();for(const r of Object.values(_e))for(const l of Object.values(r.subchannels))if(((s=l.legacyLabel)==null?void 0:s.toLowerCase())===a)return{channelId:r.id,subchannelId:l.id};return a.includes("story")?{channelId:"instagram",subchannelId:"stories"}:a.includes("reel")?{channelId:"instagram",subchannelId:"reels"}:a.includes("tiktok")?{channelId:"tiktok",subchannelId:"main"}:a.includes("whatsapp")?{channelId:"whatsapp",subchannelId:"status"}:a.includes("google")?{channelId:"google_ads",subchannelId:"search"}:{channelId:"instagram",subchannelId:"feed"}}function sr(t,a){const s=document.createElement("a");s.href=t,s.download=a,document.body.appendChild(s),s.click(),s.remove()}async function ar(t,a,s){const r=new Image;r.crossOrigin="anonymous",await new Promise((n,o)=>{r.onload=n,r.onerror=o,r.src=t});const l=document.createElement("canvas");return l.width=a,l.height=s,l.getContext("2d").drawImage(r,0,0,a,s),l.toDataURL("image/png")}function rr({open:t,onClose:a,item:s,vaults:r,onSave:l,onGeneratePrompt:c}){var te,ve,Se,ye;const n=m.useMemo(()=>Ha(),[]),o=((ve=(te=r==null?void 0:r.S1)==null?void 0:te.fields)==null?void 0:ve.promise)||"",[i,j]=m.useState("template"),[w,x]=m.useState("instagram"),[g,y]=m.useState("feed"),[_,z]=m.useState(((Se=n[0])==null?void 0:Se.id)||"story_9_16"),[M,O]=m.useState(!1),[$,F]=m.useState({headline:"",subheadline:"",cta:""}),[T,G]=m.useState(!1),[q,W]=m.useState([]),[ie,R]=m.useState(null);if(m.useEffect(()=>{t||(W([]),R(null),O(!1))},[t]),m.useEffect(()=>{if(!t||!s)return;const E=Ot(s.channel||"Instagram Feed"),X=s.channelId||E.channelId||"instagram",xe=s.subchannelId||E.subchannelId||Ke(X)||"feed";x(X),y(xe),z(Ae=>ds(X,xe).includes(Ae)?Ae:es(X,xe)),F({headline:s.initiative||"",subheadline:s.caption||o,cta:"Saiba mais"})},[t,s,o]),!t||!s)return null;const Y=ds(w,g),ne=Y.length>0?n.filter(E=>Y.includes(E.id)):n,le=ne.some(E=>E.id===_)?_:((ye=ne[0])==null?void 0:ye.id)||"story_9_16",se={headline:($.headline||"").trim(),subheadline:($.subheadline||"").trim(),cta:($.cta||"").trim()},oe=Object.values(se).some(E=>!!E)?se:null,L=q.find(E=>E.id===ie)||q[0]||null,ee=async()=>{if(typeof c!="function")return;const E={...s,channelId:w,subchannelId:g,channel:ze(w,g)};await c(E),a()},ae=async()=>{var E;G(!0);try{const X={...s,channelId:w,subchannelId:g,channel:ze(w,g)},xe=await Za({providerId:i,item:X,vaults:r,formatId:le,variants:3,overrides:oe});W(xe),R(((E=xe[0])==null?void 0:E.id)||null)}finally{G(!1)}},me=async()=>{if(!L)return;const X=`${((s==null?void 0:s.initiative)||"creative").toLowerCase().replace(/[^a-z0-9]+/g,"-").slice(0,40)}-${L.formatId}.png`,xe=await ar(L.previewUrl,L.width,L.height);sr(xe,X)},pe=async()=>{L&&(l({id:`${L.id}`,itemId:s.id,provider:L.provider,channelId:w,subchannelId:g,channel:ze(w,g),formatId:L.formatId,width:L.width,height:L.height,createdAt:new Date().toISOString(),previewUrl:L.previewUrl,svg:L.svg,overrides:oe}),a())};return e.jsx("div",{className:"fixed inset-0 z-[120] bg-black/80 backdrop-blur-sm flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-[#0A0A0A] border border-white/10 rounded-lg w-full max-w-5xl animate-fadeIn flex flex-col max-h-[92vh] shadow-2xl overflow-hidden",children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-white/10 bg-[#0A0A0A]",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-bold text-white uppercase tracking-widest flex items-center gap-2",children:["Creative Studio",e.jsx("span",{className:"text-[9px] bg-purple-500/20 text-purple-300 px-1.5 py-0.5 rounded border border-purple-500/30 normal-case tracking-normal font-mono",children:"Beta"})]}),e.jsxs("p",{className:"text-[10px] text-gray-500 font-mono",children:["Item: ",s.initiative||s.id]})]}),e.jsx("button",{onClick:a,className:"text-gray-500 hover:text-white p-2","data-testid":"creative-close",children:e.jsx(Ge,{size:16})})]}),e.jsxs("div",{className:"flex-1 overflow-hidden grid grid-cols-1 lg:grid-cols-[360px_1fr]",children:[e.jsx("div",{className:"border-r border-white/10 p-4 overflow-y-auto custom-scrollbar",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-label",children:"Provider"}),e.jsxs("select",{className:"premium-input bg-[#111]",value:i,onChange:E=>j(E.target.value),"data-testid":"creative-provider",children:[e.jsx("option",{value:"template",children:"Template"}),e.jsx("option",{value:"ai",children:"IDF Prompt"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-label",children:"Formato"}),e.jsx("select",{className:"premium-input bg-[#111]",value:le,onChange:E=>z(E.target.value),"data-testid":"creative-format",children:ne.map(E=>e.jsx("option",{value:E.id,children:E.label},E.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-label",children:"Canal"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("select",{className:"premium-input bg-[#111]",value:w,onChange:E=>{const X=E.target.value,xe=Ke(X)||"";x(X),y(xe),z(es(X,xe))},"data-testid":"creative-channel",children:Mt().map(E=>e.jsx("option",{value:E.id,children:E.label},E.id))}),e.jsx("select",{className:"premium-input bg-[#111]",value:g,onChange:E=>{const X=E.target.value;y(X),z(es(w,X))},"data-testid":"creative-subchannel",children:Lt(w).map(E=>e.jsx("option",{value:E.id,children:E.label},E.id))})]})]}),e.jsxs("div",{className:"bento-grid p-3",children:[e.jsx("button",{type:"button",onClick:()=>O(E=>!E),className:"w-full text-left text-[10px] font-bold uppercase tracking-wider text-gray-400 hover:text-white transition-colors","data-testid":"creative-advanced-toggle",children:M?"Editor Avan√ßado: ON":"Editor Avan√ßado: OFF"}),M&&e.jsxs("div",{className:"mt-3 space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-label",children:"Headline"}),e.jsx("input",{className:"premium-input bg-[#111]",value:$.headline,onChange:E=>F(X=>({...X,headline:E.target.value})),"data-testid":"creative-override-headline"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-label",children:"Subheadline"}),e.jsx("textarea",{className:"premium-input bg-[#111] min-h-[90px]",value:$.subheadline,onChange:E=>F(X=>({...X,subheadline:E.target.value})),"data-testid":"creative-override-subheadline"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-label",children:"CTA"}),e.jsx("input",{className:"premium-input bg-[#111]",value:$.cta,onChange:E=>F(X=>({...X,cta:E.target.value})),"data-testid":"creative-override-cta"})]})]})]}),i==="ai"?e.jsxs("button",{type:"button",onClick:ee,className:"btn-primary w-full flex items-center justify-center gap-2",disabled:T,"data-testid":"creative-generate-prompt",children:[e.jsx(rs,{size:14}),T?"Gerando...":"Gerar Prompt (IDF)"]}):e.jsxs("button",{onClick:ae,className:"btn-primary w-full flex items-center justify-center gap-2",disabled:T,"data-testid":"creative-generate",children:[e.jsx(rs,{size:14}),T?"Gerando...":"Gerar varia√ß√µes"]}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:q.map(E=>e.jsx("button",{onClick:()=>R(E.id),className:`border rounded overflow-hidden transition-colors ${E.id===(L==null?void 0:L.id)?"border-purple-500/70":"border-white/10 hover:border-white/20"}`,title:E.id,type:"button","data-testid":`creative-variant-${E.id}`,children:e.jsx("img",{src:E.previewUrl,alt:"variant",className:"w-full h-20 object-cover"})},E.id))})]})}),e.jsx("div",{className:"p-4 overflow-y-auto custom-scrollbar",children:L?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bento-grid p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-xs text-gray-400 font-mono",children:[L.formatId," ‚Ä¢ ",L.width,"√ó",L.height]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:me,className:"btn-ghost !h-8 !px-3","data-testid":"creative-download",children:e.jsx(ns,{size:14})}),e.jsx("button",{onClick:pe,className:"btn-primary !h-8 !px-3","data-testid":"creative-save",children:e.jsx(Ce,{size:14})})]})]})}),e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("img",{src:L.previewUrl,alt:"preview",className:"max-h-[70vh] rounded-lg border border-white/10"})})]}):e.jsx("div",{className:"h-full flex items-center justify-center text-gray-600",children:"Selecione um formato e gere varia√ß√µes."})})]})]})})}const Ls=[{id:"kpis_reviewed",label:"KPIs revisados e atualizados",checked:!1},{id:"roadmap_reviewed",label:"Roadmap da semana validado",checked:!1},{id:"blockers_identified",label:"Bloqueios identificados",checked:!1},{id:"priorities_aligned",label:"Prioridades alinhadas com time",checked:!1},{id:"vaults_updated",label:"Vaults atualizados (se necess√°rio)",checked:!1}];function nr({open:t,onClose:a,onSave:s,governanceData:r,kpis:l}){const[c,n]=m.useState(Ls),[o,i]=m.useState(""),[j,w]=m.useState(""),[x,g]=m.useState({revenue:"",traffic:"",sales:""}),[y,_]=m.useState(["","",""]);m.useEffect(()=>{r&&(n(r.checklist||Ls),i(r.decisions||""),w(r.learnings||""),g(r.goalAdjustments||{revenue:"",traffic:"",sales:""}),_(r.priorities||["","",""]))},[r]);const z=F=>{n(T=>T.map(G=>G.id===F?{...G,checked:!G.checked}:G))},M=()=>{const F={checklist:c,decisions:o,learnings:j,goalAdjustments:x,priorities:y.filter(T=>T.trim()!==""),completedAt:new Date().toISOString(),checklistProgress:c.filter(T=>T.checked).length/c.length};s(F),a()},O=c.filter(F=>F.checked).length,$=O/c.length*100;return t?e.jsx("div",{className:"fixed inset-0 z-[100] bg-black/80 backdrop-blur-sm flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-[#0A0A0A] border border-white/10 rounded-xl w-full max-w-3xl max-h-[90vh] flex flex-col shadow-2xl animate-fadeIn",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-white/10",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-white",children:"Governan√ßa"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Checklist de revis√£o e decis√µes do ciclo"})]}),e.jsx("button",{onClick:a,className:"p-2 hover:bg-white/10 rounded-lg transition-colors",children:e.jsx(Ge,{size:18,className:"text-gray-400"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[e.jsxs("div",{className:"bg-[#111] rounded-lg p-4 border border-white/5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider",children:"Progresso do Checklist"}),e.jsxs("span",{className:"text-sm font-mono text-white",children:[O,"/",c.length]})]}),e.jsx("div",{className:"h-2 bg-white/5 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full transition-all duration-500 ${$===100?"bg-green-500":$>=60?"bg-yellow-500":"bg-red-500"}`,style:{width:`${$}%`}})})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"flex items-center gap-2 text-sm font-bold text-white mb-3",children:[e.jsx(Ce,{size:16,className:"text-green-500"}),"Checklist de Revis√£o"]}),e.jsx("div",{className:"space-y-2",children:c.map(F=>e.jsxs("button",{onClick:()=>z(F.id),className:`w-full flex items-center gap-3 p-3 rounded-lg border transition-all ${F.checked?"bg-green-500/10 border-green-500/30 text-green-400":"bg-[#111] border-white/5 text-gray-400 hover:border-white/20"}`,children:[F.checked?e.jsx(Ce,{size:18,className:"text-green-500 shrink-0"}):e.jsx(Bs,{size:18,className:"text-gray-600 shrink-0"}),e.jsx("span",{className:"text-sm text-left",children:F.label})]},F.id))})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"flex items-center gap-2 text-sm font-bold text-white mb-3",children:[e.jsx(Ue,{size:16,className:"text-blue-500"}),"Decis√µes Tomadas"]}),e.jsx("textarea",{value:o,onChange:F=>i(F.target.value),placeholder:"O que foi decidido neste ciclo? Ex: pausar campanha X, aumentar budget em Y...",className:"w-full h-24 bg-[#111] border border-white/10 rounded-lg p-3 text-sm text-white placeholder-gray-600 focus:outline-none focus:border-blue-500/50 resize-none"})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"flex items-center gap-2 text-sm font-bold text-white mb-3",children:[e.jsx(ms,{size:16,className:"text-yellow-500"}),"Aprendizados"]}),e.jsx("textarea",{value:j,onChange:F=>w(F.target.value),placeholder:"O que aprendemos? Ex: melhor hor√°rio de postagem, tipo de conte√∫do que performou...",className:"w-full h-24 bg-[#111] border border-white/10 rounded-lg p-3 text-sm text-white placeholder-gray-600 focus:outline-none focus:border-yellow-500/50 resize-none"})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"flex items-center gap-2 text-sm font-bold text-white mb-3",children:[e.jsx(Qe,{size:16,className:"text-orange-500"}),"Ajustes de Meta (opcional)"]}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:Object.entries(x).map(([F,T])=>{var G;return e.jsxs("div",{className:"bg-[#111] border border-white/5 rounded-lg p-3",children:[e.jsx("label",{className:"text-[10px] font-bold text-gray-500 uppercase tracking-wider block mb-2",children:F==="revenue"?"Receita":F==="traffic"?"Tr√°fego":"Vendas"}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsxs("span",{className:"text-gray-500 text-xs",children:["Meta atual: ",((G=l==null?void 0:l[F])==null?void 0:G.goal)||0]})}),e.jsx("input",{type:"number",value:T,onChange:q=>g(W=>({...W,[F]:q.target.value})),placeholder:"Nova meta",className:"w-full mt-2 bg-black/50 border border-white/10 rounded px-2 py-1 text-sm text-white focus:outline-none focus:border-orange-500/50"})]},F)})})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"flex items-center gap-2 text-sm font-bold text-white mb-3",children:[e.jsx(is,{size:16,className:"text-purple-500"}),"Top 3 Prioridades (pr√≥ximo ciclo)"]}),e.jsx("div",{className:"space-y-2",children:y.map((F,T)=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"w-6 h-6 flex items-center justify-center bg-purple-500/20 text-purple-400 rounded text-xs font-bold",children:T+1}),e.jsx("input",{type:"text",value:F,onChange:G=>{const q=[...y];q[T]=G.target.value,_(q)},placeholder:`Prioridade ${T+1}`,className:"flex-1 bg-[#111] border border-white/10 rounded-lg px-3 py-2 text-sm text-white placeholder-gray-600 focus:outline-none focus:border-purple-500/50"})]},T))})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-6 border-t border-white/10 bg-[#080808]",children:[e.jsx("div",{className:"text-xs text-gray-500",children:$<100&&e.jsx("span",{className:"text-yellow-500",children:"‚ö†Ô∏è Complete o checklist antes de salvar"})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:a,className:"px-4 py-2 text-sm font-medium text-gray-400 hover:text-white transition-colors",children:"Cancelar"}),e.jsx("button",{onClick:M,className:`px-6 py-2 rounded-lg text-sm font-bold transition-all ${$===100?"bg-green-600 text-white hover:bg-green-500":"bg-purple-600 text-white hover:bg-purple-500"}`,children:$===100?"Fechar Ciclo":"Salvar Rascunho"})]})]})]})}):null}const Vs=[{id:"execution",label:"Execu√ß√£o",icon:"‚ö°",color:"blue"},{id:"production",label:"Produ√ß√£o",icon:"üé®",color:"purple"},{id:"strategy",label:"Estrat√©gia",icon:"üéØ",color:"green"},{id:"blocker",label:"Bloqueio",icon:"üöß",color:"red"},{id:"insight",label:"Insight",icon:"üí°",color:"yellow"},{id:"general",label:"Assuntos Gerais",icon:"üìù",color:"gray"}],ir={done:{label:"Conclu√≠do",color:"green",icon:"‚úÖ"},delayed:{label:"Atrasado",color:"red",icon:"‚ö†Ô∏è"},cancelled:{label:"Cancelado",color:"gray",icon:"‚ùå"},pending:{label:"Pendente",color:"yellow",icon:"‚è≥"},in_production:{label:"Em Produ√ß√£o",color:"blue",icon:"üîÑ"}};function lr(t){var G,q,W,ie,R,Y,ne,le,se,oe,L;const{period:a,periodStartDate:s,periodEndDate:r,closedAt:l,timezone:c,responsible:n,type:o,kpiSnapshot:i,goalChanges:j,meetingTimer:w,kpiNotes:x,roadmapReview:g,productionAnalysis:y,executionAnalysis:_,blockNotes:z,observations:M,decisions:O,learnings:$,priorities:F}=t;return{id:`ATA-${Date.now()}`,version:1,immutable:!0,signature:{period:a||`${new Date().toLocaleDateString("pt-BR")}`,periodStartDate:s||"",periodEndDate:r||"",closedAt:l||new Date().toISOString(),timezone:c||Intl.DateTimeFormat().resolvedOptions().timeZone,responsible:n||"Sistema",type:o||"weekly"},kpis:{revenue:{value:((G=i==null?void 0:i.revenue)==null?void 0:G.value)||0,goal:((q=i==null?void 0:i.revenue)==null?void 0:q.goal)||0,gap:(((W=i==null?void 0:i.revenue)==null?void 0:W.goal)||0)-(((ie=i==null?void 0:i.revenue)==null?void 0:ie.value)||0),achievement:((R=i==null?void 0:i.revenue)==null?void 0:R.goal)>0?(((Y=i==null?void 0:i.revenue)==null?void 0:Y.value)/((ne=i==null?void 0:i.revenue)==null?void 0:ne.goal)*100).toFixed(1):0},traffic:{value:((le=i==null?void 0:i.traffic)==null?void 0:le.value)||0,goal:((se=i==null?void 0:i.traffic)==null?void 0:se.goal)||0},sales:{value:((oe=i==null?void 0:i.sales)==null?void 0:oe.value)||0,goal:((L=i==null?void 0:i.sales)==null?void 0:L.goal)||0}},goalChanges:Array.isArray(j)?j:[],meetingTimer:w||null,kpiNotes:x||{},roadmapSummary:{total:(g==null?void 0:g.total)||0,done:(g==null?void 0:g.done)||0,delayed:(g==null?void 0:g.delayed)||0,cancelled:(g==null?void 0:g.cancelled)||0,pending:(g==null?void 0:g.pending)||0,executionRate:(g==null?void 0:g.total)>0?((g==null?void 0:g.done)/(g==null?void 0:g.total)*100).toFixed(1):0},production:{generated:(y==null?void 0:y.generated)||0,approved:(y==null?void 0:y.approved)||0,published:(y==null?void 0:y.published)||0,notExecuted:(y==null?void 0:y.notExecuted)||0},execution:{trafficImpact:(_==null?void 0:_.trafficImpact)||"neutral",salesImpact:(_==null?void 0:_.salesImpact)||"neutral",topPerformers:(_==null?void 0:_.topPerformers)||[],lowPerformers:(_==null?void 0:_.lowPerformers)||[]},decisions:O||[],whatWorked:($==null?void 0:$.worked)||[],whatFailed:($==null?void 0:$.failed)||[],changesToMake:($==null?void 0:$.changes)||[],risks:($==null?void 0:$.risks)||[],observations:M||[],blockNotes:z||{},nextPriorities:F||[],metadata:{createdAt:new Date().toISOString(),format:"structured",linkable:!0,auditable:!0}}}function or(t,a,s){return{timestamp:new Date().toISOString(),suggestedKpis:{revenue:{newGoal:ts(t.kpis.revenue),adjustment:t.kpis.revenue.gap>0?"increase_focus":"maintain"},traffic:{newGoal:ts(t.kpis.traffic)},sales:{newGoal:ts(t.kpis.sales)}},executionFocus:dr(t,a),alerts:cr(t),dailyOrders:ur(t,a),vaultWeights:xr(t,a),roadmapPriorities:mr(t,s)}}function cs(t,a="weekly",s){var w,x,g;const r=y=>y.toISOString().split("T")[0],l=(w=t==null?void 0:t.signature)==null?void 0:w.periodEndDate,c=new Date,n=(()=>{if(l){const _=new Date(l);if(!Number.isNaN(_.getTime()))return _.setHours(0,0,0,0),_}const y=new Date(c);return y.setHours(0,0,0,0),y})();let o=new Date(n);o.setDate(o.getDate()+1);let i=new Date(o),j=new Date(o);if(a==="daily")i=new Date(o),i.setHours(23,59,59),j=new Date(o);else if(a==="weekly"){const y=Number.isFinite(s==null?void 0:s.weekStartDay)?s.weekStartDay:1,_=Number.isFinite(s==null?void 0:s.meetingWeekday)?s.meetingWeekday:1,z=o.getDay(),M=(y-z+7)%7;o.setDate(o.getDate()+M),i=new Date(o),i.setDate(i.getDate()+6),i.setHours(23,59,59);const O=(_-o.getDay()+7)%7;j=new Date(o),j.setDate(j.getDate()+O)}else if(a==="monthly"){const y=Number.isFinite(s==null?void 0:s.monthlyMeetingDay)?s.monthlyMeetingDay:1,_=new Date(o.getFullYear(),o.getMonth(),1),z=new Date(o.getFullYear(),o.getMonth()+1,0);o=_,i=z,i.setHours(23,59,59);const M=z.getDate(),O=Math.max(1,Math.min(y,M));j=new Date(_),j.setDate(O)}else i=new Date(o),i.setDate(i.getDate()+6),i.setHours(23,59,59),j=new Date(o);return{id:`GOV-WINDOW-${Date.now()}`,frequency:a,startDate:r(o),endDate:r(i),scheduledGovernance:j.toISOString(),periodGoals:{focus:((x=t.nextPriorities)==null?void 0:x[0])||"Execu√ß√£o geral",kpiTargets:{revenue:t.kpis.revenue.goal,traffic:t.kpis.traffic.goal,sales:t.kpis.sales.goal}},anticipatedRisks:t.risks||[],initialOrders:((g=t.nextPriorities)==null?void 0:g.slice(0,3))||[],status:"scheduled"}}function ts(t){if(!t.goal)return 0;const a=t.value/t.goal;return a>=1.2?Math.round(t.goal*1.1):(a>=.9,t.goal)}function dr(t,a){const s=[];if(t.roadmapSummary.executionRate<70&&s.push({type:"execution",priority:"high",message:"Taxa de execu√ß√£o baixa - priorizar entregas"}),t.production.notExecuted>t.production.published&&s.push({type:"production",priority:"medium",message:"Muitas artes n√£o publicadas - revisar fluxo"}),parseFloat(t.kpis.revenue.achievement)<80&&s.push({type:"revenue",priority:"high",message:"Revenue abaixo da meta - intensificar vendas"}),a!=null&&a.S3){const r=a.S3;r.trafficType==="Pago"&&t.kpis.traffic.value<t.kpis.traffic.goal&&s.push({type:"growth",priority:"high",message:"Tr√°fego Pago abaixo da meta - revisar campanhas"}),r.primaryCTA&&s.push({type:"conversion",priority:"medium",message:`Otimizar convers√£o para ${r.primaryCTA}`})}return s}function cr(t){var s;const a=[];return t.roadmapSummary.delayed>0&&a.push({type:"warning",title:`${t.roadmapSummary.delayed} item(s) atrasado(s)`,action:"Revisar prazos"}),((s=t.risks)==null?void 0:s.length)>0&&a.push({type:"risk",title:`${t.risks.length} risco(s) identificado(s)`,action:"Mitigar riscos"}),a}function ur(t,a){var r,l;const s=[];return(r=t.nextPriorities)==null||r.slice(0,3).forEach((c,n)=>{s.push({id:`ORDER-${Date.now()}-${n}`,priority:n+1,title:c,source:"governance"})}),(l=a==null?void 0:a.S3)!=null&&l.channels&&a.S3.channels.length>0&&s.length<5&&s.push({id:`ORDER-V3-${Date.now()}`,priority:s.length+1,title:`Verificar m√©tricas de ${a.S3.channels[0]}`,source:"strategy"}),s}function xr(t,a){var r;const s={V1:1,V2:1,V3:1,V4:1,V5:.8};return t.kpis.revenue.gap>0&&(s.V2+=.5),((r=a==null?void 0:a.S3)==null?void 0:r.trafficType)==="Org√¢nico"&&t.production.published<3&&(s.V3+=.3),t.roadmapSummary.delayed>0&&(s.V4+=.4),s}function mr(t,a){return!a||a.length===0?[]:a.filter(s=>s.status==="draft"||s.status==="pending").sort((s,r)=>{const l=new Date(s.date),c=new Date(r.date);return l-c}).slice(0,10).map((s,r)=>({...s,governancePriority:r+1}))}function hr(t){const a=Array.isArray(t==null?void 0:t.goalChanges)?t.goalChanges:[],s=t!=null&&t.kpiNotes&&typeof t.kpiNotes=="object"?t.kpiNotes:{},r=t!=null&&t.meetingTimer&&typeof t.meetingTimer=="object"?t.meetingTimer:null,l=n=>{const o=Number(n)||0,i=String(Math.floor(o/60)).padStart(2,"0"),j=String(Math.floor(o%60)).padStart(2,"0");return`${i}:${j}`},c=[s!=null&&s.revenue?`Receita: ${s.revenue}`:null,s!=null&&s.traffic?`Tr√°fego: ${s.traffic}`:null,s!=null&&s.sales?`Vendas: ${s.sales}`:null].filter(Boolean);return{title:`ATA de Governan√ßa - ${t.signature.period}`,subtitle:`${t.signature.type==="weekly"?"Semanal":t.signature.type==="daily"?"Di√°ria":"Mensal"} | ${new Date(t.signature.closedAt).toLocaleString("pt-BR")}${r!=null&&r.durationSeconds?` | Dura√ß√£o: ${l(r.durationSeconds)}`:""}`,sections:[{title:"KPIs do Per√≠odo",items:[`Receita: R$ ${t.kpis.revenue.value.toLocaleString()} / Meta: R$ ${t.kpis.revenue.goal.toLocaleString()} (${t.kpis.revenue.achievement}%)`,`Vendas: ${t.kpis.sales.value} / Meta: ${t.kpis.sales.goal}`,`Tr√°fego: R$ ${t.kpis.traffic.value} investido`]},...c.length>0?[{title:"Notas por KPI",items:c}]:[],...a.length>0?[{title:"Metas Alteradas",items:a.map(n=>{const o=n.id==="revenue"?"Receita":n.id==="traffic"?"Tr√°fego":n.id==="sales"?"Vendas":String(n.id),i=n.changedAt?new Date(n.changedAt).toLocaleString("pt-BR"):"";return`${o}: ${n.fromGoal} ‚Üí ${n.toGoal}${i?` (${i})`:""}`})}]:[],{title:"Execu√ß√£o",items:[`Taxa de Execu√ß√£o: ${t.roadmapSummary.executionRate}%`,`Conclu√≠dos: ${t.roadmapSummary.done} | Atrasados: ${t.roadmapSummary.delayed} | Cancelados: ${t.roadmapSummary.cancelled}`]},{title:"Produ√ß√£o",items:[`Artes Geradas: ${t.production.generated}`,`Aprovadas: ${t.production.approved} | Publicadas: ${t.production.published}`]},{title:"Decis√µes",items:t.decisions.length>0?t.decisions:["Nenhuma decis√£o registrada"]},{title:"Pr√≥ximas Prioridades",items:t.nextPriorities.length>0?t.nextPriorities:["Nenhuma prioridade definida"]}],signature:`Fechado por: ${t.signature.responsible} | ${t.signature.timezone}`}}const $t=[{id:"period_summary",label:"Resumo do Per√≠odo",icon:Ws},{id:"roadmap_review",label:"Roadmap T√°tico",icon:ke},{id:"production_analysis",label:"An√°lise de Produ√ß√£o",icon:bs},{id:"execution_analysis",label:"An√°lise de Execu√ß√£o",icon:et},{id:"observations",label:"Observa√ß√µes",icon:gs}];function gr({open:t,onClose:a,onComplete:s,kpis:r,roadmapItems:l=[],vaults:c,governanceFrequency:n="weekly",currentWindow:o,calendarRule:i,currentUser:j,variant:w="modal",lastGovernance:x=null}){var wt,Nt,Ct,St,At,It,mt;const{addToast:g}=zt(),[y,_]=m.useState(0),[z,M]=m.useState(!1),[O,$]=m.useState(null),[F,T]=m.useState(!1),[G,q]=m.useState(null),[W,ie]=m.useState(null),[R,Y]=m.useState(null),[ne,le]=m.useState(0),[se,oe]=m.useState(!0),[L,ee]=m.useState({startDate:"",endDate:"",notes:""}),[ae,me]=m.useState({roadmap:"",production:"",execution:""}),pe=m.useRef(null),[te,ve]=m.useState({}),[Se,ye]=m.useState({}),[E,X]=m.useState({revenue:"",traffic:"",sales:""}),[xe,Ae]=m.useState(null);m.useEffect(()=>{t&&(Y(new Date().toISOString()),le(0),oe(!0))},[t]),m.useEffect(()=>{if(!t||!se)return;const u=setInterval(()=>{le(v=>v+1)},1e3);return()=>clearInterval(u)},[t,se]),m.useEffect(()=>{var v,I,D;if(!t)return;const u={revenue:((v=r==null?void 0:r.revenue)==null?void 0:v.goal)||0,traffic:((I=r==null?void 0:r.traffic)==null?void 0:I.goal)||0,sales:((D=r==null?void 0:r.sales)==null?void 0:D.goal)||0};pe.current||(pe.current=u),ve(V=>V&&Object.keys(V).length>0?V:u)},[t,(wt=r==null?void 0:r.revenue)==null?void 0:wt.goal,(Nt=r==null?void 0:r.traffic)==null?void 0:Nt.goal,(Ct=r==null?void 0:r.sales)==null?void 0:Ct.goal]),m.useEffect(()=>{if(!t||L.startDate&&L.endDate)return;const u=D=>D.toISOString().split("T")[0],v=new Date,I=new Date(v);if(I.setHours(0,0,0,0),o!=null&&o.startDate&&(o!=null&&o.endDate)){ee(D=>({...D,startDate:D.startDate||o.startDate,endDate:D.endDate||o.endDate}));return}if(n==="daily"){const D=u(I);ee(V=>({...V,startDate:V.startDate||D,endDate:V.endDate||D}));return}if(n==="weekly"){const D=I.getDay(),V=Number.isFinite(i==null?void 0:i.weekStartDay)?i.weekStartDay:1,ue=(D-V+7)%7,Te=new Date(I);Te.setDate(Te.getDate()-ue);const De=new Date(Te);De.setDate(De.getDate()+6),ee(Pe=>({...Pe,startDate:Pe.startDate||u(Te),endDate:Pe.endDate||u(De)}));return}if(n==="monthly"){const D=new Date(I.getFullYear(),I.getMonth(),1),V=new Date(I.getFullYear(),I.getMonth()+1,0);ee(ue=>({...ue,startDate:ue.startDate||u(D),endDate:ue.endDate||u(V)}))}},[t,o,n,L.startDate,L.endDate,i==null?void 0:i.weekStartDay]);const[ge,je]=m.useState(l.map(u=>({...u,governanceStatus:u.status||"pending",observation:""}))),[de,Me]=m.useState({generated:0,approved:0,published:0,notExecuted:0}),[we,h]=m.useState({trafficImpact:"neutral",salesImpact:"neutral",topPerformers:["","",""],lowPerformers:["","",""]}),[B,H]=m.useState(Vs.map(u=>({categoryId:u.id,categoryLabel:u.label,items:[]}))),[U,he]=m.useState([""]),[ce,Be]=m.useState({worked:[""],failed:[""],changes:[""],risks:[""]}),[lt,bt]=m.useState(["","",""]),[We,ot]=m.useState(null),[Je,pt]=m.useState(!1),Ne=m.useMemo(()=>{const u={total:ge.length,done:0,delayed:0,cancelled:0,pending:0,in_production:0};return ge.forEach(v=>{u[v.governanceStatus]!==void 0&&u[v.governanceStatus]++}),u},[ge]),dt=u=>{u>=0&&u<$t.length&&_(u)},ft=()=>dt(y+1),Ze=()=>dt(y-1),Vt=u=>{H(v=>v.map(I=>I.categoryId===u?{...I,items:[...I.items,{id:Date.now(),text:""}]}:I))},vt=(u,v,I)=>{H(D=>D.map(V=>V.categoryId===u?{...V,items:V.items.map(ue=>ue.id===v?{...ue,text:I}:ue)}:V))},ct=(u,v)=>{H(I=>I.map(D=>D.categoryId===u?{...D,items:D.items.filter(V=>V.id!==v)}:D))},J=(u,v,I)=>{u(D=>{const V=[...D];return V[v]=I,V})},Le=u=>{u(v=>[...v,""])},jt=(u,v)=>{u(I=>I.filter((D,V)=>V!==v))},ut=(u,v,I)=>{Be(D=>({...D,[u]:D[u].map((V,ue)=>ue===v?I:V)}))},yt=u=>{Be(v=>({...v,[u]:[...v[u],""]}))},Rt=u=>{bt(v=>{const I=v.findIndex(D=>!D.trim());if(I!==-1){const D=[...v];return D[I]=u,D}return[...v,u]}),g({title:"Adicionado √† Prioridade",description:"Item inclu√≠do na lista de prioridades.",type:"success",duration:2e3})},Kt=(u,v)=>{const I=typeof v=="number"?v:parseFloat(String(v).replace(/[^0-9.]/g,""));isNaN(I)||(ve(V=>({...V,[u]:I})),ye(V=>({...V,[u]:new Date().toISOString()})),g({title:"Meta Atualizada",description:`Nova meta de ${u==="revenue"?"Receita":u==="traffic"?"Tr√°fego":"Vendas"} aplicada.`,type:"success",duration:2e3}))},Bt=u=>{J(he,U.length,u),g({title:"Decis√£o Adicionada",description:"Recomenda√ß√£o inclu√≠da nas decis√µes.",type:"success",duration:2e3})},xt=async()=>{if(!Oe.isAIConfigured()){ie("API de IA n√£o configurada. V√° em Configura√ß√µes ‚Üí IA para configurar sua API Key.");return}T(!0),ie(null);try{const u=await Oe.generatePlanWithAI(c,x);q(u)}catch(u){console.error("AI Generation Error:",u),ie(u.message||"Erro ao gerar plano com IA.")}finally{T(!1)}},Ht=async()=>{const u=Oe.getAIConfig();if(!u||!u.apiKey){g({title:"Configure a API Key primeiro",description:"V√° em Ferramentas > IA",type:"error"});return}pt(!0);try{const v={score:Ne.done/Ne.total*100||0,kpis:{revenue:(r==null?void 0:r.revenue)||{},traffic:(r==null?void 0:r.traffic)||{},sales:(r==null?void 0:r.sales)||{}},decisions:U.filter(D=>D.trim().length>0)},I=await Oe.generateGovernanceConclusion(v);I&&(ot(I),g({title:"Conclus√£o Gerada",type:"success"}))}catch(v){console.error(v),g({title:"Erro na IA",description:v.message,type:"error"})}finally{pt(!1)}},qt=()=>{var De,Pe,kt;if(z)return;M(!0);const u=B.flatMap(Z=>Z.items.filter($e=>$e.text.trim()).map($e=>({category:Z.categoryId,text:$e.text}))),v=["revenue","traffic","sales"].map(Z=>{var _t;const $e=Number(((_t=pe.current)==null?void 0:_t[Z])??0),st=Number((te==null?void 0:te[Z])??$e);return Number.isNaN(st)||st===$e?null:{id:Z,fromGoal:$e,toGoal:st,changedAt:(Se==null?void 0:Se[Z])||new Date().toISOString()}}).filter(Boolean),I={revenue:{...(r==null?void 0:r.revenue)||{},goal:Number((te==null?void 0:te.revenue)??((De=r==null?void 0:r.revenue)==null?void 0:De.goal)??0)},traffic:{...(r==null?void 0:r.traffic)||{},goal:Number((te==null?void 0:te.traffic)??((Pe=r==null?void 0:r.traffic)==null?void 0:Pe.goal)??0)},sales:{...(r==null?void 0:r.sales)||{},goal:Number((te==null?void 0:te.sales)??((kt=r==null?void 0:r.sales)==null?void 0:kt.goal)??0)}},D={period:`${L.startDate} - ${L.endDate}`,periodStartDate:L.startDate,periodEndDate:L.endDate,closedAt:new Date().toISOString(),timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,responsible:(j==null?void 0:j.name)||(j==null?void 0:j.role)||"Operador",type:n,kpiSnapshot:I,goalChanges:v,meetingTimer:{startedAt:R,durationSeconds:ne,paused:!se},kpiNotes:E,roadmapReview:Ne,productionAnalysis:de,executionAnalysis:{...we,topPerformers:we.topPerformers.filter(Z=>Z.trim()),lowPerformers:we.lowPerformers.filter(Z=>Z.trim())},blockNotes:{period:L.notes,roadmap:ae.roadmap,production:ae.production,execution:ae.execution},observations:u,decisions:U.filter(Z=>Z.trim()),learnings:{worked:ce.worked.filter(Z=>Z.trim()),failed:ce.failed.filter(Z=>Z.trim()),changes:ce.changes.filter(Z=>Z.trim()),risks:ce.risks.filter(Z=>Z.trim())},priorities:lt.filter(Z=>Z.trim())},V=lr(D),ue=or(V,c,l),Te=cs(V,n,i);setTimeout(()=>{M(!1),$(V),s==null||s({ata:V,recalibration:ue,nextWindow:Te,goalChanges:v,roadmapUpdates:ge.map(Z=>({id:Z.id,status:Z.governanceStatus,governanceNote:Z.observation}))})},1500)};if(!t)return null;const He=w==="embedded";if(O){const u=hr(O);return e.jsx("div",{className:He?"bg-[#050508] border border-green-500/30 rounded-xl w-full flex flex-col shadow-2xl animate-fadeIn":"fixed inset-0 z-[100] bg-[#050508] flex items-center justify-center p-4",children:e.jsxs("div",{className:He?"bg-[#0A0A0A] rounded-xl w-full flex flex-col":"bg-[#0A0A0A] border border-green-500/30 rounded-xl w-full max-w-3xl max-h-[90vh] flex flex-col shadow-2xl animate-fadeIn",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-green-500/20 bg-green-500/5",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-green-500/20 rounded-xl flex items-center justify-center",children:e.jsx(Ce,{size:24,className:"text-green-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-white",children:"Governan√ßa Conclu√≠da"}),e.jsx("p",{className:"text-xs text-green-400",children:"ATA gerada e sistema recalibrado"})]})]}),e.jsx("button",{onClick:a,className:"p-2 hover:bg-white/10 rounded-lg",children:e.jsx(Ge,{size:18,className:"text-gray-400"})})]}),e.jsxs("div",{className:He?"flex-1 overflow-y-auto p-6 space-y-6 max-h-[70vh]":"flex-1 overflow-y-auto p-6 space-y-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:u.title}),e.jsx("p",{className:"text-sm text-gray-400",children:u.subtitle})]}),u.sections.map((v,I)=>e.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-bold text-white mb-3",children:v.title}),e.jsx("ul",{className:"space-y-1",children:v.items.map((D,V)=>e.jsxs("li",{className:"text-sm text-gray-300 flex items-start gap-2",children:[e.jsx("span",{className:"text-gray-600",children:"‚Ä¢"}),D]},V))})]},I)),e.jsx("div",{className:"text-center text-xs text-gray-500 pt-4 border-t border-white/10",children:u.signature})]}),e.jsx("div",{className:"p-6 border-t border-white/10 flex justify-end",children:e.jsx("button",{onClick:a,className:"btn-primary",children:"Fechar e Aplicar Mudan√ßas"})})]})})}return e.jsxs("div",{className:He?"bg-[#050508] border border-purple-500/30 rounded-xl flex flex-col":"fixed inset-0 z-[100] bg-[#050508] flex flex-col",children:[e.jsxs("div",{className:"h-14 border-b border-purple-500/30 bg-purple-500/5 flex items-center justify-between px-6 shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-500/20 rounded-lg flex items-center justify-center",children:e.jsx(Ue,{size:18,className:"text-purple-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-sm font-bold text-white",children:"Modo Governan√ßa"}),e.jsx("p",{className:"text-[10px] text-purple-400",children:"Ritual de fechamento de ciclo"})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:$t.map((u,v)=>{const I=u.icon;return e.jsxs("button",{onClick:()=>dt(v),className:`flex items-center gap-2 px-3 py-1.5 rounded-lg text-xs font-medium transition-all ${y===v?"bg-purple-500/20 text-purple-300 border border-purple-500/30":y>v?"text-green-400 hover:bg-white/5":"text-gray-500 hover:bg-white/5"}`,children:[y>v?e.jsx(Ce,{size:14}):e.jsx(I,{size:14}),e.jsx("span",{className:"hidden lg:inline",children:u.label})]},u.id)})}),e.jsx("div",{className:"hidden lg:flex items-center gap-2",children:e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 rounded-lg bg-black/30 border border-white/10",children:[e.jsx(xa,{size:14,className:"text-purple-300"}),e.jsxs("span",{className:"text-[11px] font-mono text-gray-200",children:[String(Math.floor(ne/60)).padStart(2,"0"),":",String(ne%60).padStart(2,"0")]}),e.jsx("button",{type:"button",onClick:()=>oe(u=>!u),className:"p-1 rounded hover:bg-white/10 text-gray-300",title:se?"Pausar":"Continuar",children:se?e.jsx(ma,{size:12}):e.jsx(Qs,{size:12})}),e.jsx("button",{type:"button",onClick:()=>{le(0),oe(!0)},className:"p-1 rounded hover:bg-white/10 text-gray-400",title:"Reset",children:e.jsx(ha,{size:12})})]})}),e.jsx("button",{onClick:a,className:"p-2 hover:bg-white/10 rounded-lg",children:e.jsx(Ge,{size:18,className:"text-gray-400"})})]}),e.jsx("div",{className:He?"flex-1 overflow-y-auto p-6 max-h-[70vh]":"flex-1 overflow-y-auto p-6",children:e.jsxs("div",{className:He?"w-full":"max-w-4xl mx-auto",children:[y===0&&e.jsxs("div",{className:"space-y-6 animate-fadeIn",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(Ws,{size:24,className:"text-purple-400"}),e.jsx("h3",{className:"text-xl font-bold text-white",children:"Resumo do Per√≠odo"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-label",children:"Data In√≠cio"}),e.jsx("input",{type:"date",className:"input-field",value:L.startDate,onChange:u=>ee(v=>({...v,startDate:u.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-label",children:"Data Fim"}),e.jsx("input",{type:"date",className:"input-field",value:L.endDate,onChange:u=>ee(v=>({...v,endDate:u.target.value}))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-label",children:"Coment√°rios do bloco"}),e.jsx("textarea",{className:"input-field min-h-[90px]",placeholder:"Resumo do per√≠odo: contexto, leitura r√°pida, anomalias...",value:L.notes,onChange:u=>ee(v=>({...v,notes:u.target.value}))})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-bold text-white mb-3 flex items-center gap-2",children:[e.jsx(et,{size:16,className:"text-green-400"}),"KPIs vs Metas"]}),e.jsx("div",{className:"grid grid-cols-3 gap-4",children:["revenue","traffic","sales"].map(u=>{var ue;const v=(r==null?void 0:r[u])||{value:0,goal:0},I=Number((te==null?void 0:te[u])??v.goal??0),D=I>0?(v.value/I*100).toFixed(0):0,V=D>=100;return e.jsxs("div",{className:`card-elevated p-4 ${V?"border-green-500/30":"border-red-500/30"}`,children:[e.jsx("p",{className:"text-label mb-2",children:u==="revenue"?"Receita":u==="traffic"?"Tr√°fego":"Vendas"}),e.jsx("p",{className:"text-metric",children:u==="revenue"||u==="traffic"?`R$ ${(ue=v.value)==null?void 0:ue.toLocaleString()}`:v.value}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-caption",children:"Meta:"}),e.jsx("input",{type:"number",className:"bg-black/30 border border-white/10 rounded px-2 py-1 w-[110px] text-[11px] font-mono text-gray-200 focus:outline-none focus:border-purple-500/50","data-testid":`gov-goal-${u}`,value:I,onChange:Te=>{const De=parseFloat(Te.target.value);ve(Pe=>({...Pe,[u]:Number.isFinite(De)?De:0})),ye(Pe=>({...Pe,[u]:new Date().toISOString()}))}})]}),e.jsxs("span",{className:`text-xs font-bold ${V?"text-green-400":"text-red-400"}`,children:[D,"%"]})]})]},u)})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-bold text-white mb-3",children:"Coment√°rios por KPI"}),e.jsx("div",{className:"space-y-2",children:[{id:"revenue",label:"Receita"},{id:"traffic",label:"Tr√°fego"},{id:"sales",label:"Vendas"}].map(u=>e.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-lg overflow-hidden",children:[e.jsxs("button",{type:"button",onClick:()=>Ae(v=>v===u.id?null:u.id),className:"w-full px-3 py-2 flex items-center justify-between text-left",children:[e.jsx("span",{className:"text-[11px] font-bold text-gray-200 uppercase tracking-wider",children:u.label}),e.jsx("span",{className:"text-[10px] text-gray-500 truncate max-w-[240px]",children:E!=null&&E[u.id]?E[u.id]:"Adicionar coment√°rio"})]}),xe===u.id&&e.jsx("div",{className:"px-3 pb-3",children:e.jsx("textarea",{className:"input-field min-h-[70px]",placeholder:"Observa√ß√£o do KPI (contexto/decis√£o)...",value:(E==null?void 0:E[u.id])||"",onChange:v=>X(I=>({...I,[u.id]:v.target.value}))})})]},u.id))})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-bold text-white mb-3 flex items-center gap-2",children:[e.jsx(ke,{size:16,className:"text-blue-400"}),"Produ√ß√£o Planejada vs Executada"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"card-elevated p-4",children:[e.jsx("p",{className:"text-label mb-2",children:"Planejado"}),e.jsx("p",{className:"text-metric-lg",children:Ne.total}),e.jsx("p",{className:"text-caption",children:"itens no roadmap"})]}),e.jsxs("div",{className:"card-elevated p-4",children:[e.jsx("p",{className:"text-label mb-2",children:"Executado"}),e.jsx("p",{className:"text-metric-lg text-green-400",children:Ne.done}),e.jsxs("p",{className:"text-caption",children:[Ne.total>0?(Ne.done/Ne.total*100).toFixed(0):0,"% conclu√≠do"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"card-elevated p-4 border-red-500/20",children:[e.jsx("p",{className:"text-label mb-2 text-red-400",children:"Atrasados"}),e.jsx("p",{className:"text-metric text-red-400",children:Ne.delayed})]}),e.jsxs("div",{className:"card-elevated p-4 border-gray-500/20",children:[e.jsx("p",{className:"text-label mb-2",children:"Cancelados"}),e.jsx("p",{className:"text-metric text-gray-400",children:Ne.cancelled})]})]})]}),y===1&&e.jsxs("div",{className:"space-y-6 animate-fadeIn",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(ke,{size:24,className:"text-purple-400"}),e.jsx("h3",{className:"text-xl font-bold text-white",children:"Leitura do Roadmap T√°tico"})]}),e.jsx("p",{className:"text-body mb-4",children:"Revise cada atividade e atualize o status final."}),e.jsxs("div",{className:"bg-gradient-to-r from-purple-500/10 to-blue-500/10 border border-purple-500/30 rounded-lg p-4 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-500/20 rounded-lg flex items-center justify-center",children:e.jsx(at,{size:20,className:"text-purple-400"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-bold text-white",children:"Gera√ß√£o Inteligente"}),e.jsx("p",{className:"text-[10px] text-gray-400",children:"Gere um plano t√°tico e KPIs com IA baseado nos seus Vaults"})]})]}),e.jsx("button",{onClick:xt,disabled:F,className:"btn-primary !bg-gradient-to-r !from-purple-600 !to-blue-600 hover:!from-purple-500 hover:!to-blue-500 flex items-center gap-2",children:F?e.jsxs(e.Fragment,{children:[e.jsx(nt,{size:14,className:"animate-spin"})," Gerando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(rt,{size:14})," Gerar com IA"]})})]}),W&&e.jsx("div",{className:"mt-3 text-xs text-red-400 bg-red-500/10 border border-red-500/20 rounded px-3 py-2",children:W}),G&&e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsxs("div",{className:"bg-green-500/10 border border-green-500/20 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-green-400 text-xs font-bold mb-2",children:[e.jsx(Ce,{size:14})," Plano Gerado com Sucesso"]}),e.jsx("p",{className:"text-[11px] text-gray-300",children:G.recommendation})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-lg p-3",children:[e.jsxs("h5",{className:"text-[10px] font-bold text-gray-400 uppercase mb-2",children:["Tarefas Sugeridas (",((St=G.tasks)==null?void 0:St.length)||0,")"]}),e.jsx("ul",{className:"space-y-2",children:(At=G.tasks)==null?void 0:At.slice(0,5).map((u,v)=>e.jsxs("li",{className:"flex items-start justify-between gap-2 group/item",children:[e.jsxs("div",{className:"text-[11px] text-gray-300 flex items-start gap-1",children:[e.jsx("span",{className:"text-purple-400 mt-0.5",children:"‚Ä¢"}),e.jsx("span",{children:u.title})]}),e.jsx("button",{onClick:()=>Rt(u.title),className:"opacity-0 group-hover/item:opacity-100 transition-opacity p-1 hover:bg-white/10 rounded text-purple-400",title:"Adicionar √†s Prioridades",children:e.jsx(Re,{size:12})})]},v))})]}),e.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-lg p-3",children:[e.jsxs("h5",{className:"text-[10px] font-bold text-gray-400 uppercase mb-2",children:["KPIs Recomendados (",((It=G.kpis)==null?void 0:It.length)||0,")"]}),e.jsx("ul",{className:"space-y-2",children:(mt=G.kpis)==null?void 0:mt.map((u,v)=>{let I=null;const D=u.name.toLowerCase();return D.includes("receita")||D.includes("faturamento")?I="revenue":D.includes("tr√°fego")||D.includes("visita")?I="traffic":(D.includes("vendas")||D.includes("convers√£o"))&&(I="sales"),e.jsxs("li",{className:"flex items-start justify-between gap-2 group/item",children:[e.jsxs("div",{className:"text-[11px] text-gray-300 flex items-start gap-1",children:[e.jsx("span",{className:"text-blue-400 mt-0.5",children:"‚Ä¢"}),e.jsxs("span",{children:[u.name,": ",u.target]})]}),I&&e.jsx("button",{onClick:()=>Kt(I,u.target),className:"opacity-0 group-hover/item:opacity-100 transition-opacity p-1 hover:bg-white/10 rounded text-blue-400",title:`Aplicar meta de ${I==="revenue"?"Receita":I==="traffic"?"Tr√°fego":"Vendas"}`,children:e.jsx(Ue,{size:12})})]},v)})})]})]}),e.jsx("div",{className:"flex justify-end pt-2",children:e.jsxs("button",{onClick:()=>Bt(G.recommendation),className:"text-[10px] text-gray-500 hover:text-white flex items-center gap-1 transition-colors",children:[e.jsx(Re,{size:10})," Adicionar recomenda√ß√£o √†s decis√µes"]})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-label",children:"Coment√°rios do bloco"}),e.jsx("textarea",{className:"input-field min-h-[80px]",placeholder:"Observa√ß√µes gerais do roadmap (bloqueios, decis√µes de execu√ß√£o, replanejamento)...",value:ae.roadmap,onChange:u=>me(v=>({...v,roadmap:u.target.value}))})]}),e.jsxs("div",{className:"space-y-3",children:[ge.map((u,v)=>e.jsxs("div",{className:"card-elevated p-4 group hover:shadow-lg hover:shadow-black/30 transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-subtitle mb-1",children:u.initiative}),e.jsxs("p",{className:"text-caption",children:[u.date," ‚Ä¢ ",u.channel]})]}),e.jsx("select",{value:u.governanceStatus,onChange:I=>{const D=[...ge];D[v].governanceStatus=I.target.value,je(D)},className:"input-field !w-auto !min-w-[140px]",children:Object.entries(ir).map(([I,D])=>e.jsxs("option",{value:I,children:[D.icon," ",D.label]},I))})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("div",{className:"text-[10px] text-gray-500 group-hover:hidden",children:u.observation?`Coment√°rio: ${u.observation}`:"Sem coment√°rio"}),e.jsx("input",{placeholder:"Coment√°rio (passar o mouse para editar)",value:u.observation,onChange:I=>{const D=[...ge];D[v].observation=I.target.value,je(D)},className:"input-field text-sm hidden group-hover:block"})]})]},u.id||v)),ge.length===0&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(ke,{size:32,className:"mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"Nenhum item no roadmap para revisar"})]})]})]}),y===2&&e.jsxs("div",{className:"space-y-6 animate-fadeIn",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(bs,{size:24,className:"text-purple-400"}),e.jsx("h3",{className:"text-xl font-bold text-white",children:"An√°lise de Produ√ß√£o"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-label",children:"Artes Geradas"}),e.jsx("input",{type:"number",className:"input-field",value:de.generated,onChange:u=>Me(v=>({...v,generated:parseInt(u.target.value)||0}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-label",children:"Aprovadas"}),e.jsx("input",{type:"number",className:"input-field",value:de.approved,onChange:u=>Me(v=>({...v,approved:parseInt(u.target.value)||0}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-label",children:"Publicadas"}),e.jsx("input",{type:"number",className:"input-field",value:de.published,onChange:u=>Me(v=>({...v,published:parseInt(u.target.value)||0}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-label",children:"N√£o Executadas"}),e.jsx("input",{type:"number",className:"input-field",value:de.notExecuted,onChange:u=>Me(v=>({...v,notExecuted:parseInt(u.target.value)||0}))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-label",children:"Coment√°rios do bloco"}),e.jsx("textarea",{className:"input-field min-h-[80px]",placeholder:"Observa√ß√µes gerais da produ√ß√£o (onde travou, qualidade, depend√™ncias)...",value:ae.production,onChange:u=>me(v=>({...v,production:u.target.value}))})]}),e.jsxs("div",{className:"card-elevated p-6",children:[e.jsx("h4",{className:"text-sm font-bold text-white mb-4",children:"Funil de Produ√ß√£o"}),e.jsx("div",{className:"flex items-center justify-between",children:[{label:"Geradas",value:de.generated,color:"bg-blue-500"},{label:"Aprovadas",value:de.approved,color:"bg-yellow-500"},{label:"Publicadas",value:de.published,color:"bg-green-500"}].map((u,v)=>e.jsxs(ga.Fragment,{children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:`w-16 h-16 ${u.color}/20 rounded-xl flex items-center justify-center mx-auto mb-2`,children:e.jsx("span",{className:"text-xl font-bold text-white",children:u.value})}),e.jsx("p",{className:"text-xs text-gray-400",children:u.label})]}),v<2&&e.jsx(tt,{size:20,className:"text-gray-600"})]},u.label))})]})]}),y===3&&e.jsxs("div",{className:"space-y-6 animate-fadeIn",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(et,{size:24,className:"text-purple-400"}),e.jsx("h3",{className:"text-xl font-bold text-white",children:"An√°lise de Execu√ß√£o"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-label",children:"Impacto no Tr√°fego"}),e.jsxs("select",{className:"input-field",value:we.trafficImpact,onChange:u=>h(v=>({...v,trafficImpact:u.target.value})),children:[e.jsx("option",{value:"positive",children:"‚Üë Positivo"}),e.jsx("option",{value:"neutral",children:"‚Üí Neutro"}),e.jsx("option",{value:"negative",children:"‚Üì Negativo"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-label",children:"Impacto nas Vendas"}),e.jsxs("select",{className:"input-field",value:we.salesImpact,onChange:u=>h(v=>({...v,salesImpact:u.target.value})),children:[e.jsx("option",{value:"positive",children:"‚Üë Positivo"}),e.jsx("option",{value:"neutral",children:"‚Üí Neutro"}),e.jsx("option",{value:"negative",children:"‚Üì Negativo"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-label",children:"Coment√°rios do bloco"}),e.jsx("textarea",{className:"input-field min-h-[80px]",placeholder:"Observa√ß√µes gerais da execu√ß√£o (o que funcionou, por qu√™, pr√≥ximos testes)...",value:ae.execution,onChange:u=>me(v=>({...v,execution:u.target.value}))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-label flex items-center gap-2",children:[e.jsx(et,{size:14,className:"text-green-400"}),"A√ß√µes que Performaram"]}),e.jsx("div",{className:"space-y-2 mt-2",children:we.topPerformers.map((u,v)=>e.jsx("input",{className:"input-field",placeholder:`Top performer ${v+1}`,value:u,onChange:I=>{const D=[...we.topPerformers];D[v]=I.target.value,h(V=>({...V,topPerformers:D}))}},v))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-label flex items-center gap-2",children:[e.jsx(ba,{size:14,className:"text-red-400"}),"A√ß√µes que N√£o Performaram"]}),e.jsx("div",{className:"space-y-2 mt-2",children:we.lowPerformers.map((u,v)=>e.jsx("input",{className:"input-field",placeholder:`Low performer ${v+1}`,value:u,onChange:I=>{const D=[...we.lowPerformers];D[v]=I.target.value,h(V=>({...V,lowPerformers:D}))}},v))})]})]}),y===4&&e.jsxs("div",{className:"space-y-6 animate-fadeIn",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(gs,{size:24,className:"text-purple-400"}),e.jsx("h3",{className:"text-xl font-bold text-white",children:"Observa√ß√µes da Reuni√£o"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:B.map(u=>{const v=Vs.find(I=>I.id===u.categoryId);return e.jsxs("div",{className:"card-elevated p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h4",{className:"text-sm font-bold text-white flex items-center gap-2",children:[e.jsx("span",{children:v==null?void 0:v.icon}),u.categoryLabel]}),e.jsx("button",{onClick:()=>Vt(u.categoryId),className:"btn-ghost !h-6 !px-2 !text-xs",children:e.jsx(Re,{size:12})})]}),e.jsxs("div",{className:"space-y-2",children:[u.items.map(I=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input-field flex-1 !py-1.5",placeholder:"Digite a observa√ß√£o...",value:I.text,onChange:D=>vt(u.categoryId,I.id,D.target.value)}),e.jsx("button",{onClick:()=>ct(u.categoryId,I.id),className:"text-gray-500 hover:text-red-400",children:e.jsx(ls,{size:14})})]},I.id)),u.items.length===0&&e.jsx("p",{className:"text-xs text-gray-500 italic",children:"Clique em + para adicionar"})]})]},u.categoryId)})}),e.jsxs("div",{className:"card-elevated p-4",children:[e.jsxs("h4",{className:"text-sm font-bold text-white mb-3 flex items-center gap-2",children:[e.jsx(Ue,{size:16,className:"text-blue-400"}),"Decis√µes Tomadas"]}),e.jsxs("div",{className:"space-y-2",children:[U.map((u,v)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"input-field flex-1",placeholder:"Decis√£o...",value:u,onChange:I=>J(he,v,I.target.value)}),U.length>1&&e.jsx("button",{onClick:()=>jt(he,v),className:"text-gray-500 hover:text-red-400",children:e.jsx(ls,{size:14})})]},v)),e.jsxs("button",{onClick:()=>Le(he),className:"btn-ghost !h-7 !text-xs",children:[e.jsx(Re,{size:12,className:"mr-1"})," Adicionar"]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[{key:"worked",label:"O que Funcionou",icon:Ce,color:"green"},{key:"failed",label:"O que Falhou",icon:Qe,color:"red"},{key:"changes",label:"O que Fazer Diferente",icon:is,color:"blue"},{key:"risks",label:"Riscos Identificados",icon:Qe,color:"yellow"}].map(({key:u,label:v,icon:I,color:D})=>e.jsxs("div",{className:"card-elevated p-4",children:[e.jsxs("h4",{className:"text-sm font-bold text-white mb-3 flex items-center gap-2",children:[e.jsx(I,{size:16,className:`text-${D}-400`}),v]}),e.jsxs("div",{className:"space-y-2",children:[ce[u].map((V,ue)=>e.jsx("input",{className:"input-field !py-1.5",placeholder:"...",value:V,onChange:Te=>ut(u,ue,Te.target.value)},ue)),e.jsxs("button",{onClick:()=>yt(u),className:"btn-ghost !h-6 !text-xs",children:[e.jsx(Re,{size:10,className:"mr-1"})," Adicionar"]})]})]},u))}),e.jsxs("div",{className:"card-elevated p-4 border-purple-500/30",children:[e.jsxs("h4",{className:"text-sm font-bold text-white mb-3 flex items-center gap-2",children:[e.jsx(is,{size:16,className:"text-purple-400"}),"Top 3 Prioridades (Pr√≥ximo Ciclo)"]}),e.jsx("div",{className:"space-y-2",children:lt.map((u,v)=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"w-6 h-6 flex items-center justify-center bg-purple-500/20 text-purple-400 rounded text-xs font-bold",children:v+1}),e.jsx("input",{className:"input-field flex-1",placeholder:`Prioridade ${v+1}`,"data-testid":`gov-priority-${v}`,value:u,onChange:I=>J(bt,v,I.target.value)})]},v))})]}),e.jsxs("div",{className:"card-elevated p-4 border-purple-500/30 bg-purple-500/5 mt-6",children:[e.jsxs("h4",{className:"text-sm font-bold text-white mb-3 flex items-center gap-2",children:[e.jsx(pa,{size:16,className:"text-purple-400"}),"Conclus√£o Executiva (IA)"]}),We?e.jsxs("div",{className:"space-y-4 animate-fadeIn",children:[e.jsx("div",{className:"bg-black/30 p-3 rounded border border-white/5",children:e.jsxs("p",{className:"text-sm text-gray-300 italic",children:['"',We.conclusion_summary,'"']})}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider mb-2 block",children:"Pr√≥ximos Passos Sugeridos"}),e.jsx("ul",{className:"space-y-1",children:We.next_steps.map((u,v)=>e.jsxs("li",{className:"text-sm text-gray-400 flex items-start gap-2",children:[e.jsx("span",{className:"text-purple-500",children:"‚Ä¢"})," ",u]},v))})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:()=>ot(null),className:"text-xs text-red-400 hover:text-red-300",children:"Descartar e Tentar Novamente"})})]}):e.jsxs("div",{className:"text-center py-6",children:[e.jsx("p",{className:"text-sm text-gray-400 mb-4",children:"Use a IA para analisar todos os dados desta reuni√£o e gerar um veredito final."}),e.jsxs("button",{onClick:Ht,disabled:Je,className:"btn-secondary mx-auto",children:[Je?e.jsx(nt,{size:16,className:"animate-spin mr-2"}):e.jsx(rt,{size:16,className:"text-yellow-400 mr-2"}),Je?"Analisando...":"Gerar Conclus√£o com IA"]})]})]})]})]})}),e.jsxs("div",{className:"h-16 border-t border-purple-500/30 bg-[#080808] flex items-center justify-between px-6 shrink-0",children:[e.jsxs("div",{className:"text-xs text-gray-500",children:["Passo ",y+1," de ",$t.length]}),e.jsxs("div",{className:"flex items-center gap-3",children:[y>0&&e.jsx("button",{onClick:Ze,className:"btn-ghost",children:"Voltar"}),y<$t.length-1?e.jsxs("button",{onClick:ft,className:"btn-primary","data-testid":"governance-next",children:["Pr√≥ximo ",e.jsx(tt,{size:14,className:"ml-1"})]}):e.jsx("button",{onClick:qt,disabled:z,"data-testid":"governance-complete",className:"btn-primary !bg-green-600 hover:!bg-green-500",children:z?e.jsx(e.Fragment,{children:"Processando..."}):e.jsxs(e.Fragment,{children:[e.jsx(qs,{size:14,className:"mr-1"}),"Fechar Ciclo e Gerar ATA"]})})]})]})]})}function br(t,a){const s=new Date,r=s.getDay();switch(t){case"daily":{const l=new Date(s);return l.setDate(l.getDate()+1),l}case"weekly":{const c=((Number.isFinite(a==null?void 0:a.meetingWeekday)?a.meetingWeekday:1)-r+7)%7||7,n=new Date(s);return n.setDate(n.getDate()+c),n}case"monthly":{const l=Number.isFinite(a==null?void 0:a.monthlyMeetingDay)?a.monthlyMeetingDay:1,c=new Date(s.getFullYear(),s.getMonth()+1,1),n=new Date(c.getFullYear(),c.getMonth()+1,0).getDate();return c.setDate(Math.max(1,Math.min(l,n))),c}default:return null}}function pr(t,a){const s=n=>n.toISOString().split("T")[0],r=new Date,l=new Date(r);if(l.setHours(0,0,0,0),t==="daily"){const n=s(l);return{startDate:n,endDate:n}}if(t==="weekly"){const n=Number.isFinite(a==null?void 0:a.weekStartDay)?a.weekStartDay:1,i=(l.getDay()-n+7)%7,j=new Date(l);j.setDate(j.getDate()-i);const w=new Date(j);return w.setDate(w.getDate()+6),{startDate:s(j),endDate:s(w)}}if(t==="monthly"){const n=new Date(l.getFullYear(),l.getMonth(),1),o=new Date(l.getFullYear(),l.getMonth()+1,0);return{startDate:s(n),endDate:s(o)}}const c=s(l);return{startDate:c,endDate:c}}function fr(t){return t?t.toLocaleDateString("pt-BR",{weekday:"short",day:"2-digit",month:"short"}):"N√£o definida"}function vr(t,a){if(!t)return{status:"overdue",label:"Nunca realizada",color:"text-red-400",bgColor:"bg-red-500/10"};const s=new Date(t),l=Math.floor((new Date-s)/(1e3*60*60*24)),n={daily:1,weekly:7,monthly:30}[a]||7;return l<=n?{status:"ok",label:"Em dia",color:"text-green-400",bgColor:"bg-green-500/10"}:l<=n*1.5?{status:"warning",label:"Pendente",color:"text-yellow-400",bgColor:"bg-yellow-500/10"}:{status:"overdue",label:"Atrasada",color:"text-red-400",bgColor:"bg-red-500/10"}}function jr({frequency:t="weekly",lastGovernance:a,isGovernanceActive:s,onToggleGovernance:r,onChangeFrequency:l,nextWindow:c,calendarRule:n,onUpdateCalendarRule:o}){const i=new Date,j=i.toLocaleDateString("pt-BR",{weekday:"short"}).replace(".","").toUpperCase(),w=i.toLocaleDateString("pt-BR",{day:"2-digit"}),x=i.toLocaleDateString("pt-BR",{month:"short"}).replace(".","").toUpperCase(),g=br(t,n),y=vr(a,t),_=pr(t,n),z=c!=null&&c.startDate&&(c!=null&&c.endDate)?c:_,[M,O]=m.useState(!1),[$,F]=m.useState({weekStartDay:Number.isFinite(n==null?void 0:n.weekStartDay)?n.weekStartDay:1,meetingWeekday:Number.isFinite(n==null?void 0:n.meetingWeekday)?n.meetingWeekday:1,monthlyMeetingDay:Number.isFinite(n==null?void 0:n.monthlyMeetingDay)?n.monthlyMeetingDay:1});m.useEffect(()=>{F({weekStartDay:Number.isFinite(n==null?void 0:n.weekStartDay)?n.weekStartDay:1,meetingWeekday:Number.isFinite(n==null?void 0:n.meetingWeekday)?n.meetingWeekday:1,monthlyMeetingDay:Number.isFinite(n==null?void 0:n.monthlyMeetingDay)?n.monthlyMeetingDay:1})},[n==null?void 0:n.weekStartDay,n==null?void 0:n.meetingWeekday,n==null?void 0:n.monthlyMeetingDay]);const T=y.status==="ok"?Ce:y.status==="warning"?Gt:Hs;return e.jsxs("div",{className:`mb-6 p-4 rounded-xl border transition-all ${s?"bg-purple-500/10 border-purple-500/30":"bg-[#080808] border-white/10"}`,children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-stretch gap-4",children:[e.jsxs("div",{className:"w-[86px] shrink-0 rounded-xl border border-white/10 bg-white/5 flex flex-col items-center justify-center px-3 py-2",children:[e.jsx("div",{className:"text-[10px] font-mono text-gray-400 uppercase tracking-widest",children:j}),e.jsx("div",{className:"text-2xl font-bold text-white leading-tight mt-0.5",children:w}),e.jsx("div",{className:"text-[10px] font-mono text-gray-500 uppercase tracking-widest mt-0.5",children:x})]}),e.jsx("div",{className:"w-px bg-white/10 my-2"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center ${s?"bg-purple-500/20":"bg-white/5"}`,children:e.jsx(Os,{size:24,className:s?"text-purple-400":"text-gray-500"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-sm font-bold text-white",children:"Governan√ßa"}),e.jsxs("select",{value:t,onChange:G=>l==null?void 0:l(G.target.value),className:"bg-transparent border border-white/10 rounded px-2 py-0.5 text-[10px] font-bold text-gray-400 uppercase tracking-wider focus:outline-none focus:border-purple-500/50 cursor-pointer",children:[e.jsx("option",{value:"daily",children:"Di√°ria"}),e.jsx("option",{value:"weekly",children:"Semanal"}),e.jsx("option",{value:"monthly",children:"Mensal"})]}),e.jsx("button",{type:"button",onClick:()=>O(G=>!G),className:"ml-1 p-1.5 rounded-lg hover:bg-white/5 text-gray-500 hover:text-gray-300 transition-colors",title:"Calend√°rio",children:e.jsx(fa,{size:14})})]}),e.jsxs("div",{className:"flex items-center gap-3 text-[11px]",children:[e.jsxs("div",{className:`flex items-center gap-1 px-2 py-0.5 rounded-full ${y.bgColor}`,children:[e.jsx(T,{size:10,className:y.color}),e.jsx("span",{className:`font-medium ${y.color}`,children:y.label})]}),e.jsxs("div",{className:"flex items-center gap-1 text-gray-500",children:[e.jsx(ke,{size:10}),e.jsxs("span",{children:["Pr√≥xima: ",e.jsx("span",{className:"text-gray-400",children:fr(g)})]})]})]})]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("button",{onClick:r,"data-testid":"os-toggle-governance",className:s?"relative px-4 py-2 rounded-lg text-xs font-bold text-white flex items-center gap-2 border border-purple-500/40 bg-gradient-to-r from-purple-600 via-fuchsia-600 to-purple-600 shadow-lg shadow-purple-500/20 hover:shadow-purple-500/30 transition-all":"relative px-4 py-2 rounded-lg text-xs font-bold text-purple-200 flex items-center gap-2 border border-purple-500/40 bg-gradient-to-r from-purple-500/20 via-fuchsia-500/10 to-purple-500/20 hover:from-purple-500/25 hover:via-fuchsia-500/20 hover:to-purple-500/25 hover:shadow-md hover:shadow-purple-500/10 transition-all",children:[e.jsx("span",{className:s?"absolute -inset-[1px] rounded-lg bg-gradient-to-r from-purple-500/30 via-fuchsia-500/10 to-purple-500/30 blur-sm":"absolute -inset-[1px] rounded-lg bg-gradient-to-r from-purple-500/15 via-fuchsia-500/5 to-purple-500/15 blur-sm"}),e.jsxs("span",{className:"relative flex items-center gap-2",children:[e.jsx(Os,{size:14}),s?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"Encerrar Reuni√£o"}),e.jsxs("span",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 rounded-full bg-black/30 border border-white/10 text-[10px] font-mono",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-green-400 animate-pulse"}),"LIVE"]})]}):"Iniciar Reuni√£o"]})]})})]}),s&&e.jsx("div",{className:"mt-4 pt-4 border-t border-purple-500/20",children:e.jsxs("div",{className:"flex items-center gap-2 text-[11px] text-purple-300",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-purple-500 animate-pulse"}),e.jsx("span",{children:"Modo Governan√ßa ativo ‚Äî edi√ß√µes de KPIs habilitadas"})]})}),(z==null?void 0:z.startDate)&&(z==null?void 0:z.endDate)&&e.jsxs("div",{className:"mt-3 text-[11px] text-gray-500",children:["Per√≠odo do ciclo: ",e.jsxs("span",{className:"text-gray-300 font-medium",children:[z.startDate," ‚Üí ",z.endDate]})]}),M&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-white/10",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-label",children:"In√≠cio da semana"}),e.jsxs("select",{className:"bg-transparent border border-white/10 rounded px-2 py-1 text-[11px] text-gray-300 w-full",value:$.weekStartDay,onChange:G=>F(q=>({...q,weekStartDay:parseInt(G.target.value,10)})),children:[e.jsx("option",{value:0,children:"Dom"}),e.jsx("option",{value:1,children:"Seg"}),e.jsx("option",{value:2,children:"Ter"}),e.jsx("option",{value:3,children:"Qua"}),e.jsx("option",{value:4,children:"Qui"}),e.jsx("option",{value:5,children:"Sex"}),e.jsx("option",{value:6,children:"S√°b"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-label",children:"Dia da reuni√£o (semanal)"}),e.jsxs("select",{className:"bg-transparent border border-white/10 rounded px-2 py-1 text-[11px] text-gray-300 w-full",value:$.meetingWeekday,onChange:G=>F(q=>({...q,meetingWeekday:parseInt(G.target.value,10)})),children:[e.jsx("option",{value:0,children:"Dom"}),e.jsx("option",{value:1,children:"Seg"}),e.jsx("option",{value:2,children:"Ter"}),e.jsx("option",{value:3,children:"Qua"}),e.jsx("option",{value:4,children:"Qui"}),e.jsx("option",{value:5,children:"Sex"}),e.jsx("option",{value:6,children:"S√°b"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-label",children:"Dia da reuni√£o (mensal)"}),e.jsx("input",{type:"number",min:1,max:31,className:"bg-transparent border border-white/10 rounded px-2 py-1 text-[11px] text-gray-300 w-full",value:$.monthlyMeetingDay,onChange:G=>F(q=>({...q,monthlyMeetingDay:parseInt(G.target.value,10)||1}))})]})]}),e.jsxs("div",{className:"mt-3 flex justify-end gap-2",children:[e.jsx("button",{type:"button",className:"btn-ghost !h-7 !px-3",onClick:()=>O(!1),children:"Cancelar"}),e.jsx("button",{type:"button",className:"btn-primary !h-7 !px-3",onClick:()=>{o==null||o($),O(!1)},children:"Salvar calend√°rio"})]})]})]})}function Xs(t){return t==="high"?{bg:"bg-red-500/10",border:"border-red-500/30",text:"text-red-400",badge:"bg-red-500"}:t==="medium"?{bg:"bg-yellow-500/10",border:"border-yellow-500/30",text:"text-yellow-400",badge:"bg-yellow-500"}:{bg:"bg-green-500/10",border:"border-green-500/30",text:"text-green-400",badge:"bg-green-500"}}function yr({action:t,index:a,onActionClick:s}){const r=Xs(t.risk);return e.jsxs("div",{onClick:()=>s==null?void 0:s(t),className:`relative p-4 rounded-xl border ${r.border} ${r.bg} hover:scale-[1.02] transition-all cursor-pointer group`,children:[e.jsx("div",{className:`absolute -top-2 -left-2 w-6 h-6 ${r.badge} rounded-full flex items-center justify-center text-white text-xs font-bold shadow-lg`,children:a+1}),e.jsxs("div",{className:"pl-2",children:[e.jsx("h4",{className:"text-sm font-bold text-white mb-2 pr-6 group-hover:text-white/90",children:t.name}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(et,{size:12,className:"text-blue-400"}),e.jsxs("span",{className:"text-[10px] text-gray-400",children:["Impacto: ",e.jsx("span",{className:"text-blue-400 font-medium",children:t.impact})]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-[10px]",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Qe,{size:10,className:r.text}),e.jsx("span",{className:r.text,children:t.risk==="high"?"Alto Risco":t.risk==="medium"?"M√©dio":"Baixo"})]}),t.dependency&&e.jsxs("div",{className:"flex items-center gap-1 text-gray-500",children:[e.jsx(va,{size:10}),e.jsx("span",{children:t.dependency})]}),t.due&&e.jsxs("div",{className:"flex items-center gap-1 text-gray-500",children:[e.jsx(Gt,{size:10}),e.jsx("span",{children:t.due})]})]}),e.jsxs("div",{className:"mt-3 flex items-center justify-between",children:[e.jsx("span",{className:`text-[9px] font-bold uppercase tracking-wider px-2 py-0.5 rounded ${t.status==="pending"?"bg-gray-500/20 text-gray-400":t.status==="in_progress"?"bg-blue-500/20 text-blue-400":"bg-green-500/20 text-green-400"}`,children:t.status==="pending"?"Pendente":t.status==="in_progress"?"Em Andamento":"Conclu√≠do"}),e.jsx(tt,{size:14,className:"text-gray-600 group-hover:text-white group-hover:translate-x-1 transition-all"})]})]})]})}function wr({action:t,index:a,onActionClick:s}){const r=Xs(t.risk);return e.jsxs("button",{type:"button",onClick:()=>s==null?void 0:s(t),className:`flex items-center gap-2 px-3 py-2 rounded-lg border ${r.border} ${r.bg} text-left min-w-[220px] hover:scale-[1.01] transition-all`,children:[e.jsx("div",{className:`w-5 h-5 ${r.badge} rounded flex items-center justify-center text-white text-[10px] font-bold shrink-0`,children:a+1}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-[11px] font-bold text-white truncate",children:t.name}),e.jsx("div",{className:"text-[10px] text-gray-500 truncate",children:t.impact})]})]})}function Nr({items:t,kpis:a,onActionClick:s,variant:r="grid"}){const c=(()=>{var M,O,$,F;const n=new Date;n.setHours(0,0,0,0);const o=new Date(n);o.setDate(o.getDate()+1);const i=n.toISOString().split("T")[0],j=o.toISOString().split("T")[0],w=[],x=t.filter(T=>{const G=new Date(T.date);return G.setHours(0,0,0,0),G<n&&T.status!=="done"&&T.status!=="cancelled"});x.length>0&&w.push({id:"overdue",name:`${x.length} item(s) atrasado(s) precisam de a√ß√£o`,impact:"Cronograma",risk:"high",dependency:((M=x[0])==null?void 0:M.responsible)||"Time",status:"pending",items:x});const g=t.filter(T=>T.date===i&&T.status!=="done"&&!T.visual_output);if(g.length>0&&w.push({id:"today_no_visual",name:`Gerar arte para ${g.length} item(s) de hoje`,impact:"Entrega do Dia",risk:"high",dependency:"Design",due:"Hoje",status:"pending",items:g}),a){const T=((O=a.revenue)==null?void 0:O.goal)-(($=a.revenue)==null?void 0:$.value);T>0&&T/((F=a.revenue)==null?void 0:F.goal)>.3&&w.push({id:"revenue_gap",name:"Receita 30%+ abaixo da meta",impact:`R$ ${T.toLocaleString()} faltando`,risk:"high",dependency:"Comercial",status:"pending"})}const y=t.filter(T=>T.date===j&&T.status==="draft");y.length>0&&w.push({id:"tomorrow_drafts",name:`Aprovar ${y.length} item(s) para amanh√£`,impact:"Pipeline",risk:"medium",dependency:"Aprovador",due:"Hoje",status:"pending",items:y});const _=t.filter(T=>!T.responsible&&T.status!=="done"&&T.status!=="cancelled").slice(0,3);_.length>0&&w.push({id:"no_responsible",name:`Atribuir respons√°vel a ${_.length} item(s)`,impact:"Organiza√ß√£o",risk:"low",dependency:"Gestor",status:"pending",items:_});const z={high:0,medium:1,low:2};return w.sort((T,G)=>z[T.risk]-z[G.risk]).slice(0,3)})();return c.length===0?r==="strip"?null:e.jsxs("div",{className:"bento-grid p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-green-500/10 flex items-center justify-center",children:e.jsx(et,{size:16,className:"text-green-500"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-bold text-white",children:"A√ß√µes Priorit√°rias"}),e.jsx("p",{className:"text-[10px] text-gray-500",children:"Top 3 tarefas cr√≠ticas do dia"})]})]}),e.jsx("div",{className:"flex items-center justify-center py-8 text-gray-500 text-sm",children:"‚úÖ Tudo em dia! Nenhuma a√ß√£o cr√≠tica pendente."})]}):r==="strip"?e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-7 h-7 rounded-lg bg-orange-500/10 flex items-center justify-center",children:e.jsx(Qe,{size:14,className:"text-orange-500"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-[11px] font-bold text-white",children:"A√ß√µes Priorit√°rias"}),e.jsx("p",{className:"text-[10px] text-gray-600",children:"Top 3 cr√≠ticas do dia"})]})]}),e.jsxs("span",{className:"text-[10px] font-mono text-gray-500",children:[c.filter(n=>n.risk==="high").length," cr√≠ticas"]})]}),e.jsx("div",{className:"flex gap-2 overflow-x-auto custom-scrollbar pb-1",children:c.map((n,o)=>e.jsx(wr,{action:n,index:o,onActionClick:s},n.id))})]}):e.jsxs("div",{className:"bento-grid p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-orange-500/10 flex items-center justify-center",children:e.jsx(Qe,{size:16,className:"text-orange-500"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-bold text-white",children:"A√ß√µes Priorit√°rias"}),e.jsx("p",{className:"text-[10px] text-gray-500",children:"Top 3 tarefas cr√≠ticas do dia"})]})]}),e.jsxs("span",{className:"text-[10px] font-mono text-gray-500",children:[c.filter(n=>n.risk==="high").length," cr√≠ticas"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:c.map((n,o)=>e.jsx(yr,{action:n,index:o,onActionClick:s},n.id))})]})}const Cr={V1:{id:"V1",key:"S1",icon:ja,color:"red",labelKey:"brand_dna",checkFields:["fields.archetype","fields.mission","fields.values"]},V2:{id:"V2",key:"S2",icon:us,color:"orange",labelKey:"offer",checkFields:["products","pricing"]},V3:{id:"V3",key:"S3",icon:Ue,color:"blue",labelKey:"traffic",checkFields:["traffic.primarySource","traffic.budget"]},V4:{id:"V4",key:"S4",icon:xs,color:"green",labelKey:"team",checkFields:["matrix","contacts"]},V5:{id:"V5",key:"S5",icon:ms,color:"purple",labelKey:"ideas",checkFields:["ideas"]}},Sr={red:{bg:"bg-red-500/5",border:"border-red-500/20 hover:border-red-500/40",icon:"bg-red-500/10 text-red-400",accent:"bg-red-500",text:"text-red-400"},orange:{bg:"bg-orange-500/5",border:"border-orange-500/20 hover:border-orange-500/40",icon:"bg-orange-500/10 text-orange-400",accent:"bg-orange-500",text:"text-orange-400"},blue:{bg:"bg-blue-500/5",border:"border-blue-500/20 hover:border-blue-500/40",icon:"bg-blue-500/10 text-blue-400",accent:"bg-blue-500",text:"text-blue-400"},green:{bg:"bg-green-500/5",border:"border-green-500/20 hover:border-green-500/40",icon:"bg-green-500/10 text-green-400",accent:"bg-green-500",text:"text-green-400"},purple:{bg:"bg-purple-500/5",border:"border-purple-500/20 hover:border-purple-500/40",icon:"bg-purple-500/10 text-purple-400",accent:"bg-purple-500",text:"text-purple-400"}};function Ar(t,a){return a.split(".").reduce((s,r)=>s&&s[r],t)}function Ir(t,a){if(!t)return{status:"incomplete",label:"Incompleto",filled:0,total:a.length};let s=0;for(const l of a){const c=Ar(t,l);c&&(!Array.isArray(c)||c.length>0)&&s++}const r=s/a.length;return r>=1?{status:"ok",label:"Completo",filled:s,total:a.length}:r>=.5?{status:"partial",label:"Parcial",filled:s,total:a.length}:{status:"incomplete",label:"Incompleto",filled:s,total:a.length}}function kr(t,a){var s,r,l,c,n,o,i,j,w,x;if(!t)return"N√£o configurado";switch(a){case"S1":return((s=t.fields)==null?void 0:s.archetype)||((l=(r=t.fields)==null?void 0:r.mission)==null?void 0:l.substring(0,30))||"N√£o configurado";case"S2":return((n=(c=t.products)==null?void 0:c[0])==null?void 0:n.name)||"Nenhum produto";case"S3":return((o=t.traffic)==null?void 0:o.primarySource)||"N√£o definido";case"S4":return((j=(i=t.matrix)==null?void 0:i[0])==null?void 0:j.who)||"Nenhum membro";case"S5":return((x=(w=t.ideas)==null?void 0:w[0])==null?void 0:x.title)||"Nenhuma ideia";default:return"N/A"}}function _r({config:t,vault:a,label:s,onClick:r}){const l=Sr[t.color],c=t.icon,n=Ir(a,t.checkFields),o=kr(a,t.key),i=n.status==="ok"?Ce:n.status==="partial"?Gt:Qe,j=n.status==="ok"?"text-green-400":n.status==="partial"?"text-yellow-400":"text-red-400";return e.jsxs("div",{onClick:r,"data-testid":`os-vault-card-${t.id}`,className:`relative p-4 rounded-xl border ${l.border} ${l.bg} cursor-pointer transition-all hover:scale-[1.02] group`,children:[e.jsxs("div",{className:`absolute top-3 right-3 flex items-center gap-1 px-2 py-0.5 rounded-full ${n.status==="ok"?"bg-green-500/10":n.status==="partial"?"bg-yellow-500/10":"bg-red-500/10"}`,children:[e.jsx(i,{size:10,className:j}),e.jsx("span",{className:`text-[9px] font-bold uppercase tracking-wider ${j}`,children:n.label})]}),e.jsx("div",{className:`w-10 h-10 rounded-lg ${l.icon} flex items-center justify-center mb-3`,children:e.jsx(c,{size:20})}),e.jsx("div",{className:"text-label mb-1",children:s}),e.jsx("div",{className:"text-small text-[var(--text-primary)] truncate mb-2 pr-4",children:o}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-1 w-16 bg-white/10 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full ${l.accent}`,style:{width:`${n.filled/n.total*100}%`}})}),e.jsxs("span",{className:"text-[9px] text-gray-600 font-mono",children:[n.filled,"/",n.total]})]}),e.jsx(tt,{size:14,className:"text-gray-600 group-hover:text-white group-hover:translate-x-1 transition-all"})]}),e.jsx("div",{className:"absolute bottom-3 right-3 text-[9px] text-gray-700 font-mono",children:t.id})]})}function Tr({vaults:t,labels:a,onVaultClick:s}){return e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-label",children:"Vaults Estrat√©gicos"}),e.jsx("span",{className:"text-caption",children:"Fonte de dados para IA"})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-3",children:Object.entries(Cr).map(([r,l])=>e.jsx(_r,{config:l,vault:t==null?void 0:t[l.key],label:(a==null?void 0:a[l.labelKey])||l.labelKey,onClick:()=>s==null?void 0:s(r)},r))})]})}function Dr({open:t,onClose:a,clientId:s,appData:r,setAppData:l,currentUser:c,initialTab:n="brand"}){var de,Me,we;const{addToast:o}=zt(),[i,j]=m.useState(n),[w,x]=m.useState(null),[g,y]=m.useState(""),[_,z]=m.useState(""),[M,O]=m.useState([]),[$,F]=m.useState("openai"),[T,G]=m.useState(""),[q,W]=m.useState(null),[ie,R]=m.useState(""),[Y,ne]=m.useState({strategy:50,lastGov:30,history:20});m.useEffect(()=>{if(!t)return;j(n),x(null),y(""),z("");const h=Oe.getAIConfig();h&&(F(h.provider||"openai"),G(h.apiKey||""),h.weights&&ne(h.weights))},[t,n]);const le=!!((de=r==null?void 0:r.workspacePrefs)!=null&&de.autoInspire),se=((Me=r==null?void 0:r.workspacePrefs)==null?void 0:Me.theme)||{enabled:!1,primaryColor:"#FF5733",accentColor:"#FF5733",fontFamily:"Inter"},oe=m.useMemo(()=>{var h;return Array.isArray((h=r==null?void 0:r.measurementContract)==null?void 0:h.auditLog)?r.measurementContract.auditLog:[]},[(we=r==null?void 0:r.measurementContract)==null?void 0:we.auditLog]);m.useEffect(()=>{if(!t||!s){O([]);return}const h=window.setTimeout(()=>{O(ht.getSnapshots(s))},0);return()=>window.clearTimeout(h)},[t,s,oe.length]);const L=m.useMemo(()=>{var h;return c!=null&&c.role?`${c.role} (${((h=c.client)==null?void 0:h.name)||"System"})`:"System"},[c]),ee=h=>{l(B=>{var H;return{...B,measurementContract:{...(B==null?void 0:B.measurementContract)||{},auditLog:[h,...((H=B==null?void 0:B.measurementContract)==null?void 0:H.auditLog)||[]]}}})},ae=(h,B)=>{l(H=>{var ce;const he={...((ce=H==null?void 0:H.workspacePrefs)==null?void 0:ce.theme)||{enabled:!1,primaryColor:"#FF5733",accentColor:"#FF5733",fontFamily:"Inter"},[h]:B};return h!=="enabled"&&!he.enabled&&(he.enabled=!0),{...H,workspacePrefs:{...(H==null?void 0:H.workspacePrefs)||{},theme:he}}})},me=()=>{l(h=>{var U,he,ce;const B=!((U=h==null?void 0:h.workspacePrefs)!=null&&U.autoInspire),H={id:Date.now()+Math.random(),ts:new Date().toISOString(),actor:L,action:"TOGGLE_AUTO_INSPIRE",target:"workspacePrefs.autoInspire",oldValue:!!((he=h==null?void 0:h.workspacePrefs)!=null&&he.autoInspire),newValue:B};return{...h,workspacePrefs:{...(h==null?void 0:h.workspacePrefs)||{},autoInspire:B},measurementContract:{...(h==null?void 0:h.measurementContract)||{},auditLog:[H,...((ce=h==null?void 0:h.measurementContract)==null?void 0:ce.auditLog)||[]]}}}),o({title:"Auto-Inspirar atualizado",description:le?"Auto-Inspirar desativado.":"Auto-Inspirar ativado (somente em campos vazios/padr√£o).",type:"success"})},[pe,te]=m.useState(!1),ve=async()=>{te(!0);try{const h=r.vaults||{},B=await Oe.generateBrandTheme(h),H={enabled:!0,primaryColor:B.primaryColor,accentColor:B.accentColor,fontFamily:B.fontFamily};l(U=>({...U,workspacePrefs:{...(U==null?void 0:U.workspacePrefs)||{},theme:H}})),o({title:"Tema Gerado com Sucesso",description:`Identidade aplicada baseada em ${B.reasoning}`,type:"success",duration:5e3}),ee({id:Date.now(),ts:new Date().toISOString(),actor:L,action:"AI_GENERATE_THEME",target:"theme",details:B.reasoning})}catch(h){o({title:"Erro na Gera√ß√£o",description:h.message,type:"error"})}finally{te(!1)}},Se=()=>{if(!s){o({title:"Export indispon√≠vel",description:"Nenhum cliente ativo.",type:"error"});return}const h=ht.createWorkspaceExport(s),B=new Blob([h],{type:"application/json;charset=utf-8"}),H=URL.createObjectURL(B),U=document.createElement("a"),he=new Date().toISOString().slice(0,19).replace(/[:T]/g,"-");U.href=H,U.download=`bravvo-workspace-${s}-${he}.json`,document.body.appendChild(U),U.click(),U.remove(),URL.revokeObjectURL(H),ee({id:Date.now()+Math.random(),ts:new Date().toISOString(),actor:L,action:"EXPORT_WORKSPACE",target:s}),o({title:"Export gerado",description:"Arquivo baixado com sucesso.",type:"success"})},ye=h=>{var U;const B=((U=h.target.files)==null?void 0:U[0])||null;if(x(B),z(""),y(""),!B)return;const H=new FileReader;H.onload=he=>{var Be;const ce=String(((Be=he.target)==null?void 0:Be.result)||"");y(ce)},H.onerror=()=>{z("Falha ao ler o arquivo.")},H.readAsText(B)},E=()=>{var B;if(!s){o({title:"Import indispon√≠vel",description:"Nenhum cliente ativo.",type:"error"});return}if(!g.trim()){z("Selecione um arquivo para importar.");return}if(window.confirm("Isso vai substituir os dados do workspace atual por este arquivo. Deseja continuar?"))try{const H=ht.importWorkspaceExport(s,g,{clientName:((B=c==null?void 0:c.client)==null?void 0:B.name)||(r==null?void 0:r.clientName)||""});l(H),ee({id:Date.now()+Math.random(),ts:new Date().toISOString(),actor:L,action:"IMPORT_WORKSPACE",target:s,details:(w==null?void 0:w.name)||""}),o({title:"Import conclu√≠do",description:"Workspace restaurado com sucesso.",type:"success"}),a()}catch(H){const U=H instanceof Error?H.message:"Falha ao importar.";z(U),o({title:"Falha no import",description:U,type:"error"})}},X=h=>{if(!s||!window.confirm("Restaurar snapshot? Isso vai substituir o workspace atual."))return;const H=ht.restoreSnapshot(s,h);if(!H){o({title:"Snapshot inv√°lido",description:"N√£o foi poss√≠vel restaurar este snapshot.",type:"error"});return}l(H),ee({id:Date.now()+Math.random(),ts:new Date().toISOString(),actor:L,action:"RESTORE_SNAPSHOT",target:s,details:h}),o({title:"Snapshot restaurado",description:"Workspace restaurado com sucesso.",type:"success"}),a()},xe=()=>{if(!s){o({title:"Audit indispon√≠vel",description:"Nenhum cliente ativo.",type:"error"});return}const h=new Blob([JSON.stringify(oe,null,2)],{type:"application/json;charset=utf-8"}),B=URL.createObjectURL(h),H=document.createElement("a"),U=new Date().toISOString().slice(0,19).replace(/[:T]/g,"-");H.href=B,H.download=`bravvo-audit-${s}-${U}.json`,document.body.appendChild(H),H.click(),H.remove(),URL.revokeObjectURL(B)},Ae=h=>h?h.startsWith("AIzaSy")?"gemini":h.startsWith("sk-ant-")?"anthropic":h.startsWith("sk-")?"openai":null:null,ge=()=>{const h=Ae(T);let B=$;h&&h!==$&&(B=h,F(h),o({title:"Provider Detectado",description:`Usando ${h.toUpperCase()} baseado no formato da chave.`,type:"info"})),Oe.saveAIConfig({provider:B,apiKey:T,weights:Y}),o({title:"Configura√ß√£o salva",description:"API de IA configurada com sucesso.",type:"success"})},je=async()=>{if(!T||T.length<10){W("error"),R("Insira uma API Key v√°lida.");return}W("testing"),R("Testando conex√£o...");try{const h=await Oe.testAIConnection($,T);h.success?(W("success"),R(h.message),ge()):(W("error"),R(h.message))}catch(h){W("error"),R(h.message||"Erro ao testar conex√£o.")}};return t?e.jsx("div",{className:"fixed inset-0 z-[110] bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 animate-fadeIn","data-testid":"workspace-tools-modal",children:e.jsxs("div",{className:"bg-[#0A0A0A] border border-white/10 rounded-xl w-full max-w-3xl shadow-2xl flex flex-col max-h-[90vh]",children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b border-white/10 bg-[#0A0A0A]",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-bold text-white tracking-tight flex items-center gap-2",children:[e.jsx(Js,{size:20,className:"text-purple-400"}),"Workspace Tools"]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Cliente: ",e.jsx("span",{className:"text-white font-mono",children:s||"N/A"})]})]}),e.jsx("button",{onClick:a,className:"text-gray-500 hover:text-white transition-colors",children:e.jsx(Ge,{size:20})})]}),e.jsxs("div",{className:"flex border-b border-white/5 bg-[#050505]",children:[e.jsx("button",{onClick:()=>j("brand"),"data-testid":"workspace-tab-brand",className:`flex-1 py-3 text-xs font-bold uppercase tracking-wider transition-colors ${i==="brand"?"bg-[#111] text-white border-b-2 border-purple-500":"text-gray-500 hover:text-gray-300"}`,children:"Marca"}),e.jsx("button",{onClick:()=>j("ia"),"data-testid":"workspace-tab-ia",className:`flex-1 py-3 text-xs font-bold uppercase tracking-wider transition-colors ${i==="ia"?"bg-[#111] text-white border-b-2 border-purple-500":"text-gray-500 hover:text-gray-300"}`,children:e.jsxs("span",{className:"flex items-center justify-center gap-1",children:[e.jsx(at,{size:12})," IA"]})}),e.jsx("button",{onClick:()=>j("tools"),"data-testid":"workspace-tab-tools",className:`flex-1 py-3 text-xs font-bold uppercase tracking-wider transition-colors ${i==="tools"?"bg-[#111] text-white border-b-2 border-purple-500":"text-gray-500 hover:text-gray-300"}`,children:"Prefer√™ncias"}),e.jsx("button",{onClick:()=>j("backup"),"data-testid":"workspace-tab-backup",className:`flex-1 py-3 text-xs font-bold uppercase tracking-wider transition-colors ${i==="backup"?"bg-[#111] text-white border-b-2 border-purple-500":"text-gray-500 hover:text-gray-300"}`,children:"Backup"}),e.jsx("button",{onClick:()=>j("audit"),"data-testid":"workspace-tab-audit",className:`flex-1 py-3 text-xs font-bold uppercase tracking-wider transition-colors ${i==="audit"?"bg-[#111] text-white border-b-2 border-purple-500":"text-gray-500 hover:text-gray-300"}`,children:"Auditoria"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 bg-[#0A0A0A]",children:[i==="brand"&&e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-[#111] p-4 rounded-lg border border-white/10",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-bold text-white flex items-center gap-2",children:[e.jsx(Zs,{size:16,className:"text-purple-400"}),"Personaliza√ß√£o da Marca"]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Defina as cores e tipografia do sistema para alinhar com sua identidade visual."}),e.jsxs("button",{onClick:ve,disabled:pe,className:"mt-3 btn-primary text-xs flex items-center gap-2 !py-2 !h-auto w-full md:w-auto justify-center",children:[pe?e.jsx(nt,{size:14,className:"animate-spin"}):e.jsx(at,{size:14}),pe?"Analisando DNA da Marca...":"‚ú® Gerar Identidade Visual com IA"]})]}),e.jsxs("label",{className:"flex items-center gap-2 select-none",children:[e.jsx("input",{type:"checkbox",checked:se.enabled,onChange:h=>ae("enabled",h.target.checked),className:"h-4 w-4"}),e.jsx("span",{className:"text-xs font-bold uppercase tracking-wider text-gray-300",children:se.enabled?"Ativo":"Inativo"})]})]}),se.enabled&&e.jsxs("div",{className:"mb-4 text-[10px] text-green-400 flex items-center gap-2 animate-fadeIn bg-green-500/10 px-3 py-2 rounded border border-green-500/20",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-green-400 animate-pulse"}),"Sincronizado automaticamente com Vault 1 (Marca)"]}),e.jsxs("div",{className:`space-y-4 transition-opacity ${se.enabled?"opacity-100":"opacity-50 pointer-events-none"}`,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase mb-2",children:"Cor Prim√°ria (Textos/M√©tricas)"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"color",value:se.primaryColor,onChange:h=>ae("primaryColor",h.target.value),className:"w-10 h-10 rounded border border-white/10 bg-black cursor-pointer"}),e.jsx("input",{type:"text",value:se.primaryColor,onChange:h=>ae("primaryColor",h.target.value),className:"bg-black border border-white/10 rounded px-3 py-2 text-xs text-white font-mono w-24 focus:border-purple-500 focus:outline-none"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase mb-2",children:"Cor de Destaque (Bot√µes/Links)"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"color",value:se.accentColor,onChange:h=>ae("accentColor",h.target.value),className:"w-10 h-10 rounded border border-white/10 bg-black cursor-pointer"}),e.jsx("input",{type:"text",value:se.accentColor,onChange:h=>ae("accentColor",h.target.value),className:"bg-black border border-white/10 rounded px-3 py-2 text-xs text-white font-mono w-24 focus:border-purple-500 focus:outline-none"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase mb-2",children:"Tipografia Principal"}),e.jsxs("select",{value:se.fontFamily,onChange:h=>ae("fontFamily",h.target.value),className:"w-full bg-black border border-white/10 rounded px-3 py-2 text-xs text-white focus:border-purple-500 focus:outline-none",children:[e.jsx("option",{value:"Inter",children:"Inter (Padr√£o - Moderno)"}),e.jsx("option",{value:"Roboto",children:"Roboto (Google - Neutro)"}),e.jsx("option",{value:"Open Sans",children:"Open Sans (Leg√≠vel)"}),e.jsx("option",{value:"Lato",children:"Lato (Elegante)"}),e.jsx("option",{value:"Montserrat",children:"Montserrat (Geom√©trico)"}),e.jsx("option",{value:"Playfair Display",children:"Playfair Display (Serif - Cl√°ssico)"}),e.jsx("option",{value:"Courier Prime",children:"Courier Prime (Monospace - T√©cnico)"})]})]}),e.jsx("div",{className:"pt-2 border-t border-white/5",children:e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[e.jsx("span",{children:"Visualiza√ß√£o em tempo real"}),e.jsx("button",{onClick:()=>l(h=>({...h,workspacePrefs:{...(h==null?void 0:h.workspacePrefs)||{},theme:{enabled:!1,primaryColor:"#FF5733",accentColor:"#FF5733",fontFamily:"Inter"}}})),className:"text-red-400 hover:text-red-300 transition-colors",children:"Resetar Padr√µes"})]})})]})]})}),i==="ia"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-[#111] p-4 rounded-lg border border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(at,{size:20,className:"text-purple-400"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-bold text-white",children:"Integra√ß√£o com IA"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Configure sua API para gera√ß√£o autom√°tica de planos e KPIs."})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase mb-2",children:"Provedor"}),e.jsxs("select",{value:$,onChange:h=>F(h.target.value),className:"w-full bg-black border border-white/10 rounded px-3 py-2 text-xs text-white focus:border-purple-500 focus:outline-none",children:[e.jsx("option",{value:"openai",children:"OpenAI (GPT-4o)"}),e.jsx("option",{value:"anthropic",children:"Anthropic (Claude 3.5 Sonnet)"}),e.jsx("option",{value:"gemini",children:"Google (Gemini Free Tier)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase mb-2",children:"API Key"}),e.jsx("input",{type:"password",value:T,onChange:h=>G(h.target.value),placeholder:$==="openai"?"sk-...":$==="anthropic"?"sk-ant-...":"AIzaSy...",className:"w-full bg-black border border-white/10 rounded px-3 py-2 text-xs text-white font-mono focus:border-purple-500 focus:outline-none"}),e.jsxs("div",{className:"flex justify-between items-start mt-1",children:[e.jsx("p",{className:"text-[10px] text-gray-500",children:"A chave √© armazenada apenas no seu navegador (localStorage)."}),$==="gemini"&&e.jsx("a",{href:"https://aistudio.google.com/app/apikey",target:"_blank",rel:"noopener noreferrer",className:"text-[10px] text-purple-400 hover:text-purple-300 underline",children:"Obter chave gr√°tis (Google AI Studio)"})]})]}),e.jsxs("div",{className:"pt-4 border-t border-white/5",children:[e.jsxs("div",{className:"text-xs font-bold text-gray-400 uppercase mb-3 flex justify-between",children:[e.jsx("span",{children:"Pondera√ß√£o Estrat√©gica"}),e.jsxs("span",{className:"text-purple-400",children:[Y.strategy+Y.lastGov+Y.history,"% Total"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-xs mb-1",children:[e.jsx("span",{className:"text-gray-300",children:"Estrat√©gia (Vaults)"}),e.jsxs("span",{className:"font-mono text-purple-400",children:[Y.strategy,"%"]})]}),e.jsx("input",{type:"range",min:"0",max:"100",step:"5",value:Y.strategy,onChange:h=>ne(B=>({...B,strategy:Number(h.target.value)})),className:"w-full h-1 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-purple-500"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-xs mb-1",children:[e.jsx("span",{className:"text-gray-300",children:"√öltima Governan√ßa (Corre√ß√£o)"}),e.jsxs("span",{className:"font-mono text-purple-400",children:[Y.lastGov,"%"]})]}),e.jsx("input",{type:"range",min:"0",max:"100",step:"5",value:Y.lastGov,onChange:h=>ne(B=>({...B,lastGov:Number(h.target.value)})),className:"w-full h-1 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-purple-500"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-xs mb-1",children:[e.jsx("span",{className:"text-gray-300",children:"Hist√≥rico (Padr√µes)"}),e.jsxs("span",{className:"font-mono text-purple-400",children:[Y.history,"%"]})]}),e.jsx("input",{type:"range",min:"0",max:"100",step:"5",value:Y.history,onChange:h=>ne(B=>({...B,history:Number(h.target.value)})),className:"w-full h-1 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-purple-500"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:je,disabled:q==="testing",className:"btn-primary !h-9 !px-4 flex items-center gap-2",children:q==="testing"?e.jsxs(e.Fragment,{children:[e.jsx(nt,{size:14,className:"animate-spin"})," Testando..."]}):e.jsx(e.Fragment,{children:"Testar Conex√£o"})}),e.jsx("button",{onClick:ge,className:"btn-ghost !h-9 !px-4",children:"Salvar"})]}),q&&q!=="testing"&&e.jsx("div",{className:`text-xs px-3 py-2 rounded border ${q==="success"?"bg-green-500/10 border-green-500/20 text-green-400":"bg-red-500/10 border-red-500/20 text-red-400"}`,children:ie})]})]}),e.jsxs("div",{className:"bg-[#111] p-4 rounded-lg border border-white/10",children:[e.jsx("div",{className:"text-sm font-bold text-white mb-2",children:"Como usar"}),e.jsxs("ol",{className:"text-xs text-gray-400 space-y-2 list-decimal list-inside",children:[e.jsx("li",{children:"Configure sua API Key acima."}),e.jsx("li",{children:"Preencha os Vaults (S1-S5) com os dados do cliente."}),e.jsxs("li",{children:["Na Governan√ßa, clique em ",e.jsx("strong",{className:"text-white",children:'"ü§ñ Gerar com IA"'}),"."]}),e.jsx("li",{children:"O sistema enviar√° os dados para a IA e receber√° um plano t√°tico com KPIs personalizados."})]})]})]}),i==="tools"&&e.jsx("div",{className:"space-y-6",children:e.jsx("div",{className:"bg-[#111] p-4 rounded-lg border border-white/10",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-bold text-white",children:"Auto-Inspirar"}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Quando ligado, o sistema pode aplicar templates automaticamente (somente em campos vazios/padr√£o)."})]}),e.jsxs("label",{className:"flex items-center gap-2 select-none","data-testid":"workspace-auto-inspire",children:[e.jsx("input",{type:"checkbox",checked:le,onChange:me,className:"h-4 w-4"}),e.jsx("span",{className:"text-xs font-bold uppercase tracking-wider text-gray-300",children:le?"ON":"OFF"})]})]})})}),i==="backup"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-[#111] p-4 rounded-lg border border-white/10 flex items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-bold text-white",children:"Exportar Workspace"}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Gera um JSON versionado com checksum (para restore confi√°vel)."})]}),e.jsxs("button",{onClick:Se,className:"btn-ghost !h-8 !px-3","data-testid":"workspace-export",children:[e.jsx(ns,{size:14})," Exportar"]})]}),e.jsxs("div",{className:"bg-[#111] p-4 rounded-lg border border-white/10",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-bold text-white",children:"Importar Workspace"}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Substitui o workspace atual por um export v√°lido."})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("input",{type:"file",accept:"application/json,.json",onChange:ye,className:"block w-full text-xs text-gray-400","data-testid":"workspace-import-file"}),_&&e.jsx("div",{className:"mt-2 text-xs text-red-400",children:_}),e.jsx("button",{onClick:E,className:"btn-primary !h-8 !px-3 mt-3","data-testid":"workspace-import-apply",disabled:!g.trim(),children:"Aplicar Import"})]}),e.jsx("div",{children:e.jsx("textarea",{className:"w-full bg-black border border-white/10 rounded px-3 py-2 text-white font-mono text-[11px] focus:border-purple-500 focus:outline-none transition-colors min-h-[140px]",placeholder:"Preview do arquivo...",value:g,readOnly:!0})})]})]}),e.jsxs("div",{className:"bg-[#111] p-4 rounded-lg border border-white/10",children:[e.jsxs("div",{className:"text-sm font-bold text-white",children:["Snapshots (√∫ltimos ",M.length,")"]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Restaurar um snapshot substitui o workspace atual."}),e.jsx("div",{className:"mt-3 space-y-2","data-testid":"workspace-snapshots",children:M.length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"Nenhum snapshot dispon√≠vel."}):M.map(h=>e.jsxs("div",{className:"flex items-center justify-between gap-3 border border-white/5 rounded px-3 py-2 bg-black/20",children:[e.jsx("div",{className:"text-xs text-gray-300 font-mono",children:h.ts}),e.jsx("button",{onClick:()=>X(h.ts),className:"btn-ghost !h-7 !px-3","data-testid":`workspace-restore-${h.ts}`,children:"Restaurar"})]},h.ts))})]})]}),i==="audit"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-bold text-white",children:"Audit Log"}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Registro local por cliente (a√ß√µes cr√≠ticas do workspace)."})]}),e.jsxs("button",{onClick:xe,className:"btn-ghost !h-8 !px-3","data-testid":"workspace-audit-download",children:[e.jsx(ns,{size:14})," Baixar"]})]}),e.jsx("div",{className:"border border-white/10 rounded-lg overflow-hidden",children:e.jsx("div",{className:"max-h-[340px] overflow-y-auto",children:oe.length===0?e.jsx("div",{className:"p-4 text-xs text-gray-500",children:"Nenhum evento registrado."}):oe.slice(0,50).map(h=>e.jsxs("div",{className:"px-4 py-3 border-b border-white/5 bg-black/10",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("div",{className:"text-xs text-white font-mono",children:h==null?void 0:h.action}),e.jsx("div",{className:"text-[10px] text-gray-500 font-mono",children:h==null?void 0:h.ts})]}),e.jsx("div",{className:"mt-1 text-[11px] text-gray-400",children:h==null?void 0:h.actor}),((h==null?void 0:h.target)||(h==null?void 0:h.details))&&e.jsxs("div",{className:"mt-1 text-[11px] text-gray-500 font-mono",children:[String((h==null?void 0:h.target)||""),h!=null&&h.details?` ‚Ä¢ ${String(h.details)}`:""]})]},String(h==null?void 0:h.id)))})})]})]}),e.jsx("div",{className:"p-4 border-t border-white/10 bg-[#0A0A0A] flex justify-end gap-3",children:e.jsx("button",{onClick:a,className:"px-4 py-2 rounded text-xs font-bold text-gray-400 hover:text-white transition-colors",children:"FECHAR"})})]})}):null}function Pr({appData:t}){var a;return m.useEffect(()=>{var l;const s=(l=t==null?void 0:t.workspacePrefs)==null?void 0:l.theme,r=document.documentElement;if(s!=null&&s.enabled){if(r.setAttribute("data-theme","custom"),s.fontFamily&&s.fontFamily!=="Inter"){r.style.setProperty("--brand-font",s.fontFamily);const c=s.fontFamily,n="bravvo-dynamic-font";let o=document.getElementById(n);o||(o=document.createElement("link"),o.id=n,o.rel="stylesheet",document.head.appendChild(o));const i=c.replace(/\s+/g,"+");o.href=`https://fonts.googleapis.com/css2?family=${i}:wght@300;400;500;600;700&display=swap`}else{r.style.setProperty("--brand-font","Inter");const c=document.getElementById("bravvo-dynamic-font");c&&c.remove()}s.primaryColor?r.style.setProperty("--brand-primary",s.primaryColor):r.style.removeProperty("--brand-primary"),s.accentColor?(r.style.setProperty("--brand-accent",s.accentColor),r.style.setProperty("--accent-purple",s.accentColor)):(r.style.removeProperty("--brand-accent"),r.style.removeProperty("--accent-purple"))}else{r.removeAttribute("data-theme"),r.style.removeProperty("--brand-font"),r.style.removeProperty("--brand-primary"),r.style.removeProperty("--brand-accent"),r.style.removeProperty("--accent-purple");const c=document.getElementById("bravvo-dynamic-font");c&&c.remove()}},[(a=t==null?void 0:t.workspacePrefs)==null?void 0:a.theme]),null}const $r={"01":[{day:"07",title:"Dia do Leitor",tags:["educacao","livros"]},{day:"26",title:"Dia da Gula",tags:["gastronomia"]},{day:"30",title:"Dia da Saudade",tags:["geral"]}],"02":[{day:"01",title:"Dia do Publicit√°rio",tags:["b2b"]},{day:"14",title:"Valentine's Day",tags:["varejo","geral"]},{day:"19",title:"Dia do Esportista",tags:["saude","esportes"]}],"03":[{day:"08",title:"Dia da Mulher",tags:["geral","varejo"]},{day:"15",title:"Dia do Consumidor",tags:["varejo","ecommerce"],importance:"high"},{day:"31",title:"Dia da Sa√∫de",tags:["saude"]}],"04":[{day:"01",title:"Dia da Mentira",tags:["criativo"]},{day:"07",title:"Dia Mundial da Sa√∫de",tags:["saude"]},{day:"28",title:"Dia do Frete Gr√°tis",tags:["ecommerce","varejo"]}],"05":[{day:"01",title:"Dia do Trabalho",tags:["geral"]},{day:"04",title:"Star Wars Day",tags:["geek","tech"]},{day:"25",title:"Dia do Orgulho Geek",tags:["geek","tech"]},{day:"28",title:"Dia do Hamb√∫rguer",tags:["gastronomia"]}],"06":[{day:"12",title:"Dia dos Namorados",tags:["varejo","gastronomia"],importance:"high"},{day:"18",title:"Dia da Gastronomia Sustent√°vel",tags:["gastronomia"]},{day:"28",title:"Dia do Orgulho LGBTQIA+",tags:["geral"]}],"07":[{day:"10",title:"Dia da Pizza",tags:["gastronomia"],importance:"high"},{day:"13",title:"Dia Mundial do Rock",tags:["cultura","bares"]},{day:"20",title:"Dia do Amigo",tags:["geral"]},{day:"26",title:"Dia dos Av√≥s",tags:["familia"]}],"08":[{day:"11",title:"Dia do Estudante",tags:["educacao"]},{day:"15",title:"Dia dos Solteiros",tags:["festas","bares"]},{day:"29",title:"Dia do Gamer",tags:["tech","geek"]}],"09":[{day:"05",title:"Dia do Irm√£o",tags:["familia"]},{day:"13",title:"Dia do Programador",tags:["tech"]},{day:"15",title:"Dia do Cliente",tags:["varejo","b2b"],importance:"high"}],10:[{day:"01",title:"Dia do Vendedor",tags:["b2b"]},{day:"04",title:"Dia dos Animais",tags:["pet"]},{day:"12",title:"Dia das Crian√ßas",tags:["familia","varejo"]},{day:"16",title:"Dia da Alimenta√ß√£o",tags:["gastronomia","saude"]},{day:"31",title:"Halloween",tags:["festas","geral"]}],11:[{day:"01",title:"Dia do Sushi",tags:["gastronomia"]},{day:"11",title:"Singles Day",tags:["ecommerce"]},{day:"19",title:"Dia do Empreendedorismo Feminino",tags:["b2b"]},{day:"24",title:"Black Friday",tags:["varejo","ecommerce"],importance:"high"}],12:[{day:"25",title:"Natal",tags:["geral"],importance:"high"},{day:"31",title:"Ano Novo",tags:["geral"],importance:"high"}]};function Rs({open:t,onClose:a,appData:s,roadmapItems:r=[]}){var O,$,F;if(!t)return null;const[l,c]=m.useState(new Date),n=((O=s==null?void 0:s.vaults)==null?void 0:O.s1)||((F=($=s==null?void 0:s.vaults)==null?void 0:$.S1)==null?void 0:F.fields)||{},o=(n.niche||"geral").toLowerCase(),i=n.scope||"local",j=n.location||"N√£o definido",w=new Date(l.getFullYear(),l.getMonth(),1),x=new Date(l.getFullYear(),l.getMonth()+1,0).getDate(),g=w.getDay(),y=m.useMemo(()=>{const T=String(l.getMonth()+1).padStart(2,"0"),G=l.getFullYear(),W=($r[T]||[]).filter(R=>!!(R.tags.includes("geral")||o!=="geral"&&R.tags.some(Y=>o.includes(Y)||Y.includes(o))||R.importance==="high")).map(R=>({date:`${R.day}-${T}`,title:R.title,type:"opportunity",importance:R.importance})),ie=r.filter(R=>R.date&&R.status!=="cancelled").map(R=>{const Y=new Date(R.date);return Y.getMonth()!==l.getMonth()||Y.getFullYear()!==G?null:{date:`${String(Y.getDate()).padStart(2,"0")}-${T}`,title:R.initiative||R.title||"A√ß√£o",type:"action",status:R.status,channel:R.channel}}).filter(Boolean);return[...W,...ie]},[l,o,r]),_=T=>{const G=`${String(T).padStart(2,"0")}-${String(l.getMonth()+1).padStart(2,"0")}`;return y.filter(q=>q.date===G)},z=()=>{c(new Date(l.getFullYear(),l.getMonth()-1,1))},M=()=>{c(new Date(l.getFullYear(),l.getMonth()+1,1))};return e.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-[60] p-4 backdrop-blur-sm animate-fadeIn",children:e.jsxs("div",{className:"bg-[#111] border border-white/10 rounded-xl w-full max-w-5xl shadow-2xl flex flex-col max-h-[90vh]",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-white/5",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-pink-500/20 flex items-center justify-center text-pink-400",children:e.jsx(ke,{size:20})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Calend√°rio Estrat√©gico"}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-gray-400 mt-1",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ya,{size:10})," ",o.toUpperCase()]}),e.jsx("span",{className:"w-px h-3 bg-white/10"}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(wa,{size:10})," ",j," (",i,")"]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex gap-2 text-[10px] uppercase tracking-wider font-bold",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-pink-500/50"})," Oportunidade"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-green-500"})," A√ß√£o Agendada"]})]}),e.jsx("button",{onClick:a,className:"text-gray-400 hover:text-white transition-colors",children:e.jsx(Ge,{size:24})})]})]}),e.jsxs("div",{className:"flex-1 overflow-auto p-6 bg-[#0A0A0A]",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-bold text-white capitalize flex items-center gap-2",children:l.toLocaleDateString("pt-BR",{month:"long",year:"numeric"})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:z,className:"p-2 hover:bg-white/5 rounded-lg text-gray-400 hover:text-white",children:e.jsx(Na,{size:20})}),e.jsx("button",{onClick:M,className:"p-2 hover:bg-white/5 rounded-lg text-gray-400 hover:text-white",children:e.jsx(tt,{size:20})})]})]}),e.jsxs("div",{className:"grid grid-cols-7 gap-4",children:[["Dom","Seg","Ter","Qua","Qui","Sex","S√°b"].map(T=>e.jsx("div",{className:"text-center text-xs font-bold text-gray-500 uppercase tracking-wider py-2",children:T},T)),Array.from({length:g}).map((T,G)=>e.jsx("div",{className:"min-h-[100px] bg-transparent"},`empty-${G}`)),Array.from({length:x}).map((T,G)=>{const q=G+1,W=_(q),ie=q===new Date().getDate()&&l.getMonth()===new Date().getMonth()&&l.getFullYear()===new Date().getFullYear();return W.sort((R,Y)=>R.type==="action"&&Y.type!=="action"?-1:Y.type==="action"&&R.type!=="action"?1:0),e.jsxs("div",{className:`min-h-[120px] rounded-xl border p-3 transition-all relative group
                                        ${ie?"bg-purple-500/5 border-purple-500/30 ring-1 ring-purple-500/20":"bg-[#121212] border-white/5 hover:border-white/10 hover:bg-[#151515]"}
                                    `,children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("span",{className:`text-sm font-bold ${ie?"text-purple-400":"text-gray-500 group-hover:text-gray-300"}`,children:q}),W.some(R=>R.type==="action")&&e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-green-500 animate-pulse"})]}),e.jsxs("div",{className:"mt-3 space-y-1.5 overflow-hidden",children:[W.slice(0,4).map((R,Y)=>e.jsxs("div",{className:`text-[9px] px-2 py-1 rounded truncate flex items-center gap-1 font-medium
                                                    ${R.type==="action"?"bg-green-500/20 text-green-300 border border-green-500/20":"bg-pink-500/10 text-pink-300/70 border border-pink-500/10 hover:bg-pink-500/20 hover:text-pink-200"}
                                                `,title:R.title,children:[R.type==="action"&&e.jsx(Ce,{size:8}),R.type==="opportunity"&&e.jsx(bs,{size:8}),R.title]},Y)),W.length>4&&e.jsxs("div",{className:"text-[9px] text-gray-600 text-center py-0.5",children:["+",W.length-4," mais..."]})]})]},q)})]})]}),e.jsx("div",{className:"p-4 border-t border-white/5 bg-[#111] text-xs text-gray-500 flex justify-between",children:e.jsxs("span",{children:["*Datas comerciais baseadas no perfil ",e.jsx("strong",{children:o}),"."]})})]})})}const Er={BASE_URL:"/BravvoOS/",DEV:!1,MODE:"production",PROD:!0,SSR:!1},Fr="bravvo_feature_flags";function Or(){try{const t=localStorage.getItem(Fr);if(!t)return{};const a=JSON.parse(t);return a&&typeof a=="object"?a:{}}catch{return{}}}function Us(t){return String(t||"").trim().toUpperCase().replace(/[^A-Z0-9_]/g,"_")}function Gr(t){const s=`VITE_FLAG_${Us(t)}`,r=typeof import.meta<"u"?Er:void 0,l=r?r[s]:void 0;if(l===void 0)return;if(l===!0)return!0;if(l===!1)return!1;const c=String(l).trim().toLowerCase();if(["1","true","yes","on"].includes(c))return!0;if(["0","false","no","off"].includes(c))return!1}function qe(t,a){const s=Us(t),r=Gr(s);if(r!==void 0)return r;if(typeof window>"u")return a;const l=Or();return Object.prototype.hasOwnProperty.call(l,s)?!!l[s]:a}function zr(t={}){const{timeout:a=1e4,onUndo:s,onCommit:r}=t,{addToast:l}=zt(),[c,n]=m.useState(null),o=m.useRef(null),i=m.useCallback(({action:x,undoAction:g,description:y,type:_="info"})=>{o.current&&(clearTimeout(o.current),c!=null&&c.commit&&c.commit()),x();const z={undoAction:g,description:y,commit:r,executedAt:Date.now()};return n(z),l({title:y,description:"Clique para desfazer",type:_,duration:a,action:{label:"Desfazer",onClick:()=>{o.current&&clearTimeout(o.current),g(),n(null),s==null||s(),l({title:"A√ß√£o desfeita",type:"success",duration:2e3})}}}),o.current=setTimeout(()=>{n(null),r==null||r()},a),z},[c,a,l,s,r]),j=m.useCallback(()=>{c&&(o.current&&clearTimeout(o.current),c.undoAction(),n(null),s==null||s())},[c,s]),w=m.useCallback(()=>{o.current&&clearTimeout(o.current),n(null),r==null||r()},[r]);return{executeWithUndo:i,undo:j,commit:w,hasPendingAction:!!c,pendingAction:c}}function Et({value:t,onSave:a,type:s="text",prefix:r="",suffix:l="",className:c="",disabled:n=!1}){const[o,i]=m.useState(!1),[j,w]=m.useState(t),x=m.useRef(null);m.useEffect(()=>{o||w(t)},[t,o]),m.useEffect(()=>{o&&x.current&&(x.current.focus(),x.current.select())},[o]);const g=()=>{a(j),i(!1)},y=_=>{_.key==="Enter"&&(_.preventDefault(),g()),_.key==="Escape"&&(w(t),i(!1))};return o?e.jsxs("div",{className:"flex items-center gap-1",children:[r&&e.jsx("span",{className:"text-gray-500 text-xs",children:r}),e.jsx("input",{ref:x,type:s,value:j,onChange:_=>w(_.target.value),onClick:_=>_.stopPropagation(),onBlur:_=>{_.stopPropagation(),g()},onKeyDown:y,className:`bg-black/50 border border-purple-500/50 rounded px-1 min-w-[60px] text-white focus:outline-none ${c}`}),l&&e.jsx("span",{className:"text-gray-500 text-xs",children:l})]}):e.jsxs("span",{onClick:_=>{_.stopPropagation(),n||i(!0)},className:`${n?"cursor-default opacity-90":"cursor-pointer hover:bg-white/10"} px-1 rounded transition-colors group relative ${c}`,title:n?"Habilite o Modo Governan√ßa para editar":"Clique para editar",children:[r,t,l]})}function Mr({value:t,displayValue:a,onSave:s,disabled:r=!1,className:l=""}){const[c,n]=m.useState(!1),[o,i]=m.useState(t||""),j=m.useRef(null);m.useEffect(()=>{c&&j.current&&(j.current.focus(),j.current.select())},[c]),m.useEffect(()=>{c||i(t||"")},[t,c]);const w=()=>{const g=String(o||"");if(!g){n(!1),i(t||"");return}s==null||s(g),n(!1)},x=g=>{g.key==="Enter"&&(g.preventDefault(),w()),g.key==="Escape"&&(g.preventDefault(),i(t||""),n(!1))};return c?e.jsx("input",{ref:j,type:"date",value:o,onChange:g=>i(g.target.value),onClick:g=>g.stopPropagation(),onBlur:g=>{g.stopPropagation(),w()},onKeyDown:x,disabled:r,className:`bg-black/30 border border-white/10 rounded px-2 py-1 text-[11px] text-gray-200 focus:outline-none focus:border-purple-500/50 ${l}`}):e.jsx("span",{onClick:g=>{g.stopPropagation(),r||n(!0)},className:`${r?"cursor-default":"cursor-pointer hover:bg-white/10"} rounded px-1 py-0.5 transition-colors ${l}`,children:a})}function ea({onAdd:t,onClose:a}){const{t:s}=it(),[r,l]=m.useState({initiative:"",microDescription:"",channelId:"instagram",subchannelId:"feed",channel:"Instagram Feed",format:"post",date:new Date().toISOString().split("T")[0],responsible:""}),c=n=>{n.preventDefault(),t({id:`NEW-${Date.now()}`,...r,status:"draft",offerId:"hero",ctaId:"whatsapp"}),a(),l({initiative:"",microDescription:"",channelId:"instagram",subchannelId:"feed",channel:"Instagram Feed",format:"post",date:new Date().toISOString().split("T")[0],responsible:""})};return e.jsxs("form",{onSubmit:c,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-label",children:s("os.quick_add.title_label")}),e.jsx("input",{required:!0,className:"premium-input",value:r.initiative,onChange:n=>l({...r,initiative:n.target.value}),placeholder:s("os.quick_add.placeholder"),"data-testid":"quickadd-initiative"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-label",children:"Micro descri√ß√£o"}),e.jsx("input",{className:"premium-input",value:r.microDescription,onChange:n=>l({...r,microDescription:n.target.value}),placeholder:"1 linha: objetivo / CTA / detalhe"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-label",children:s("os.quick_add.date_label")}),e.jsx("input",{type:"date",className:"premium-input",value:r.date,onChange:n=>l({...r,date:n.target.value}),"data-testid":"quickadd-date"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-label",children:s("os.quick_add.channel_label")}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("select",{className:"premium-input",value:r.channelId,onChange:n=>{const o=n.target.value,i=Ke(o);l(j=>({...j,channelId:o,subchannelId:i,channel:ze(o,i),format:Ye(o,i)}))},children:Mt().map(n=>e.jsx("option",{value:n.id,children:n.label},n.id))}),e.jsx("select",{className:"premium-input",value:r.subchannelId,onChange:n=>{const o=n.target.value,i=r.channelId;l(j=>({...j,subchannelId:o,channel:ze(i,o),format:Ye(i,o)}))},children:Lt(r.channelId).map(n=>e.jsx("option",{value:n.id,children:n.label},n.id))})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-label",children:"Respons√°vel"}),e.jsx("input",{className:"premium-input",value:r.responsible,onChange:n=>l({...r,responsible:n.target.value}),placeholder:"Quem executa?"})]}),e.jsxs("div",{className:"pt-4 flex justify-end gap-2",children:[e.jsx("button",{type:"button",onClick:a,className:"btn-ghost",children:s("common.cancel")}),e.jsx("button",{type:"submit",className:"btn-primary","data-testid":"quickadd-submit",children:s("os.quick_add.create_button")})]})]})}function Lr({value:t,onChange:a,options:s,testId:r}){const[l,c]=m.useState(!1),n=m.useRef(null);m.useEffect(()=>{const i=j=>{n.current&&!n.current.contains(j.target)&&c(!1)};return document.addEventListener("mousedown",i),()=>document.removeEventListener("mousedown",i)},[]);const o={scheduled:"bg-green-500",draft:"bg-gray-500",pending:"bg-yellow-500",in_production:"bg-yellow-500",done:"bg-blue-500",delayed:"bg-red-500",cancelled:"bg-gray-500"};return e.jsxs("div",{ref:n,className:"relative",children:[e.jsxs("button",{onClick:()=>c(!l),className:"flex items-center gap-2 px-2 py-1 rounded hover:bg-white/5 transition-colors","data-testid":r?`${r}-trigger`:void 0,children:[e.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${o[t]||"bg-gray-500"}`}),e.jsx("span",{className:"text-[10px] font-bold uppercase tracking-wider text-gray-300",children:t.replace("_"," ")})]}),l&&e.jsx("div",{className:"absolute top-full left-0 mt-1 bg-[#111] border border-white/10 rounded-lg shadow-xl z-50 min-w-[140px] py-1 overflow-hidden",children:s.map(i=>e.jsxs("button",{onClick:()=>{a(i.value),c(!1)},className:"w-full text-left px-3 py-2 text-[10px] font-bold uppercase tracking-wider hover:bg-white/10 flex items-center gap-2 text-gray-400 hover:text-white transition-colors","data-testid":r?`${r}-opt-${i.value}`:void 0,children:[e.jsx("span",{className:`w-1.5 h-1.5 rounded-full ${i.color.replace("bg-","bg-")}`}),i.label]},i.value))})]})}function ta({item:t,onSave:a,onClose:s}){const{t:r}=it(),[l,c]=m.useState(t||{});m.useEffect(()=>{if(!t)return;const o=Ot(t.channel||"Instagram Feed"),i=t.channelId||o.channelId,j=t.subchannelId||o.subchannelId||Ke(i),w=t.channel||ze(i,j),x=t.format||Ye(i,j);c({...t,channelId:i,subchannelId:j,channel:w,format:x})},[t]);const n=o=>{o.preventDefault(),a(l),s()};return e.jsxs("form",{onSubmit:n,className:"flex flex-col h-full",children:[e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-6 space-y-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-label",children:r("os.detail_edit.title_label")}),e.jsx("input",{required:!0,className:"premium-input bg-[#111]",value:l.initiative||"",onChange:o=>c({...l,initiative:o.target.value}),"data-testid":"detail-edit-initiative"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-label",children:"Micro descri√ß√£o"}),e.jsx("input",{className:"premium-input bg-[#111]",value:l.microDescription||"",onChange:o=>c({...l,microDescription:o.target.value}),placeholder:"1 linha: objetivo / CTA / detalhe"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-label",children:"Objetivo"}),e.jsx("input",{className:"premium-input bg-[#111]",value:l.objective||"",onChange:o=>c({...l,objective:o.target.value}),placeholder:"Qual √© o objetivo desta atividade?"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-label",children:"CTA"}),e.jsx("input",{className:"premium-input bg-[#111]",value:l.ctaText||"",onChange:o=>c({...l,ctaText:o.target.value}),placeholder:"Ex: Chamar no WhatsApp"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-label",children:"Depend√™ncias"}),e.jsx("input",{className:"premium-input bg-[#111]",value:l.dependencies||"",onChange:o=>c({...l,dependencies:o.target.value}),placeholder:"Ex: aprova√ß√£o do dono / fotos"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-label",children:"Crit√©rio de sucesso"}),e.jsx("input",{className:"premium-input bg-[#111]",value:l.successCriteria||"",onChange:o=>c({...l,successCriteria:o.target.value}),placeholder:"Ex: 30 cliques / 5 reservas"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-label",children:r("os.detail_edit.date_label")}),e.jsx("input",{type:"date",className:"premium-input bg-[#111]",value:l.date||"",onChange:o=>c({...l,date:o.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-label",children:"Respons√°vel"}),e.jsx("input",{className:"premium-input bg-[#111]",value:l.responsible||"",onChange:o=>c({...l,responsible:o.target.value}),placeholder:"Quem executa?"})]})]}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"text-label",children:r("os.detail_edit.channel_label")}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("select",{className:"premium-input bg-[#111]",value:l.channelId||"instagram",onChange:o=>{const i=o.target.value,j=Ke(i);c(w=>({...w,channelId:i,subchannelId:j,channel:ze(i,j),format:Ye(i,j)}))},children:Mt().map(o=>e.jsx("option",{value:o.id,children:o.label},o.id))}),e.jsx("select",{className:"premium-input bg-[#111]",value:l.subchannelId||Ke(l.channelId||"instagram")||"",onChange:o=>{const i=o.target.value,j=l.channelId||"instagram";c(w=>({...w,subchannelId:i,channel:ze(j,i),format:Ye(j,i)}))},children:Lt(l.channelId||"instagram").map(o=>e.jsx("option",{value:o.id,children:o.label},o.id))})]})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"text-label",children:r("os.detail_edit.copy_label")}),e.jsx("textarea",{className:"premium-input bg-[#111] min-h-[100px]",placeholder:r("os.detail_edit.copy_placeholder"),value:l.caption||"",onChange:o=>c({...l,caption:o.target.value}),"data-testid":"detail-edit-caption"})]})]})}),e.jsxs("div",{className:"p-4 border-t border-white/10 bg-[#0A0A0A] flex justify-end gap-2",children:[e.jsx("button",{type:"button",onClick:s,className:"btn-ghost",children:r("common.cancel")}),e.jsx("button",{type:"submit",className:"btn-primary","data-testid":"detail-edit-save",children:r("os.detail_edit.save")})]})]})}function Vr({open:t,onClose:a,item:s,onSave:r}){const{t:l}=it();return!t||!s?null:e.jsx("div",{className:"fixed inset-0 z-[100] bg-black/80 backdrop-blur-sm flex items-center justify-center p-4","data-testid":"detail-edit-modal",children:e.jsxs("div",{className:"bg-[#0A0A0A] border border-white/10 rounded-lg w-full max-w-2xl animate-fadeIn flex flex-col max-h-[90vh] shadow-2xl",children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-white/10 bg-[#0A0A0A]",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-bold text-white uppercase tracking-widest",children:l("os.detail_edit.title")}),e.jsxs("p",{className:"text-[10px] text-gray-500 font-mono",children:["ID: ",s.id]})]}),e.jsx("button",{onClick:a,className:"text-gray-500 hover:text-white p-2",children:e.jsx(Ge,{size:16})})]}),e.jsx(ta,{item:s,onSave:r,onClose:a})]})})}function Rr({open:t,onClose:a,onAdd:s}){const{t:r}=it();return t?e.jsx("div",{className:"fixed inset-0 z-[100] bg-black/80 backdrop-blur-sm flex items-center justify-center p-4","data-testid":"quickadd-modal",children:e.jsxs("div",{className:"bg-[#0A0A0A] border border-white/10 rounded-lg w-full max-w-lg p-6 shadow-2xl",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-sm font-bold text-white uppercase tracking-widest",children:r("os.quick_add.title")}),e.jsx("button",{onClick:a,className:"text-gray-500 hover:text-white",children:e.jsx(Ge,{size:16})})]}),e.jsx(ea,{onAdd:s,onClose:a})]})}):null}function qr({appData:t,setAppData:a,setActiveTab:s,onGeneratePrompt:r,formData:l,setFormData:c,meetingState:n,setMeetingState:o,currentUser:i,isWorkspaceLoading:j}){var fs,vs,js,ys,ws,Ns,Cs,Ss,As,Is,ks,_s;const{t:w}=it(),{addToast:x}=zt(),g=((fs=i==null?void 0:i.client)==null?void 0:fs.id)||(t==null?void 0:t.id)||null,y=()=>{var N,C,p;const d=((N=i==null?void 0:i.client)==null?void 0:N.id)||(t==null?void 0:t.id)||null;if(!d){x({title:"Reset indispon√≠vel",description:"Nenhum cliente ativo.",type:"error"});return}if(!window.confirm("Isso vai zerar TODOS os dados do workspace deste cliente (Vaults, Dashboards, KPIs, Governan√ßa). Deseja continuar?"))return;const b=ht.resetClientData(d,{clientName:((C=i==null?void 0:i.client)==null?void 0:C.name)||""}),k={clientName:((p=i==null?void 0:i.client)==null?void 0:p.name)||"",niche:"gastronomia",tagline:"",promise:"",enemy:"",brandValues:[],audienceAge:"25-34",audienceGender:"todos",audienceClass:"bc",audiencePain:"",archetype:"O Cara Comum",tone:"casual",mood:"moderno",primaryColor:"#F97316",secondaryColor:"#1E293B",accentColor:"#10B981",bio:"",products:[],currentTicket:"",targetTicket:"",currentRevenue:"",upsellStrategy:"none",saleFormat:"presencial",baitProduct:"",baitPrice:"",channels:[],conversionLink:"",instagramHandle:"",websiteUrl:"",primaryCTA:"whatsapp",secondaryCTA:"saibamais",ctaText:"",monthlyGoal:"",trafficType:"Misto",utmCampaign:"",currentConversion:"",targetConversion:"",cpl:"",approverName:"",teamStructure:"Enxuta",slaHours:24,contentOwner:"",trafficOwner:"",supportOwner:"",emergencyContact:"",postingFrequency:"3x",bestDays:[],bestTimes:[],startDate:"",cycleDuration:"30",stakeholders:[],competitors:[],ideas:[],references:[],notepad:"",governanceHistory:[],brandAssets:{logos:[],textures:[],icons:[],postTemplates:[]},brandIdentity:{musicalStyle:"",visualVibes:[],keyElements:[],prohibitedElements:[],colorMeanings:"",photoStyle:"",typographyNotes:""},customThemeEnabled:!1,_schemaVersion:1};o({active:!1,comments:{general:"",revenue:"",traffic:"",sales:""}}),c&&c(k),a(b),x({title:"Workspace zerado",description:"Dados de teste/simula√ß√£o removidos. Pode preencher novamente.",type:"success"})},_=m.useMemo(()=>Array.isArray(t==null?void 0:t.governanceHistory)&&t.governanceHistory.length>0?t.governanceHistory:Array.isArray(l==null?void 0:l.governanceHistory)?l.governanceHistory:[],[t==null?void 0:t.governanceHistory,l==null?void 0:l.governanceHistory]),z=m.useMemo(()=>_.filter(d=>{var f;return((f=d==null?void 0:d.signature)==null?void 0:f.closedAt)&&(d==null?void 0:d.kpis)}),[_]),M=m.useMemo(()=>(t==null?void 0:t.lastGovernanceATA)||z[0]||null,[t==null?void 0:t.lastGovernanceATA,z]),O=m.useMemo(()=>z[1]||null,[z]),$=qe("DASH_ONBOARDING",!1),F=qe("DASH_INSIGHTS",!1),T=qe("DASH_INSIGHTS_ACTIONS",!1),G=qe("DASH_EDIT_DRAWER",!1),q=qe("DASH_QUICKADD_DRAWER",!1),W=qe("DASH_UNDO",!1),ie=qe("DASH_SKELETON_REAL",!1),R=qe("DASH_EMPTY_STATES",!1),[Y,ne]=m.useState("week"),[le,se]=m.useState(null),[oe,L]=m.useState(!1),[ee,ae]=m.useState(null),[me,pe]=m.useState(null),[te,ve]=m.useState({channelId:"instagram",subchannelId:"feed"}),[Se,ye]=m.useState(!1),[E,X]=m.useState(!1),[xe,Ae]=m.useState(!1),[ge,je]=m.useState("brand"),[de,Me]=m.useState(!1),[we,h]=m.useState(!1),[B,H]=m.useState(null),[U,he]=m.useState(null),ce=m.useRef(null),[Be,lt]=m.useState({}),[bt,We]=m.useState(!1),[ot,Je]=m.useState(!1),[pt,Ne]=m.useState(!1),[dt,ft]=m.useState(null),[Ze,Vt]=m.useState(t.governanceFrequency||"weekly"),vt=(js=(vs=t==null?void 0:t.vaults)==null?void 0:vs.S4)==null?void 0:js.governanceCalendar,{executeWithUndo:ct}=zr(),[J,Le]=m.useState(((ys=t.dashboard)==null?void 0:ys.kpis)||[{id:"1",label:"Receita Total",value:"R$ 0,00"},{id:"2",label:"Lucro L√≠quido",value:"R$ 0,00"},{id:"3",label:"CAC",value:"R$ 0,00"},{id:"4",label:"LTV",value:"R$ 0,00"}]);m.useEffect(()=>{a(d=>({...d,dashboard:{...d.dashboard,kpis:J}}))},[J]);const jt=(d,f,b)=>{Le(k=>k.map(N=>N.id===d?{...N,[f]:b}:N))},ut=m.useMemo(()=>[{id:"cpm",label:"CPM",prefix:"R$ ",suffix:""},{id:"cpc",label:"CPC",prefix:"R$ ",suffix:""},{id:"cpl",label:"CPL",prefix:"R$ ",suffix:""},{id:"ctr",label:"CTR",prefix:"",suffix:"%"}],[]);m.useEffect(()=>()=>{ce.current&&(clearTimeout(ce.current),ce.current=null)},[]);const yt=d=>{d&&(he(d),ce.current&&clearTimeout(ce.current),ce.current=setTimeout(()=>{he(null),ce.current=null},2500))};m.useEffect(()=>{try{const f=new URLSearchParams(window.location.search).get("focusItem");if(!f)return;ne("month"),requestAnimationFrame(()=>{const b=document.querySelector(`[data-testid="d2-row-${f}"]`);b&&typeof b.scrollIntoView=="function"&&b.scrollIntoView({behavior:"smooth",block:"center"}),yt(f)})}catch{}},[]);const Rt=d=>{if(!T)return;const f=Array.isArray(d==null?void 0:d.items)?d.items[0]:null;f!=null&&f.id&&(ne("month"),requestAnimationFrame(()=>{const b=document.querySelector(`[data-testid="d2-row-${f.id}"]`);b&&typeof b.scrollIntoView=="function"&&b.scrollIntoView({behavior:"smooth",block:"center"}),yt(f.id)}))};if(ie&&j)return e.jsx("div",{className:"h-full bg-[var(--bg-deep)] text-[var(--text-primary)] font-sans relative flex flex-col selection:bg-white/20",children:e.jsx(Ga,{})});const Kt=(d,f)=>{var p,S;if(!n.active){x({title:"Modo Leitura",description:"Ative a Governan√ßa para editar KPIs.",type:"info"});return}const b=parseFloat(f)||0,k=(p=J[d])==null?void 0:p.value,N={...J,[d]:{...J[d],value:b}};Le(N);const C={id:Date.now(),ts:new Date().toISOString(),actor:i!=null&&i.role?`${i.role} (${((S=i.client)==null?void 0:S.name)||"System"})`:"Unknown",action:"UPDATE_KPI",target:d,oldValue:k,newValue:b};a(A=>{var K,P,Q;return{...A,kpis:N,measurementContract:{...A.measurementContract||{},kpis:((P=(K=A.measurementContract)==null?void 0:K.kpis)==null?void 0:P.map(re=>re.id===d?{...re,value:b}:re))||[],auditLog:[C,...((Q=A.measurementContract)==null?void 0:Q.auditLog)||[]]}}})},Bt=(d,f)=>{var p,S;if(!n.active){x({title:"Modo Leitura",description:"Ative a Governan√ßa para editar KPIs.",type:"info"});return}const b=parseFloat(f)||0,k=(p=J[d])==null?void 0:p.goal,N={...J,[d]:{...J[d]||{},goal:b}};Le(N);const C={id:Date.now(),ts:new Date().toISOString(),actor:i!=null&&i.role?`${i.role} (${((S=i.client)==null?void 0:S.name)||"System"})`:"Unknown",action:"UPDATE_KPI_GOAL",target:d,oldValue:k,newValue:b};a(A=>{var K,P,Q;return{...A,kpis:N,measurementContract:{...A.measurementContract||{},kpis:((P=(K=A.measurementContract)==null?void 0:K.kpis)==null?void 0:P.map(re=>re.id===d?{...re,target:b}:re))||[],auditLog:[C,...((Q=A.measurementContract)==null?void 0:Q.auditLog)||[]]}}})},xt=Array.isArray((Ns=(ws=t==null?void 0:t.measurementContract)==null?void 0:ws.dashboardLayout)==null?void 0:Ns.secondaryKpis)?t.measurementContract.dashboardLayout.secondaryKpis:[],Ht=d=>{const f=ut.find(b=>b.id===d);f&&(a(b=>{var re,Ee,Tt,Dt;const k=((re=b==null?void 0:b.measurementContract)==null?void 0:re.dashboardLayout)||{},N=Array.isArray(k.secondaryKpis)?k.secondaryKpis:[],C=N.includes(d),p=C?N.filter(Ie=>Ie!==d):[...N,d],S=Array.isArray((Ee=b==null?void 0:b.measurementContract)==null?void 0:Ee.kpis)?b.measurementContract.kpis:[],K=S.some(Ie=>(Ie==null?void 0:Ie.id)===d)?S.map(Ie=>Ie.id===d?{...Ie,active:!C}:Ie):[...S,{id:d,label:f.label,format:"decimal",source:"manual",target:0,active:!0}],P=b!=null&&b.kpis&&typeof b.kpis=="object"?b.kpis:{},Q={...P,[d]:{...(P==null?void 0:P[d])||{},value:Number(((Tt=P==null?void 0:P[d])==null?void 0:Tt.value)??0),goal:Number(((Dt=P==null?void 0:P[d])==null?void 0:Dt.goal)??0)}};return{...b,kpis:Q,measurementContract:{...(b==null?void 0:b.measurementContract)||{},dashboardLayout:{...k,secondaryKpis:p},kpis:K}}}),Le(b=>{var k,N;return{...b,[d]:{...(b==null?void 0:b[d])||{},value:Number(((k=b==null?void 0:b[d])==null?void 0:k.value)??0),goal:Number(((N=b==null?void 0:b[d])==null?void 0:N.goal)??0)}}}))},qt=()=>{const d=!n.active;o(f=>({...f,active:d})),d?(x({title:"Modo Governan√ßa",description:"Reuni√£o iniciada. Edite KPIs e registre decis√µes.",type:"info"}),We(!1),Ne(!0)):(We(!1),Ne(!1),x({title:"Modo Governan√ßa",description:"Reuni√£o encerrada.",type:"success"}))},He=d=>{const{ata:f,recalibration:b,nextWindow:k,roadmapUpdates:N,goalChanges:C}=d,p={...J},S=[];b!=null&&b.suggestedKpis&&Object.entries(b.suggestedKpis).forEach(([P,Q])=>{var re;p[P]&&(Q!=null&&Q.newGoal)&&(p[P].goal=Q.newGoal,S.push({id:P,fromGoal:((re=J==null?void 0:J[P])==null?void 0:re.goal)??0,toGoal:Q.newGoal,reason:(Q==null?void 0:Q.reason)||"recalibration"}))});const A=Array.isArray(C)?C.map(P=>({id:P.id,fromGoal:P.fromGoal,toGoal:P.toGoal,changedAt:P.changedAt})):[];A.forEach(P=>{p[P.id]&&(p[P.id].goal=P.toGoal)}),Le(p);const K=[f,...t.governanceHistory||[]];a(P=>{var Ts,Ds,Ps,$s,Es,Fs;const Q=Array.isArray(P==null?void 0:P.governanceHistory)?P.governanceHistory:[],re=[f,...Q],Ee=Array.isArray((Ts=P==null?void 0:P.dashboard)==null?void 0:Ts.D2)?P.dashboard.D2:[],Tt=N&&N.length>0?Ee.map(be=>{const Fe=N.find(ia=>String(ia.id)===String(be.id));return Fe?{...be,status:Fe.status,governanceNote:Fe.governanceNote}:be}):Ee,Dt=Array.isArray((Ds=P==null?void 0:P.measurementContract)==null?void 0:Ds.kpis)?P.measurementContract.kpis:[],Ie={revenue:(Ps=p==null?void 0:p.revenue)==null?void 0:Ps.goal,traffic:($s=p==null?void 0:p.traffic)==null?void 0:$s.goal,sales:(Es=p==null?void 0:p.sales)==null?void 0:Es.goal},ra=Dt.map(be=>{const Fe=Ie==null?void 0:Ie[be.id];return typeof Fe!="number"?be:{...be,target:Fe}}),na=[...S.map(be=>{var Fe;return{id:Date.now()+Math.random(),ts:new Date().toISOString(),actor:i!=null&&i.role?`${i.role} (${((Fe=i.client)==null?void 0:Fe.name)||"System"})`:"System",action:"GOVERNANCE_RECALIBRATION",target:be.id,oldValue:be.fromGoal,newValue:be.toGoal,details:be.reason}}),...A.map(be=>{var Fe;return{id:Date.now()+Math.random(),ts:be.changedAt||new Date().toISOString(),actor:i!=null&&i.role?`${i.role} (${((Fe=i.client)==null?void 0:Fe.name)||"System"})`:"Operador",action:"GOVERNANCE_GOAL_CHANGE",target:be.id,oldValue:be.fromGoal,newValue:be.toGoal,details:"Altera√ß√£o manual durante a governan√ßa"}})];return{...P,kpis:p,dashboard:{...(P==null?void 0:P.dashboard)||{},D2:Tt},governanceHistory:re,lastGovernance:new Date().toISOString(),lastGovernanceATA:f,nextGovernanceWindow:k,recalibration:b,governanceFrequency:Ze,measurementContract:{...P.measurementContract||{},kpis:ra,lastUpdate:new Date().toISOString(),auditLog:[...na,...((Fs=P.measurementContract)==null?void 0:Fs.auditLog)||[]]}}}),c&&c(P=>({...P,governanceHistory:K})),x({title:"Governan√ßa Conclu√≠da",description:"ATA gerada e sistema recalibrado. Atualizando estrat√©gia...",type:"success"}),ps(null,p,f,K).catch(P=>console.error("Auto-gen error:",P))};m.useEffect(()=>{const d=()=>ps();return window.addEventListener("BRAVVO_GENERATE_STRATEGY",d),()=>window.removeEventListener("BRAVVO_GENERATE_STRATEGY",d)},[t,J]);const wt=d=>{if(d.goalAdjustments){const k={...J};Object.entries(d.goalAdjustments).forEach(([N,C])=>{C&&k[N]&&(k[N].goal=parseFloat(C))}),Le(k),a(N=>({...N,kpis:k}))}const b=[{id:`GOV-${Date.now()}`,date:new Date().toISOString(),type:"governance_commit",...d,kpiSnapshot:J},...t.governanceHistory||[]];a(k=>({...k,governanceHistory:b,lastGovernance:new Date().toISOString(),governanceFrequency:Ze})),c&&c(k=>({...k,governanceHistory:b})),d.checklistProgress>=1?(o({active:!1,comments:{general:"",revenue:"",traffic:"",sales:""}}),x({title:"Ciclo Fechado",description:"Governan√ßa salva com sucesso.",type:"success"})):x({title:"Rascunho Salvo",description:"Continue o checklist depois.",type:"info"})},Nt=d=>{Vt(d),a(f=>{var C,p;const b={...f,governanceFrequency:d},k=(f==null?void 0:f.lastGovernanceATA)||null,N=(p=(C=f==null?void 0:f.vaults)==null?void 0:C.S4)==null?void 0:p.governanceCalendar;return k&&(b.nextGovernanceWindow=cs(k,d,N)),b})},Ct=d=>{a(f=>{const b=(f==null?void 0:f.vaults)||{},k=(b==null?void 0:b.S4)||{},N={...k,governanceCalendar:{...(k==null?void 0:k.governanceCalendar)||{},...d}},C={...f,vaults:{...b,S4:N}},p=(f==null?void 0:f.lastGovernanceATA)||null;return p&&(C.nextGovernanceWindow=cs(p,Ze,N.governanceCalendar)),C})},St=d=>{d.items&&d.items.length>0&&ae(d.items[0])},At=[{value:"draft",label:"Draft",color:"bg-gray-500"},{value:"pending",label:"Pending",color:"bg-yellow-500"},{value:"in_production",label:"In Prod",color:"bg-yellow-500"},{value:"scheduled",label:"Scheduled",color:"bg-green-500"},{value:"done",label:"Published",color:"bg-blue-500"},{value:"delayed",label:"Delayed",color:"bg-red-500"},{value:"cancelled",label:"Cancelado",color:"bg-gray-500"}],It={post:{icon:"üì∑",label:"Post"},reel:{icon:"üé¨",label:"Reel"},story:{icon:"üì±",label:"Story"},carousel:{icon:"üé†",label:"Carousel"},ad:{icon:"üí∞",label:"Ad"}},mt=(d=!1)=>{var p;const f=((p=t.dashboard)==null?void 0:p.D2)||[],b=new Date;b.setHours(0,0,0,0);const k=new Date(b);k.setDate(k.getDate()+1);const N=new Date(b);N.setDate(N.getDate()+7);const C=f.filter(S=>{if(!S.date)return!1;const A=S.date,K=b.toISOString().split("T")[0],P=k.toISOString().split("T")[0],Q=new Date(S.date);return Q.setHours(0,0,0,0),Y==="today"?A===K:Y==="tomorrow"?A===P:Y==="week"?Q<=N&&Q>=b:!0});return d||!le?C:C.filter(S=>S.status===le)},u=mt(!0),v=mt(),I=(()=>{const d=["draft","pending","in_production","scheduled","done","delayed","cancelled"],f=d.reduce((N,C)=>({...N,[C]:0}),{}),b=Array.isArray(u)?u.length:0;(u||[]).forEach(N=>{const C=(N==null?void 0:N.status)||"draft";f[C]!==void 0&&(f[C]+=1)});const k=d.reduce((N,C)=>({...N,[C]:b>0?Math.round(f[C]/b*100):0}),{});return{total:b,counts:f,pct:k}})(),D=(d,f)=>{var k,N;if(!W){const C=t.dashboard.D2.map(p=>p.id===d?{...p,status:f}:p);a({...t,dashboard:{...t.dashboard,D2:C}});return}const b=(N=(k=t.dashboard)==null?void 0:k.D2)==null?void 0:N.find(C=>C.id===d);b&&ct({description:"Status atualizado",type:"info",action:()=>{a(C=>{var A;const S=(Array.isArray((A=C==null?void 0:C.dashboard)==null?void 0:A.D2)?C.dashboard.D2:[]).map(K=>K.id===d?{...K,status:f}:K);return{...C,dashboard:{...(C==null?void 0:C.dashboard)||{},D2:S}}})},undoAction:()=>{a(C=>{var A;const S=(Array.isArray((A=C==null?void 0:C.dashboard)==null?void 0:A.D2)?C.dashboard.D2:[]).map(K=>K.id===d?{...K,status:b.status}:K);return{...C,dashboard:{...(C==null?void 0:C.dashboard)||{},D2:S}}})}})},V=d=>{var b,k;if(!W){const N=t.dashboard.D2.map(C=>C.id===d.id?d:C);a({...t,dashboard:{...t.dashboard,D2:N}}),x({title:"Item Saved",type:"success"});return}const f=(k=(b=t.dashboard)==null?void 0:b.D2)==null?void 0:k.find(N=>N.id===(d==null?void 0:d.id));f&&ct({description:"Item atualizado",type:"info",action:()=>{a(N=>{var S;const p=(Array.isArray((S=N==null?void 0:N.dashboard)==null?void 0:S.D2)?N.dashboard.D2:[]).map(A=>A.id===d.id?d:A);return{...N,dashboard:{...(N==null?void 0:N.dashboard)||{},D2:p}}})},undoAction:()=>{a(N=>{var S;const p=(Array.isArray((S=N==null?void 0:N.dashboard)==null?void 0:S.D2)?N.dashboard.D2:[]).map(A=>A.id===f.id?f:A);return{...N,dashboard:{...(N==null?void 0:N.dashboard)||{},D2:p}}})}})},ue=d=>{H(d),h(!0)},Te=d=>{a(f=>{var p;const b=Array.isArray(f==null?void 0:f.creativeAssets)?f.creativeAssets:[],k=[d,...b],C=(Array.isArray((p=f==null?void 0:f.dashboard)==null?void 0:p.D2)?f.dashboard.D2:[]).map(S=>S.id===d.itemId?{...S,visual_output:d.id}:S);return{...f,creativeAssets:k,dashboard:{...(f==null?void 0:f.dashboard)||{},D2:C}}}),x({title:"Arte salva",type:"success"})},De=d=>{const f={...d,id:d.id||`NEW-${Date.now()}`};if(!W){a({...t,dashboard:{...t.dashboard,D2:[...t.dashboard.D2||[],f]}}),x({title:"Item Created",type:"success"});return}ct({description:"Item criado",type:"success",action:()=>{a(b=>{var N;const k=Array.isArray((N=b==null?void 0:b.dashboard)==null?void 0:N.D2)?b.dashboard.D2:[];return{...b,dashboard:{...(b==null?void 0:b.dashboard)||{},D2:[...k,f]}}})},undoAction:()=>{a(b=>{var C;const N=(Array.isArray((C=b==null?void 0:b.dashboard)==null?void 0:C.D2)?b.dashboard.D2:[]).filter(p=>p.id!==f.id);return{...b,dashboard:{...(b==null?void 0:b.dashboard)||{},D2:N}}})}})},Pe=d=>{var N;const f={...J},b=(N=t.measurementContract)!=null&&N.kpis?[...t.measurementContract.kpis]:[],k=[];d.mode==="manual"&&Object.entries(d.values).forEach(([C,p])=>{var K;const S=parseFloat(p);f[C]&&(f[C].value=S);const A=b.findIndex(P=>P.id===C);if(A>=0){const P=b[A].value;b[A]={...b[A],value:S},k.push({id:Date.now()+Math.random(),ts:new Date().toISOString(),actor:i!=null&&i.role?`${i.role} (${((K=i.client)==null?void 0:K.name)||"System"})`:"Import Tool",action:"IMPORT_DATA",target:C,oldValue:P,newValue:S,details:"Manual Import"})}}),Le(f),a(C=>{var p;return{...C,kpis:f,measurementContract:{...C.measurementContract||{},kpis:b,lastUpdate:new Date().toISOString(),auditLog:[...k,...((p=C.measurementContract)==null?void 0:p.auditLog)||[]]}}}),x({title:"Importa√ß√£o Conclu√≠da",description:`${k.length} m√©tricas atualizadas.`,type:"success"})},kt=d=>{var C,p;const f=((p=(C=t==null?void 0:t.vaults)==null?void 0:C.S2)==null?void 0:p.products)||[],b=f.find(S=>S==null?void 0:S.isHero)||f.find(S=>String((S==null?void 0:S.role)||"").toLowerCase()==="hero")||f[0]||null,k=(b==null?void 0:b.id)!=null?b.id:"hero",N=d.tasks.map((S,A)=>{const K=new Date;K.setDate(K.getDate()+S.dayOffset+1);const P=d.channels[A%d.channels.length]||"Instagram Feed",Q=Ot(P),re=Q.channelId||"instagram",Ee=Q.subchannelId||Ke(re)||"feed";return{id:`PB-${Date.now()}-${A}`,date:K.toISOString().split("T")[0],initiative:S.title,channelId:re,subchannelId:Ee,channel:ze(re,Ee),format:Ye(re,Ee),offerId:k,ctaId:"whatsapp",responsible:S.role,status:"draft",visual_output:"Pending",origin:`Playbook: ${d.name}`}});a(S=>{var A,K;return{...S,dashboard:{...S.dashboard,D2:[...S.dashboard.D2||[],...N]},measurementContract:{...S.measurementContract||{},auditLog:[{id:Date.now(),ts:new Date().toISOString(),actor:i!=null&&i.role?`${i.role} (${((A=i.client)==null?void 0:A.name)||"System"})`:"System",action:"APPLY_PLAYBOOK",target:"Roadmap",details:`Applied: ${d.name}`},...((K=S.measurementContract)==null?void 0:K.auditLog)||[]]}}}),x({title:"Plano Gerado",description:`${N.length} tarefas criadas a partir do playbook.`,type:"success"})},[Z,$e]=m.useState(!1),st=async()=>{$e(!0);try{const d=t.vaults,f=await Oe.generatePlanWithAI(d,M),b=(f.tasks||[]).map((k,N)=>{const C=new Date;C.setDate(C.getDate()+N%7+1);let p="instagram",S="feed";if(k.channel){const A=k.channel.toLowerCase();A.includes("story")?S="stories":A.includes("reel")?S="reels":A.includes("email")?p="email":A.includes("blog")?p="blog":A.includes("youtube")?p="youtube":A.includes("whatsapp")&&(p="whatsapp")}return{id:`AI-${Date.now()}-${N}`,date:C.toISOString().split("T")[0],initiative:k.title,channelId:p,subchannelId:S,channel:ze(p,S),format:Ye(p,S),offerId:"hero",status:"draft",responsible:k.responsible||"Time",microDescription:k.description,origin:"AI Plan"}});if(a(k=>{var N;return{...k,dashboard:{...k.dashboard,D2:[...k.dashboard.D2||[],...b]},measurementContract:{...k.measurementContract||{},auditLog:[{id:Date.now(),ts:new Date().toISOString(),actor:i!=null&&i.role?`${i.role} (AI Trigger)`:"System AI",action:"AI_GENERATE_PLAN",target:"Roadmap",details:`Generated ${b.length} items`},...((N=k.measurementContract)==null?void 0:N.auditLog)||[]]}}}),f.kpis&&f.kpis.length>0){const k={...J};f.kpis.forEach(N=>{let C=null;const p=N.name.toLowerCase();if(p.includes("receita")||p.includes("faturamento")?C="revenue":p.includes("tr√°fego")||p.includes("visitas")?C="traffic":(p.includes("vendas")||p.includes("convers√£o"))&&(C="sales"),C&&k[C]){const S=typeof N.target=="number"?N.target:parseFloat(N.target.replace(/[^0-9.]/g,""));isNaN(S)||(k[C].goal=S)}}),Le(k)}x({title:"Plano Gerado com Sucesso",description:`${b.length} iniciativas criadas e KPIs atualizados com intelig√™ncia.`,type:"success",duration:5e3})}catch(d){console.error(d),x({title:"Erro na Gera√ß√£o",description:d.message,type:"error"})}finally{$e(!1)}},_t=()=>{var f;return(f=t.measurementContract)!=null&&f.lastUpdate?new Date(t.measurementContract.lastUpdate).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"}):"Nunca atualizado"},sa=d=>{try{const f=new URL(window.location.href);return f.searchParams.set("focusItem",String(d)),f.hash="",f.toString()}catch{return`?focusItem=${encodeURIComponent(String(d))}`}},aa=(d,f)=>{var S,A,K;f.stopPropagation();const b=((K=(A=(S=t==null?void 0:t.vaults)==null?void 0:S.S4)==null?void 0:A.contacts)==null?void 0:K.emergency)||"",k=String(b).replace(/\D/g,""),N=sa(d.id),C=`*BRAVVO APPROVAL REQUEST*

üìù *Initiative:* ${d.initiative}
üìÖ *Date:* ${d.date}
üì∫ *Channel:* ${d.channel}

Por favor, aprovar ou comentar.
(Link interno: ${N})`;if(!k||k.length<10){try{navigator.clipboard.writeText(C),x({title:"Contato n√£o configurado",description:"Telefone inv√°lido. Mensagem copiada.",type:"info"})}catch{x({title:"Contato n√£o configurado",description:"Telefone inv√°lido.",type:"info"})}return}const p=`https://wa.me/${k}?text=${encodeURIComponent(C)}`;window.open(p,"_blank"),x({title:"WhatsApp Aberto",description:"Mensagem de aprova√ß√£o pr√©-preenchida.",type:"success"})};(Cs=Oe.getAIConfig())!=null&&Cs.weights;const ps=async(d=null,f=null,b=null,k=null)=>{var N,C,p,S;$e(!0);try{const A=Oe.getAIConfig(),K=await Oe.generatePlanWithAI(d||t.vaults,f||J,b||M,k||((N=t.measurementContract)==null?void 0:N.auditLog)||[],A==null?void 0:A.weights);if(K.tasks&&Array.isArray(K.tasks)){const P=K.tasks.map((Q,re)=>({id:`AI-STRAT-${Date.now()}-${re}`,date:new Date().toISOString().split("T")[0],initiative:Q.title,channel:Q.category||"Geral",status:"scheduled",owner:"Time",microDescription:Q.description,priority:Q.priority}));a(Q=>{var re,Ee;return{...Q,dashboard:{...Q.dashboard,D2:[...((re=Q.dashboard)==null?void 0:re.D2)||[],...P]},recalibration:{...Q.recalibration||{},executionFocus:[{message:K.recommendation||"Estrat√©gia gerada via IA."},...((Ee=Q.recalibration)==null?void 0:Ee.executionFocus)||[]].slice(0,3)}}}),x({title:"Estrat√©gia Gerada üöÄ",description:`${P.length} a√ß√µes criadas com pondera√ß√£o: ${((C=A==null?void 0:A.weights)==null?void 0:C.strategy)||50}/${((p=A==null?void 0:A.weights)==null?void 0:p.lastGov)||30}/${((S=A==null?void 0:A.weights)==null?void 0:S.history)||20}`,type:"success"})}}catch(A){console.error(A),x({title:"Erro na Estrat√©gia",description:A.message,type:"error"})}finally{$e(!1)}};return e.jsxs("div",{className:"h-full bg-[var(--bg-deep)] text-[var(--text-primary)] font-sans relative flex flex-col selection:bg-white/20",children:[e.jsxs("div",{className:"h-12 border-b border-[var(--border-subtle)] bg-[var(--bg-deep)] flex items-center justify-between px-4 shrink-0 transition-colors sticky top-0 z-50",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 px-2 py-1 hover:bg-white/5 rounded cursor-pointer transition-colors",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${n.active?"bg-purple-500 animate-pulse":"bg-green-500"}`}),e.jsx("span",{className:"text-[11px] font-bold text-gray-400 uppercase tracking-widest hover:text-white transition-colors",children:n.active?"Governance Active":t.clientName})]}),e.jsx("div",{className:"hidden md:flex flex-col items-start ml-2",children:e.jsxs("span",{className:"text-[9px] text-gray-600 font-mono uppercase tracking-wider",children:["Dados: ",_t()]})})]}),e.jsx("div",{className:"hidden md:flex items-center bg-[var(--bg-surface)] p-0.5 rounded border border-[var(--border-subtle)]",children:["today","tomorrow","week","month"].map(d=>e.jsx("button",{onClick:()=>ne(d),className:`px-3 py-1 text-[10px] font-bold uppercase tracking-wider rounded-sm transition-all ${Y===d?"bg-white text-black shadow-sm":"text-gray-500 hover:text-gray-300"}`,children:w(`os.date.${d}`)},d))}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>ye(!0),className:"btn-ghost !h-7 !px-2",title:w("os.actions.history"),children:e.jsx(ss,{size:14})}),e.jsx("button",{onClick:()=>X(!0),className:"btn-ghost !h-7 !px-2",title:"Importar Dados",children:e.jsx(as,{size:14})}),e.jsx("button",{onClick:()=>{je("tools"),Ae(!0)},className:"btn-ghost !h-7 !px-2",title:"Workspace Tools","data-testid":"os-open-workspace-tools",children:e.jsx(Js,{size:14})}),e.jsx("button",{"data-testid":"os-reset-workspace",onClick:y,className:"btn-ghost !h-7 !px-2 !border-red-500/30 text-red-400 hover:text-red-300",title:"Zerar dados do workspace",children:e.jsx(ls,{size:14})}),e.jsx("button",{onClick:()=>{je("brand"),Ae(!0)},className:"btn-ghost !h-7 !px-2",title:"Personalizar (usar paleta da marca)",children:e.jsx(Zs,{size:14})}),e.jsx("button",{onClick:()=>Je(!0),className:"btn-ghost !h-7 !px-2",title:"Calend√°rio Global & Setorial",children:e.jsx(ke,{size:14})}),e.jsx("div",{className:"w-px h-4 bg-white/10 mx-1"}),n.active&&e.jsxs("button",{onClick:()=>Me(!0),"data-testid":"os-open-playbooks",className:"btn-ghost !h-7 !px-3 !border-purple-500/30 text-purple-400 hover:text-purple-300",title:"Gerar Plano (Playbooks)",children:[e.jsx(Ys,{size:12,className:"md:mr-1"})," ",e.jsx("span",{className:"hidden md:inline",children:"Gerar Plano"})]}),e.jsxs("button",{onClick:()=>L(!0),className:"btn-primary !h-7 !px-3","data-testid":"os-quick-add",children:[e.jsx(Re,{size:14})," ",e.jsx("span",{className:"hidden md:inline ml-1",children:w("os.actions.new")})]})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-4 md:p-6",children:[e.jsx(jr,{frequency:Ze,lastGovernance:t.lastGovernance,isGovernanceActive:n.active,onToggleGovernance:qt,onChangeFrequency:Nt,nextWindow:t==null?void 0:t.nextGovernanceWindow,calendarRule:vt,onUpdateCalendarRule:Ct}),n.active?e.jsx("div",{className:"mb-6",children:e.jsx(gr,{open:n.active&&pt,variant:"embedded",onClose:()=>{Ne(!1),o({active:!1,comments:{general:"",revenue:"",traffic:"",sales:""}})},onComplete:He,kpis:J,roadmapItems:((Ss=t==null?void 0:t.dashboard)==null?void 0:Ss.D2)||[],vaults:t==null?void 0:t.vaults,governanceFrequency:Ze,currentUser:i,currentWindow:t==null?void 0:t.nextGovernanceWindow,calendarRule:vt,lastGovernance:M})}):e.jsxs(e.Fragment,{children:[e.jsx(Rs,{open:ot,onClose:()=>Je(!1),appData:t,roadmapItems:((As=t==null?void 0:t.dashboard)==null?void 0:As.D2)||[]}),M&&(()=>{var p,S,A,K,P;const d=(p=M==null?void 0:M.signature)==null?void 0:p.closedAt,f=d?new Date(d).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"}):M==null?void 0:M.id,b=parseFloat(((A=(S=M==null?void 0:M.kpis)==null?void 0:S.revenue)==null?void 0:A.achievement)||0),k=parseFloat(((P=(K=O==null?void 0:O.kpis)==null?void 0:K.revenue)==null?void 0:P.achievement)||0),N=O?b-k:0,C=O?N>2?"‚Üë":N<-2?"‚Üì":"‚Üí":"‚Üí";return e.jsxs("div",{className:"mb-4 px-4 py-2 rounded-xl border border-white/10 bg-[#080808] flex flex-col md:flex-row md:items-center md:justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("span",{className:"text-[10px] font-mono text-gray-500 uppercase tracking-wider",children:"√öltima governan√ßa"}),e.jsx("span",{className:"text-[11px] text-gray-300 font-medium truncate",children:f}),e.jsxs("span",{className:"text-[11px] text-gray-500 font-mono",children:[C,O?` ${N>=0?"+":""}${N.toFixed(1)}pp`:""]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{onClick:()=>{ft(M==null?void 0:M.id),ye(!0)},className:"btn-ghost !h-7 !px-3 !border-purple-500/30 text-purple-300 hover:text-purple-200",children:"Ver ATA"})})]})})(),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:Array.isArray(J)&&J.map(d=>e.jsxs("div",{className:"group relative bg-[#111] border border-white/5 rounded-xl p-4 hover:border-purple-500/30 transition-all",children:[e.jsxs("div",{className:"text-[10px] uppercase tracking-wider text-gray-500 mb-1 flex justify-between",children:[e.jsx("input",{className:"bg-transparent border-none p-0 text-gray-500 w-full focus:ring-0 focus:text-purple-400 transition-colors",value:d.label,onChange:f=>jt(d.id,"label",f.target.value)}),e.jsx(Ca,{size:10,className:"opacity-0 group-hover:opacity-50"})]}),e.jsx("input",{className:"bg-transparent border-none p-0 text-xl font-bold text-white w-full focus:ring-0 focus:text-purple-300 transition-colors placeholder-gray-700",value:d.value,onChange:f=>jt(d.id,"value",f.target.value),placeholder:"-"})]},d.id))}),e.jsxs("div",{className:"mb-6 bento-grid p-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3 mb-3",children:[e.jsx("div",{className:"text-label",children:"KPIs adicionais (manual)"}),e.jsx("div",{className:"text-[10px] text-gray-600",children:"Ative na lista e edite durante a Governan√ßa"})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:ut.map(d=>{const f=xt.includes(d.id);return e.jsx("button",{type:"button",onClick:()=>Ht(d.id),className:`text-[10px] font-bold uppercase tracking-wider px-2 py-1 rounded border ${f?"bg-purple-500/10 text-purple-300 border-purple-500/30":"bg-white/5 text-gray-400 border-white/10 hover:border-white/20"}`,children:d.label},d.id)})}),xt.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3",children:xt.map(d=>{var N,C;const f=ut.find(p=>p.id===d);if(!f)return null;const b=((N=J==null?void 0:J[d])==null?void 0:N.value)??0,k=((C=J==null?void 0:J[d])==null?void 0:C.goal)??0;return e.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-lg p-3",children:[e.jsx("div",{className:"text-[10px] font-bold uppercase tracking-wider text-gray-400 mb-2",children:f.label}),e.jsx("div",{className:"text-[11px] text-gray-600",children:"Realizado"}),e.jsx("div",{className:"mt-1",children:e.jsx(Et,{value:b,type:"number",prefix:f.prefix,suffix:f.suffix,onSave:p=>Kt(d,p),disabled:!n.active,className:"text-metric font-mono"})}),e.jsx("div",{className:"mt-2 text-[11px] text-gray-600",children:"Meta"}),e.jsx("div",{className:"mt-1",children:e.jsx(Et,{value:k,type:"number",prefix:f.prefix,suffix:f.suffix,onSave:p=>Bt(d,p),disabled:!n.active,className:"text-[13px] font-mono text-gray-200"})})]},d)})}):e.jsx("div",{className:"text-[11px] text-gray-600",children:"Nenhum KPI adicional ativo."})]}),e.jsx(Nr,{items:((Is=t==null?void 0:t.dashboard)==null?void 0:Is.D2)||[],kpis:J,onActionClick:St,variant:"strip"}),((t==null?void 0:t.recalibration)||(t==null?void 0:t.nextGovernanceWindow))&&e.jsxs("div",{className:"mb-6 grid grid-cols-1 lg:grid-cols-3 gap-4",children:[(t==null?void 0:t.nextGovernanceWindow)&&e.jsxs("div",{className:"bento-grid p-4",children:[e.jsx("div",{className:"text-label mb-2",children:"Pr√≥xima Janela"}),e.jsxs("div",{className:"text-sm text-white font-bold",children:[t.nextGovernanceWindow.startDate," ‚Üí ",t.nextGovernanceWindow.endDate]}),e.jsxs("div",{className:"mt-2 text-[11px] text-gray-500",children:["Foco: ",e.jsx("span",{className:"text-gray-300",children:((ks=t.nextGovernanceWindow.periodGoals)==null?void 0:ks.focus)||"‚Äî"})]})]}),(t==null?void 0:t.recalibration)&&e.jsxs("div",{className:"bento-grid p-4",children:[e.jsx("div",{className:"text-label mb-2",children:"Ordens do Ciclo"}),Array.isArray(t.recalibration.dailyOrders)&&t.recalibration.dailyOrders.length>0?e.jsx("div",{className:"space-y-2",children:t.recalibration.dailyOrders.slice(0,5).map(d=>e.jsx("div",{className:"flex items-start justify-between gap-3 bg-white/5 border border-white/10 rounded-lg p-2",children:e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"text-[11px] text-white font-medium truncate",children:[d.priority,". ",d.title]}),e.jsx("div",{className:"text-[10px] text-gray-600 font-mono",children:d.source})]})},d.id))}):e.jsx("div",{className:"text-[11px] text-gray-600",children:"‚Äî"})]}),(t==null?void 0:t.recalibration)&&e.jsxs("div",{className:"bento-grid p-4",children:[e.jsx("div",{className:"text-label mb-2",children:"Foco + Alertas"}),Array.isArray(t.recalibration.executionFocus)&&t.recalibration.executionFocus.length>0?e.jsx("div",{className:"space-y-2",children:t.recalibration.executionFocus.slice(0,3).map((d,f)=>e.jsx("div",{className:"text-[11px] text-gray-300 bg-white/5 border border-white/10 rounded-lg p-2",children:d.message},f))}):e.jsx("div",{className:"text-[11px] text-gray-600",children:"‚Äî"}),Array.isArray(t.recalibration.alerts)&&t.recalibration.alerts.length>0&&e.jsx("div",{className:"mt-3 space-y-2",children:t.recalibration.alerts.slice(0,3).map((d,f)=>e.jsxs("div",{className:"text-[11px] text-gray-400 bg-white/5 border border-white/10 rounded-lg p-2",children:[e.jsx("div",{className:"text-gray-300",children:d.title}),e.jsx("div",{className:"text-gray-600",children:d.action})]},f))})]})]})]}),$&&e.jsx("div",{className:"mb-6",children:e.jsx(ka,{appData:t,onNavigate:s,variant:"compact"})}),F&&e.jsx("div",{className:"mb-6",children:e.jsx(Ta,{items:((_s=t==null?void 0:t.dashboard)==null?void 0:_s.D2)||[],vaults:t==null?void 0:t.vaults,onInsightAction:T?Rt:void 0,maxItems:3})}),e.jsxs("div",{className:"flex-1 flex flex-col relative z-10 overflow-hidden",children:[e.jsx(Pr,{appData:t}),e.jsxs("header",{className:"h-16 border-b border-white/5 bg-black/40 backdrop-blur-md flex items-center justify-between px-6 shrink-0 relative z-20",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ke,{size:14,className:"text-gray-500"}),e.jsx("span",{className:"text-[11px] font-bold text-gray-300 uppercase tracking-widest",children:w("os.roadmap.title")}),e.jsx("span",{className:"bg-white/5 text-gray-500 text-[9px] px-1.5 py-0.5 rounded font-mono border border-white/5",children:v.length})]}),e.jsxs("div",{className:"flex items-center gap-1.5 opacity-50",children:[e.jsxs("button",{onClick:st,disabled:Z,className:"hidden sm:flex items-center gap-1 px-2 py-0.5 rounded border border-purple-500/30 bg-purple-500/10 text-[9px] text-purple-300 hover:bg-purple-500/20 transition-colors",title:"Gerar novas ideias com IA",children:[Z?e.jsx(nt,{size:10,className:"animate-spin"}):e.jsx(at,{size:10}),e.jsx("span",{children:"IA"})]}),e.jsx("span",{className:"text-[9px] text-gray-600 font-medium hidden sm:inline",children:w("os.roadmap.quick_actions")}),e.jsxs("kbd",{className:"hidden sm:inline-flex h-4 items-center gap-1 rounded border border-[var(--border-subtle)] bg-[var(--bg-deep)] px-1.5 font-mono text-[9px] font-medium text-[var(--text-secondary)]",children:[e.jsx("span",{className:"text-xs",children:"‚åò"}),"K"]})]})]}),e.jsx("div",{className:"px-4 py-2 border-b border-[var(--border-subtle)] bg-[#080808]",children:e.jsx("div",{className:"flex flex-wrap items-center gap-2",children:[{id:null,label:"Todos",pct:null,color:"bg-white/10 text-gray-300 border-white/10"},{id:"delayed",label:"Atrasado",pct:I.pct.delayed,color:"bg-red-500/10 text-red-300 border-red-500/30"},{id:"in_production",label:"Em produ√ß√£o",pct:I.pct.in_production,color:"bg-purple-500/10 text-purple-300 border-purple-500/30"},{id:"draft",label:"Em edi√ß√£o",pct:I.pct.draft,color:"bg-gray-500/10 text-gray-300 border-white/10"},{id:"scheduled",label:"Agendado",pct:I.pct.scheduled,color:"bg-green-500/10 text-green-300 border-green-500/30"},{id:"done",label:"Conclu√≠do",pct:I.pct.done,color:"bg-blue-500/10 text-blue-300 border-blue-500/30"},{id:"cancelled",label:"Cancelado",pct:I.pct.cancelled,color:"bg-gray-500/10 text-gray-300 border-white/10"}].map(d=>e.jsxs("button",{type:"button",onClick:()=>se(d.id),className:`text-[10px] font-bold uppercase tracking-wider px-2 py-1 rounded border ${d.color} ${le===d.id?"ring-1 ring-white/20":""}`,children:[d.label,d.pct!==null?e.jsxs("span",{className:"font-mono opacity-70",children:[" ",d.pct||0,"%"]}):null]},String(d.id)))})}),e.jsx("div",{className:"overflow-x-auto custom-scrollbar",children:e.jsxs("div",{className:"min-w-[800px]",children:[e.jsxs("div",{className:"grid grid-cols-[100px_1fr_150px_120px_120px_120px] gap-4 px-4 py-2 border-b border-[var(--border-subtle)] bg-[#080808]",children:[e.jsx("div",{className:"text-label",children:w("os.table.date")}),e.jsx("div",{className:"text-label",children:w("os.table.initiative")}),e.jsx("div",{className:"text-label",children:w("os.table.channel")}),e.jsx("div",{className:"text-label",children:w("os.table.status")}),e.jsx("div",{className:"text-label",children:w("os.table.owner")}),e.jsx("div",{className:"text-label text-right",children:w("os.table.edit")})]}),e.jsxs("div",{className:"bg-[var(--bg-deep)]",children:[v.map(d=>{var C;const f=Be==null?void 0:Be[d.id],b=typeof f=="string"?f:d.governanceNote||"",k=d.microDescription||d.governanceNote||d.origin||String(d.caption||"").split(`
`)[0],N=me===d.id;return e.jsxs("div",{"data-testid":`d2-row-${d.id}`,"data-highlighted":U===d.id?"true":"false",className:`grid grid-cols-[100px_1fr_150px_120px_120px_120px] gap-4 px-4 py-3 border-b border-[var(--border-subtle)] hover:bg-[var(--bg-surface)] group transition-all duration-200 items-center hover:pl-5 ${U===d.id?"bg-purple-500/10 ring-1 ring-purple-500/30":""}`,children:[e.jsx("div",{className:"text-mono-data text-gray-400 group-hover:text-white transition-colors",children:e.jsx(Mr,{value:d.date,displayValue:Ia(d.date),onSave:p=>{p&&V({...d,date:p})}})}),e.jsxs("div",{className:"min-w-0 pr-4","data-testid":`d2-initiative-${d.id}`,title:[d.microDescription,d.objective,d.ctaText,d.dependencies,d.successCriteria].filter(Boolean).join(" | "),onClick:()=>ae(d),children:[e.jsx(Et,{value:d.initiative||"",onSave:p=>{const S=String(p||"");S.trim()&&V({...d,initiative:S})},className:"text-sm font-medium text-white truncate group-hover:translate-x-1 transition-transform block"}),!!k&&e.jsx("div",{className:"text-[11px] text-gray-500 truncate mt-0.5 group-hover:hidden",children:k}),n.active&&e.jsx("div",{className:"mt-1 hidden group-hover:block",children:e.jsx("input",{value:b,placeholder:"Coment√°rio r√°pido (somente na Governan√ßa)",className:"bg-black/30 border border-white/10 rounded px-2 py-1 w-full text-[11px] text-gray-200 focus:outline-none focus:border-purple-500/50",onClick:p=>p.stopPropagation(),onChange:p=>{const S=p.target.value;lt(A=>({...A,[d.id]:S}))},onBlur:p=>{const S=String(p.target.value||"");a(A=>{var Q;const P=(Array.isArray((Q=A==null?void 0:A.dashboard)==null?void 0:Q.D2)?A.dashboard.D2:[]).map(re=>String(re.id)===String(d.id)?{...re,governanceNote:S}:re);return{...A,dashboard:{...(A==null?void 0:A.dashboard)||{},D2:P}}}),lt(A=>{const K={...A||{}};return delete K[d.id],K})}})})]}),e.jsx("div",{className:"text-xs text-gray-500 group-hover:text-gray-400 transition-colors",children:N?e.jsxs("div",{className:"space-y-1",onClick:p=>p.stopPropagation(),children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("select",{className:"bg-black/30 border border-white/10 rounded px-2 py-1 text-[11px] text-gray-200 focus:outline-none focus:border-purple-500/50",value:te.channelId,onChange:p=>{const S=p.target.value,A=Ke(S)||"";ve({channelId:S,subchannelId:A})},children:Mt().map(p=>e.jsx("option",{value:p.id,children:p.label},p.id))}),e.jsx("select",{className:"bg-black/30 border border-white/10 rounded px-2 py-1 text-[11px] text-gray-200 focus:outline-none focus:border-purple-500/50",value:te.subchannelId,onChange:p=>ve(S=>({...S,subchannelId:p.target.value})),children:Lt(te.channelId).map(p=>e.jsx("option",{value:p.id,children:p.label},p.id))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",className:"text-[10px] font-bold uppercase tracking-wider px-2 py-1 rounded border bg-white/5 text-gray-300 border-white/10 hover:border-white/20",onClick:()=>pe(null),children:"Cancelar"}),e.jsx("button",{type:"button",className:"text-[10px] font-bold uppercase tracking-wider px-2 py-1 rounded border bg-purple-500/10 text-purple-300 border-purple-500/30 hover:border-purple-400/40",onClick:()=>{const p=te.channelId,S=te.subchannelId||Ke(p)||"",A=ze(p,S),K=Ye(p,S);V({...d,channelId:p,subchannelId:S,channel:A,format:K}),pe(null)},children:"Salvar"})]})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:((C=It[d.format])==null?void 0:C.icon)||"üß©"}),e.jsx("button",{type:"button",className:"truncate text-left hover:text-white",onClick:p=>{p.stopPropagation();const S=Ot(d.channel||"Instagram Feed"),A=d.channelId||S.channelId,K=d.subchannelId||S.subchannelId||Ke(A)||"";ve({channelId:A,subchannelId:K}),pe(d.id)},title:"Editar canal",children:d.channel})]})}),e.jsx("div",{children:e.jsx(Lr,{value:d.status,onChange:p=>D(d.id,p),options:At,testId:`d2-status-${d.id}`})}),e.jsx("div",{className:"text-xs text-gray-600 truncate",children:e.jsx(Et,{value:d.responsible||"",onSave:p=>V({...d,responsible:String(p||"")}),className:"text-xs text-gray-300"})}),e.jsxs("div",{className:"flex justify-end gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:p=>aa(d,p),className:"p-1.5 hover:bg-green-500/20 rounded text-gray-400 hover:text-green-400 transform hover:scale-110 transition-all",title:"Solicitar Aprova√ß√£o (WhatsApp)",children:e.jsx(Sa,{size:12})}),e.jsx("button",{onClick:()=>ue(d),className:"p-1.5 hover:bg-purple-500/20 rounded text-gray-400 hover:text-purple-300 transform hover:scale-110 transition-all",title:"Gerar Arte","data-testid":`d2-generate-art-${d.id}`,children:e.jsx(rs,{size:12})}),e.jsx("button",{onClick:()=>ae(d),className:"p-1.5 hover:bg-white/10 rounded text-gray-400 hover:text-white transform hover:scale-110 transition-all",title:"Editar","data-testid":`d2-edit-${d.id}`,children:e.jsx(Aa,{size:12})})]})]},d.id)}),v.length===0&&(R?e.jsx(Da,{type:"roadmap",onAction:()=>L(!0),size:"md"}):e.jsxs("div",{className:"py-12 flex flex-col items-center justify-center text-gray-600 animate-fadeInUp",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-white/5 flex items-center justify-center mb-4",children:e.jsx(ke,{size:20,opacity:.5})}),e.jsx("p",{className:"text-xs",children:w("os.roadmap.no_items")}),e.jsxs("button",{onClick:()=>L(!0),className:"mt-4 text-xs font-bold text-gray-400 hover:text-white transition-colors flex items-center gap-1",children:[e.jsx(Re,{size:14})," ",w("os.actions.new")]}),e.jsxs("button",{onClick:st,disabled:Z,className:"mt-3 text-xs font-bold text-purple-400 hover:text-purple-300 transition-colors flex items-center gap-1 border border-purple-500/30 bg-purple-500/10 px-3 py-1.5 rounded-full",children:[Z?e.jsx(nt,{size:14,className:"animate-spin"}):e.jsx(at,{size:14}),Z?"Gerando Plano...":"‚ú® Gerar Roadmap com IA"]})]}))]})]})})]}),e.jsx(Tr,{vaults:t==null?void 0:t.vaults,labels:{brand_dna:w("os.vaults.brand_dna"),offer:w("os.vaults.offer"),traffic:w("os.vaults.traffic"),team:w("os.vaults.team"),ideas:w("os.vaults.ideas")},onVaultClick:d=>s(d)}),q?e.jsx(zs,{open:oe,onClose:()=>L(!1),title:w("os.quick_add.title"),width:"lg",testId:"quickadd-drawer",children:e.jsx("div",{className:"p-6",children:e.jsx(ea,{onAdd:De,onClose:()=>L(!1)})})}):e.jsx(Rr,{open:oe,onClose:()=>L(!1),onAdd:De}),G?e.jsx(zs,{open:!!ee,onClose:()=>ae(null),title:w("os.detail_edit.title"),subtitle:ee!=null&&ee.id?`ID: ${ee.id}`:void 0,width:"lg",testId:"detail-edit-drawer",children:ee&&e.jsx(ta,{item:ee,onSave:V,onClose:()=>ae(null)})}):e.jsx(Vr,{open:!!ee,onClose:()=>ae(null),item:ee,onSave:V}),e.jsx(Va,{open:Se,onClose:()=>{ye(!1),ft(null)},history:(t==null?void 0:t.governanceHistory)||(l==null?void 0:l.governanceHistory)||[],focusEntryId:dt}),e.jsx(Ra,{open:E,onClose:()=>X(!1),contract:t.measurementContract,onImport:Pe}),e.jsx(Dr,{open:xe,onClose:()=>Ae(!1),clientId:g,appData:t,setAppData:a,currentUser:i,initialTab:ge}),e.jsx(Ka,{open:de,onClose:()=>Me(!1),onApply:kt}),e.jsx(Rs,{open:ot,onClose:()=>Je(!1),appData:t}),e.jsx(rr,{open:we,onClose:()=>{h(!1),H(null)},item:B,vaults:t==null?void 0:t.vaults,onSave:Te,onGeneratePrompt:r}),e.jsx(nr,{open:bt,onClose:()=>We(!1),onSave:wt,governanceData:t==null?void 0:t.lastGovernanceData,kpis:J})]})]})}export{qr as OnePageDashboard};
